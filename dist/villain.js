!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("react-dom"),require("body-scroll-lock")):"function"==typeof define&&define.amd?define(["react","react-dom","body-scroll-lock"],t):(e=e||self).villain=t(e.React,e.ReactDOM,e.bodyScrollLock)}(this,(function(React,reactDom,bodyScrollLock){"use strict";var React__default="default"in React?React.default:React;function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function toVal(e){var t,n,i="";if(e)if("object"==typeof e)if(e.push)for(t=0;t<e.length;t++)e[t]&&(n=toVal(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(n=toVal(t))&&(i&&(i+=" "),i+=n);else"boolean"==typeof e||e.call||(i&&(i+=" "),i+=e);return i}function clsx(){for(var e,t=0,n="";t<arguments.length;)(e=toVal(arguments[t++]))&&(n&&(n+=" "),n+=e);return n}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var reactIs_development=createCommonjsModule((function(e,t){!function(){Object.defineProperty(t,"__esModule",{value:!0});var e="function"==typeof Symbol&&Symbol.for,n=e?Symbol.for("react.element"):60103,i=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,o=e?Symbol.for("react.strict_mode"):60108,s=e?Symbol.for("react.profiler"):60114,a=e?Symbol.for("react.provider"):60109,l=e?Symbol.for("react.context"):60110,c=e?Symbol.for("react.async_mode"):60111,u=e?Symbol.for("react.concurrent_mode"):60111,h=e?Symbol.for("react.forward_ref"):60112,d=e?Symbol.for("react.suspense"):60113,p=e?Symbol.for("react.suspense_list"):60120,f=e?Symbol.for("react.memo"):60115,m=e?Symbol.for("react.lazy"):60116,g=e?Symbol.for("react.fundamental"):60117,v=e?Symbol.for("react.responder"):60118,y=e?Symbol.for("react.scope"):60119;var w=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=0,o="Warning: "+e.replace(/%s/g,(function(){return n[r++]}));"undefined"!=typeof console&&console.warn(o);try{throw new Error(o)}catch(e){}},b=function(e,t){if(void 0===t)throw new Error("`lowPriorityWarningWithoutStack(condition, format, ...args)` requires a warning message argument");if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];w.apply(void 0,[t].concat(i))}};function S(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:var p=e.type;switch(p){case c:case u:case r:case s:case o:case d:return p;default:var g=p&&p.$$typeof;switch(g){case l:case h:case a:return g;default:return t}}case m:case f:case i:return t}}}var T=c,_=u,x=l,E=a,P=n,R=h,C=r,O=m,k=f,M=i,I=s,D=o,L=d,H=!1;function A(e){return S(e)===u}t.typeOf=S,t.AsyncMode=T,t.ConcurrentMode=_,t.ContextConsumer=x,t.ContextProvider=E,t.Element=P,t.ForwardRef=R,t.Fragment=C,t.Lazy=O,t.Memo=k,t.Portal=M,t.Profiler=I,t.StrictMode=D,t.Suspense=L,t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===u||e===s||e===o||e===d||e===p||"object"==typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===f||e.$$typeof===a||e.$$typeof===l||e.$$typeof===h||e.$$typeof===g||e.$$typeof===v||e.$$typeof===y)},t.isAsyncMode=function(e){return H||(H=!0,b(!1,"The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),A(e)||S(e)===c},t.isConcurrentMode=A,t.isContextConsumer=function(e){return S(e)===l},t.isContextProvider=function(e){return S(e)===a},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return S(e)===h},t.isFragment=function(e){return S(e)===r},t.isLazy=function(e){return S(e)===m},t.isMemo=function(e){return S(e)===f},t.isPortal=function(e){return S(e)===i},t.isProfiler=function(e){return S(e)===s},t.isStrictMode=function(e){return S(e)===o},t.isSuspense=function(e){return S(e)===d}}()}));unwrapExports(reactIs_development);var reactIs_development_1=reactIs_development.typeOf,reactIs_development_2=reactIs_development.AsyncMode,reactIs_development_3=reactIs_development.ConcurrentMode,reactIs_development_4=reactIs_development.ContextConsumer,reactIs_development_5=reactIs_development.ContextProvider,reactIs_development_6=reactIs_development.Element,reactIs_development_7=reactIs_development.ForwardRef,reactIs_development_8=reactIs_development.Fragment,reactIs_development_9=reactIs_development.Lazy,reactIs_development_10=reactIs_development.Memo,reactIs_development_11=reactIs_development.Portal,reactIs_development_12=reactIs_development.Profiler,reactIs_development_13=reactIs_development.StrictMode,reactIs_development_14=reactIs_development.Suspense,reactIs_development_15=reactIs_development.isValidElementType,reactIs_development_16=reactIs_development.isAsyncMode,reactIs_development_17=reactIs_development.isConcurrentMode,reactIs_development_18=reactIs_development.isContextConsumer,reactIs_development_19=reactIs_development.isContextProvider,reactIs_development_20=reactIs_development.isElement,reactIs_development_21=reactIs_development.isForwardRef,reactIs_development_22=reactIs_development.isFragment,reactIs_development_23=reactIs_development.isLazy,reactIs_development_24=reactIs_development.isMemo,reactIs_development_25=reactIs_development.isPortal,reactIs_development_26=reactIs_development.isProfiler,reactIs_development_27=reactIs_development.isStrictMode,reactIs_development_28=reactIs_development.isSuspense,reactIs=createCommonjsModule((function(e){e.exports=reactIs_development})),getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function shouldUseNative(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}var objectAssign=shouldUseNative()?Object.assign:function(e,t){for(var n,i,r=toObject(e),o=1;o<arguments.length;o++){for(var s in n=Object(arguments[o]))hasOwnProperty.call(n,s)&&(r[s]=n[s]);if(getOwnPropertySymbols){i=getOwnPropertySymbols(n);for(var a=0;a<i.length;a++)propIsEnumerable.call(n,i[a])&&(r[i[a]]=n[i[a]])}}return r},ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ReactPropTypesSecret_1=ReactPropTypesSecret,printWarning=function(){},ReactPropTypesSecret$1=ReactPropTypesSecret_1,loggedTypeFailures={},has=Function.call.bind(Object.prototype.hasOwnProperty);function checkPropTypes(e,t,n,i,r){for(var o in e)if(has(e,o)){var s;try{if("function"!=typeof e[o]){var a=Error((i||"React class")+": "+n+" type `"+o+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[o]+"`.");throw a.name="Invariant Violation",a}s=e[o](t,o,i,n,null,ReactPropTypesSecret$1)}catch(e){s=e}if(!s||s instanceof Error||printWarning((i||"React class")+": type specification of "+n+" `"+o+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof s+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),s instanceof Error&&!(s.message in loggedTypeFailures)){loggedTypeFailures[s.message]=!0;var l=r?r():"";printWarning("Failed "+n+" type: "+s.message+(null!=l?l:""))}}}printWarning=function(e){var t="Warning: "+e;"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(e){}},checkPropTypes.resetWarningCache=function(){loggedTypeFailures={}};var checkPropTypes_1=checkPropTypes,has$1=Function.call.bind(Object.prototype.hasOwnProperty),printWarning$1=function(){};function emptyFunctionThatReturnsNull(){return null}printWarning$1=function(e){var t="Warning: "+e;"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(e){}};var factoryWithTypeCheckers=function(e,t){var n="function"==typeof Symbol&&Symbol.iterator,i="@@iterator";var r="<<anonymous>>",o={array:c("array"),bool:c("boolean"),func:c("function"),number:c("number"),object:c("object"),string:c("string"),symbol:c("symbol"),any:l(emptyFunctionThatReturnsNull),arrayOf:function(e){return l((function(t,n,i,r,o){if("function"!=typeof e)return new a("Property `"+o+"` of component `"+i+"` has invalid PropType notation inside arrayOf.");var s=t[n];if(!Array.isArray(s))return new a("Invalid "+r+" `"+o+"` of type `"+h(s)+"` supplied to `"+i+"`, expected an array.");for(var l=0;l<s.length;l++){var c=e(s,l,i,r,o+"["+l+"]",ReactPropTypesSecret_1);if(c instanceof Error)return c}return null}))},element:l((function(t,n,i,r,o){var s=t[n];return e(s)?null:new a("Invalid "+r+" `"+o+"` of type `"+h(s)+"` supplied to `"+i+"`, expected a single ReactElement.")})),elementType:l((function(e,t,n,i,r){var o=e[t];return reactIs.isValidElementType(o)?null:new a("Invalid "+i+" `"+r+"` of type `"+h(o)+"` supplied to `"+n+"`, expected a single ReactElement type.")})),instanceOf:function(e){return l((function(t,n,i,o,s){if(!(t[n]instanceof e)){var l=e.name||r;return new a("Invalid "+o+" `"+s+"` of type `"+function(e){if(!e.constructor||!e.constructor.name)return r;return e.constructor.name}(t[n])+"` supplied to `"+i+"`, expected instance of `"+l+"`.")}return null}))},node:l((function(e,t,n,i,r){return u(e[t])?null:new a("Invalid "+i+" `"+r+"` supplied to `"+n+"`, expected a ReactNode.")})),objectOf:function(e){return l((function(t,n,i,r,o){if("function"!=typeof e)return new a("Property `"+o+"` of component `"+i+"` has invalid PropType notation inside objectOf.");var s=t[n],l=h(s);if("object"!==l)return new a("Invalid "+r+" `"+o+"` of type `"+l+"` supplied to `"+i+"`, expected an object.");for(var c in s)if(has$1(s,c)){var u=e(s,c,i,r,o+"."+c,ReactPropTypesSecret_1);if(u instanceof Error)return u}return null}))},oneOf:function(e){if(!Array.isArray(e))return arguments.length>1?printWarning$1("Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z])."):printWarning$1("Invalid argument supplied to oneOf, expected an array."),emptyFunctionThatReturnsNull;return l((function(t,n,i,r,o){for(var l=t[n],c=0;c<e.length;c++)if(s(l,e[c]))return null;var u=JSON.stringify(e,(function(e,t){return"symbol"===d(t)?String(t):t}));return new a("Invalid "+r+" `"+o+"` of value `"+String(l)+"` supplied to `"+i+"`, expected one of "+u+".")}))},oneOfType:function(e){if(!Array.isArray(e))return printWarning$1("Invalid argument supplied to oneOfType, expected an instance of array."),emptyFunctionThatReturnsNull;for(var t=0;t<e.length;t++){var n=e[t];if("function"!=typeof n)return printWarning$1("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+p(n)+" at index "+t+"."),emptyFunctionThatReturnsNull}return l((function(t,n,i,r,o){for(var s=0;s<e.length;s++){if(null==(0,e[s])(t,n,i,r,o,ReactPropTypesSecret_1))return null}return new a("Invalid "+r+" `"+o+"` supplied to `"+i+"`.")}))},shape:function(e){return l((function(t,n,i,r,o){var s=t[n],l=h(s);if("object"!==l)return new a("Invalid "+r+" `"+o+"` of type `"+l+"` supplied to `"+i+"`, expected `object`.");for(var c in e){var u=e[c];if(u){var d=u(s,c,i,r,o+"."+c,ReactPropTypesSecret_1);if(d)return d}}return null}))},exact:function(e){return l((function(t,n,i,r,o){var s=t[n],l=h(s);if("object"!==l)return new a("Invalid "+r+" `"+o+"` of type `"+l+"` supplied to `"+i+"`, expected `object`.");var c=objectAssign({},t[n],e);for(var u in c){var d=e[u];if(!d)return new a("Invalid "+r+" `"+o+"` key `"+u+"` supplied to `"+i+"`.\nBad object: "+JSON.stringify(t[n],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var p=d(s,u,i,r,o+"."+u,ReactPropTypesSecret_1);if(p)return p}return null}))}};function s(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function a(e){this.message=e,this.stack=""}function l(e){var n={},i=0;function o(o,s,l,c,u,h,d){if(c=c||r,h=h||l,d!==ReactPropTypesSecret_1){if(t){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}if("undefined"!=typeof console){var f=c+":"+l;!n[f]&&i<3&&(printWarning$1("You are manually calling a React.PropTypes validation function for the `"+h+"` prop on `"+c+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),n[f]=!0,i++)}}return null==s[l]?o?null===s[l]?new a("The "+u+" `"+h+"` is marked as required in `"+c+"`, but its value is `null`."):new a("The "+u+" `"+h+"` is marked as required in `"+c+"`, but its value is `undefined`."):null:e(s,l,c,u,h)}var s=o.bind(null,!1);return s.isRequired=o.bind(null,!0),s}function c(e){return l((function(t,n,i,r,o,s){var l=t[n];return h(l)!==e?new a("Invalid "+r+" `"+o+"` of type `"+d(l)+"` supplied to `"+i+"`, expected `"+e+"`."):null}))}function u(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(u);if(null===t||e(t))return!0;var r=function(e){var t=e&&(n&&e[n]||e[i]);if("function"==typeof t)return t}(t);if(!r)return!1;var o,s=r.call(t);if(r!==t.entries){for(;!(o=s.next()).done;)if(!u(o.value))return!1}else for(;!(o=s.next()).done;){var a=o.value;if(a&&!u(a[1]))return!1}return!0;default:return!1}}function h(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||!!t&&("Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol)}(t,e)?"symbol":t}function d(e){if(null==e)return""+e;var t=h(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function p(e){var t=d(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}return a.prototype=Error.prototype,o.checkPropTypes=checkPropTypes_1,o.resetWarningCache=checkPropTypes_1.resetWarningCache,o.PropTypes=o,o},propTypes=createCommonjsModule((function(e){var t=reactIs;e.exports=factoryWithTypeCheckers(t.isElement,!0)}));const ReaderContext=React__default.createContext(),defaultState={size:0,type:null,pages:[],ready:!1,focus:!1,hover:!1,error:null,totalPages:0,isLastPage:!1,isFirstPage:!0,currentPage:null,currentZoom:null,canZoomIn:!1,canZoomOut:!1,renderError:!1},defaultSettings={theme:"Dark",mangaMode:!1,bookMode:!1,fullscreen:!1,showControls:!1,autoHideControls:!1,allowGlobalShortcuts:!1};class ReaderProvider extends React.Component{constructor(...e){super(...e),_defineProperty(this,"state",{...defaultState,...defaultSettings,...this.props.defaultState}),_defineProperty(this,"updateState",(e,t)=>{this.setState(e,t)}),_defineProperty(this,"clear",()=>{this.setState({...defaultState})}),_defineProperty(this,"toggleSetting",e=>{this.setState(t=>({[e]:!t[e]}))}),_defineProperty(this,"createPage",e=>{const t=this.state.pages.concat(e);0===e.index?this.setState({ready:!0,error:null,currentPage:0,pages:t}):this.setState({pages:t})}),_defineProperty(this,"trigger",(e,t)=>{"error"===e&&t&&(console.error(t),this.setState({ready:!1,error:t})),"loaded"===e&&t&&this.setState({...t})}),_defineProperty(this,"togglePin",()=>{this.setState(e=>({autoHideControls:!e.autoHideControls}))}),_defineProperty(this,"toggleTheme",()=>{this.setState(e=>({theme:"Light"===e.theme?"Dark":"Light"}))}),_defineProperty(this,"navigateToPage",e=>{this.setState(t=>{const{totalPages:n}=t,i=n-1;return e<0||e>i?{}:{isLastPage:e===i,isFirstPage:0===e,currentPage:e}})}),_defineProperty(this,"navigateForward",()=>{const{isLastPage:e,currentPage:t}=this.state;e||this.navigateToPage(t+1)}),_defineProperty(this,"navigateBackward",()=>{const{isFirstPage:e,currentPage:t}=this.state;e||this.navigateToPage(t-1)}),_defineProperty(this,"getPage",e=>{const{pages:t,bookMode:n,mangaMode:i,totalPages:r}=this.state,o=t[e],s=e+1;if(n&&((s>=0||s<r)&&!(0===e||e===r-1))){const e=t[s];return i?[e,o]:[o,e]}return o})}toggleControls(e=!0){this.setState({showControls:e})}render(){return React__default.createElement(ReaderContext.Provider,{value:{state:this.state,clear:this.clear,trigger:this.trigger,getPage:this.getPage,togglePin:this.togglePin,createPage:this.createPage,updateState:this.updateState,toggleTheme:this.toggleTheme,toggleSetting:this.toggleSetting,navigateToPage:this.navigateToPage,navigateForward:this.navigateForward,navigateBackward:this.navigateBackward}},this.props.children)}}const Wrapp=({children:e,width:t,height:n,preview:i})=>{const r=React.useContext(ReaderContext),o=React.useRef(null),{theme:s,fullscreen:a,autoHideControls:l}=r.state,c={width:t,height:n};return React__default.createElement("div",{ref:o,className:clsx("villain",s,a&&"villain-fullscreen",!l&&"villain--static"),style:c},e(o?o.current:null))};var Wrapp$1=React__default.memo(Wrapp);class CompressedFile{constructor(e,t,n,i){this._name=e,this._size=t,this._path=n,this._archiveRef=i}get name(){return this._name}get size(){return this._size}extract(){return this._archiveRef.extractSingleFile(this._path)}}class Archive{static init(e={}){return Archive._options={workerUrl:"../dist/worker-bundle.js",...e},Archive._options}static open(e,t=null){return t=t||Archive._options||Archive.init()&&console.warn("Automatically initializing using options: ",Archive._options),new Archive(e,t).open()}constructor(e,t){this._worker=new Worker(t.workerUrl),this._worker.addEventListener("message",this._workerMsg.bind(this)),this._callbacks=[],this._content={},this._processed=0,this._file=e}async open(){return await this._postMessage({type:"HELLO"},(e,t,n)=>{"READY"===n.type&&e()}),await this._postMessage({type:"OPEN",file:this._file},(e,t,n)=>{"OPENED"===n.type&&e(this)})}hasEncryptedData(){return this._postMessage({type:"CHECK_ENCRYPTION"},(e,t,n)=>{"ENCRYPTION_STATUS"===n.type&&e(n.status)})}usePassword(e){return this._postMessage({type:"SET_PASSPHRASE",passphrase:e},(e,t,n)=>{"PASSPHRASE_STATUS"===n.type&&e(n.status)})}getFilesObject(){return this._processed>0?Promise.resolve().then(()=>this._content):this._postMessage({type:"LIST_FILES"},(e,t,n)=>{if("ENTRY"===n.type){const e=n.entry,[t,i]=this._getProp(this._content,e.path);return"FILE"===e.type&&(t[i]=new CompressedFile(e.fileName,e.size,e.path,this)),!0}"END"===n.type&&(this._processed=1,e(this._cloneContent(this._content)))})}getFilesArray(){return this.getFilesObject().then(e=>this._objectToArray(e))}extractSingleFile(e){return this._postMessage({type:"EXTRACT_SINGLE_FILE",target:e},(e,t,n)=>{if("FILE"===n.type){e(new File([n.entry.fileData],n.entry.fileName,{type:"application/octet-stream"}))}})}extractFiles(e){return this._processed>1?Promise.resolve().then(()=>this._content):this._postMessage({type:"EXTRACT_FILES"},(t,n,i)=>{if("ENTRY"===i.type){const[t,n]=this._getProp(this._content,i.entry.path);return"FILE"===i.entry.type&&(t[n]=new File([i.entry.fileData],i.entry.fileName,{type:"application/octet-stream"}),void 0!==e&&setTimeout(e.bind(null,{file:t[n],path:i.entry.path}))),!0}"END"===i.type&&(this._processed=2,this._worker.terminate(),t(this._cloneContent(this._content)))})}_cloneContent(e){if(e instanceof File||e instanceof CompressedFile||null===e)return e;const t={};for(const n of Object.keys(e))t[n]=this._cloneContent(e[n]);return t}_objectToArray(e,t=""){const n=[];for(const i of Object.keys(e))e[i]instanceof File||e[i]instanceof CompressedFile||null===e[i]?n.push({file:e[i]||i,path:t}):n.push(...this._objectToArray(e[i],`${t}${i}/`));return n}_getProp(e,t){const n=t.split("/");""===n[n.length-1]&&n.pop();let i=e,r=null;for(const e of n)i[e]=i[e]||{},r=i,i=i[e];return[r,n[n.length-1]]}_postMessage(e,t){return this._worker.postMessage(e),new Promise((e,n)=>{this._callbacks.push(this._msgHandler.bind(this,t,e,n))})}_msgHandler(e,t,n,i){if("BUSY"===i.type)n("worker is busy");else{if("ERROR"!==i.type)return e(t,n,i);n(i.error)}}_workerMsg({data:e}){(0,this._callbacks[this._callbacks.length-1])(e)||this._callbacks.pop()}}var utils=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getInterfaceLanguage=function(){if("undefined"==typeof navigator)return"en-US";var e=navigator;if(e){if(e.language)return e.language;if(e.languages&&e.languages[0])return e.languages[0];if(e.userLanguage)return e.userLanguage;if(e.browserLanguage)return e.browserLanguage}return"en-US"},t.getBestMatchingLanguage=function(e,t){if(t[e])return e;var n=e.indexOf("-"),i=n>=0?e.substring(0,n):e;return t[i]?i:Object.keys(t)[0]},t.validateTranslationKeys=function(e){var t=["_interfaceLanguage","_language","_defaultLanguage","_defaultLanguageFirstLevelKeys","_props"];e.forEach((function(e){if(-1!==t.indexOf(e))throw new Error(e+" cannot be used as a key. It is a reserved word.")}))},t.randomPseudo=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<e;i+=1)t+=n.charAt(Math.floor(Math.random()*n.length));return t}}));unwrapExports(utils);var utils_1=utils.getInterfaceLanguage,utils_2=utils.getBestMatchingLanguage,utils_3=utils.validateTranslationKeys,utils_4=utils.randomPseudo,LocalizedStrings_1=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(utils);var a=/(\{[\d|\w]+\})/,l=/(\$ref\{[\w|.]+\})/,c=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"function"==typeof n&&(n={customLanguageInterface:n}),this._opts=r({},{customLanguageInterface:s.getInterfaceLanguage,pseudo:!1,pseudoMultipleLanguages:!1,logsEnabled:!0},n),this._interfaceLanguage=this._opts.customLanguageInterface(),this._language=this._interfaceLanguage,this.setContent(t)}return o(e,[{key:"setContent",value:function(e){var t=this,n=Object.keys(e),r=i(n,1)[0];this._defaultLanguage=r,this._defaultLanguageFirstLevelKeys=[],this._props=e,s.validateTranslationKeys(Object.keys(e[this._defaultLanguage])),Object.keys(this._props[this._defaultLanguage]).forEach((function(e){"string"==typeof t._props[t._defaultLanguage][e]&&t._defaultLanguageFirstLevelKeys.push(e)})),this.setLanguage(this._interfaceLanguage),this._opts.pseudo&&this._pseudoAllValues(this._props)}},{key:"_pseudoAllValues",value:function(e){var t=this;Object.keys(e).forEach((function(i){if("object"===n(e[i]))t._pseudoAllValues(e[i]);else if("string"==typeof e[i]){if(0===e[i].indexOf("[")&&e[i].lastIndexOf("]")===e[i].length-1)return;for(var r=e[i].split(" "),o=0;o<r.length;o+=1)if(r[o].match(a));else if(r[o].match(l));else{var c=r[o].length;t._opts.pseudoMultipleLanguages&&(c=parseInt(1.4*c,10)),r[o]=s.randomPseudo(c)}e[i]="["+r.join(" ")+"]"}}))}},{key:"setLanguage",value:function(e){var t=this,n=s.getBestMatchingLanguage(e,this._props),i=Object.keys(this._props)[0];if(this._language=n,this._props[n]){for(var o=0;o<this._defaultLanguageFirstLevelKeys.length;o+=1)delete this[this._defaultLanguageFirstLevelKeys[o]];var a=r({},this._props[this._language]);Object.keys(a).forEach((function(e){t[e]=a[e]})),i!==this._language&&(a=this._props[i],this._fallbackValues(a,this))}}},{key:"_fallbackValues",value:function(e,t){var n=this;Object.keys(e).forEach((function(i){Object.prototype.hasOwnProperty.call(e,i)&&!t[i]&&""!==t[i]?(t[i]=e[i],n._opts.logsEnabled&&console.log("ðŸš§ ðŸ‘· key '"+i+"' not found in localizedStrings for language "+n._language+" ðŸš§")):"string"!=typeof t[i]&&n._fallbackValues(e[i],t[i])}))}},{key:"getLanguage",value:function(){return this._language}},{key:"getInterfaceLanguage",value:function(){return this._interfaceLanguage}},{key:"getAvailableLanguages",value:function(){var e=this;return this._availableLanguages||(this._availableLanguages=[],Object.keys(this._props).forEach((function(t){e._availableLanguages.push(t)}))),this._availableLanguages}},{key:"formatString",value:function(e){for(var t=this,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var o=e||"";"string"==typeof o&&(o=this.getString(e,null,!0)||o);var s=o.split(l).filter((function(e){return!!e})).map((function(n){if(n.match(l)){var i=n.slice(5,-1),r=t.getString(i);return r||(t._opts.logsEnabled&&console.log("No Localization ref found for '"+n+"' in string '"+e+"'"),"$ref(id:"+i+")")}return n})).join("");return s.split(a).filter((function(e){return!!e})).map((function(e){if(e.match(a)){var t=e.slice(1,-1),n=i[t];if(void 0===n){var r=i[0][t];if(void 0===r)return n;n=r}return n}return e})).join("")}},{key:"getString",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{for(var i=this._props[t||this._language],r=e.split("."),o=0;o<r.length;o+=1){if(void 0===i[r[o]])throw Error(r[o]);i=i[r[o]]}return i}catch(i){!n&&this._opts.logsEnabled&&console.log("No localization found for key '"+e+"' and language '"+t+"', failed on "+i.message)}return null}},{key:"getContent",value:function(){return this._props}}]),e}();t.default=c}));unwrapExports(LocalizedStrings_1);var LocalizedStrings=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},i=o(React__default),r=o(LocalizedStrings_1);function o(e){return e&&e.__esModule?e:{default:e}}var s=/(\{[\d|\w]+\})/;r.default.prototype.formatString=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];var a=!1,l=(e||"").split(s).filter((function(e){return!!e})).map((function(e,t){if(e.match(s)){var o=e.slice(1,-1),l=r[o];if(null==l){var c=r[0][o];if(void 0===c)return l;l=c}return i.default.isValidElement(l)?(a=!0,i.default.Children.toArray(l).map((function(e){return n({},e,{key:t.toString()})}))):l}return e}));return a?l:l.join("")},t.default=r.default})),LocalizedStrings$1=unwrapExports(LocalizedStrings),Page="Seite",DE={"Previous page":"Vorherige Seite","Next page":"NÃ¤chste Seite",Page:Page,"Pin controls":"Steuerung anheften","Enter fullscreen":"Vollbildmodus Ã¶ffnen","Exit fullscreen":"Vollbildmodus beenden","Book view":"Buchansicht","Page view":"Seitenansicht","Light theme":"Tagmodus","Dark theme":"Nachtmodus","Zoom in":"VergrÃ¶ÃŸern","Zoom out":"Verkleinern","Example test":"Beispiel Test!","Cant open archive":"Archiv kann nicht geÃ¶ffnet werden!","Invalid image":"UngÃ¼ltiges Bild!"},Page$1="Page",EN={"Previous page":"Previous page","Next page":"Next page",Page:Page$1,"Pin controls":"Pin controls","Enter fullscreen":"Enter fullscreen","Exit fullscreen":"Exit fullscreen","Book view":"Book view","Page view":"Page view","Light theme":"Light theme","Dark theme":"Dark theme","Zoom in":"Zoom in","Zoom out":"Zoom out","Example test":"Example test!","Cant open archive":"Can't open archive!","Invalid image":"Invalid image!"},Page$2="PÃ¡gina",ES={"Previous page":"Anterior","Next page":"Siguiente",Page:Page$2,"Pin controls":"Fijar controles","Enter fullscreen":"Pantalla completa","Exit fullscreen":"Salir de pantalla completa","Book view":"Modo libro","Page view":"Modo pÃ¡gina","Light theme":"Tema claro","Dark theme":"Tema oscuro","Zoom in":"Ampliar","Zoom out":"Reducir","Example test":"Â¡Test de ejemplo!","Cant open archive":"Â¡No se puede abrir el archivo!","Invalid image":"Â¡La imagen no es vÃ¡lida!"},Page$3="Page",FR={"Previous page":"Page prÃ©cÃ©dente","Next page":"Page suivante",Page:Page$3,"Pin controls":"Commandes Pin","Enter fullscreen":"Entrer en plein Ã©cran","Exit fullscreen":"Quitter le plein Ã©cran","Book view":"Vue du livre","Page view":"Page vue","Light theme":"ThÃ¨me lumiÃ¨re","Dark theme":"ThÃ¨me sombre","Zoom in":"Zoom avant","Zoom out":"Zoom arriÃ¨re","Example test":"Exemple de test!","Cant open archive":"Impossible d'ouvrir l'archive!","Invalid image":"Image invalide!"},Page$4="PÃ¡gina",PT={"Previous page":"PÃ¡gina anterior","Next page":"PrÃ³xima pÃ¡gina",Page:Page$4,"Pin controls":"Fixar ferramentas","Enter fullscreen":"Ativar tela cheia","Exit fullscreen":"Desativar tela cheia","Book view":"VisÃ£o de pÃ¡gina dupla","Page view":"VisÃ£o de pÃ¡gina Ãºnica","Light theme":"Ativar tema claro","Dark theme":"Ativar tema escuro","Zoom in":"Aumentar zoom","Zoom out":"Diminuir zoom","Example test":"Teste de exemplo!","Cant open archive":"NÃ£o Ã© possÃ­vel abrir o arquivo!","Invalid image":"Imagem invÃ¡lida!"},Page$5="Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ†Ð°",RU={"Previous page":"ÐŸÑ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð°Ñ","Next page":"Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ",Page:Page$5,"Pin controls":"Ð—Ð°ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²","Enter fullscreen":"ÐÐ° Ð²ÐµÑÑŒ ÑÐºÑ€Ð°Ð½","Exit fullscreen":"Ð’Ñ‹Ð¹Ñ‚Ð¸ Ð¸Ð· Ð¿Ð¾Ð»Ð½Ð¾ÑÐºÑ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼Ð°","Book view":"ÐšÐ½Ð¸Ð¶Ð½Ñ‹Ð¹ Ð²Ð¸Ð´","Page view":"Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ‡Ð½Ñ‹Ð¹ Ð²Ð¸Ð´","Light theme":"Ð¡Ð²ÐµÑ‚Ð»Ð°Ñ Ñ‚ÐµÐ¼Ð°","Dark theme":"Ð¢ÐµÐ¼Ð½Ð°Ñ Ñ‚ÐµÐ¼Ð°","Zoom in":"Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ","Zoom out":"Ð£Ð¼ÐµÐ½ÑŒÑˆÐ¸Ñ‚ÑŒ","Example test":"Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¸Ð¼ÐµÑ€!","Cant open archive":"ÐÐµ Ð¼Ð¾Ð³Ñƒ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð°Ñ€Ñ…Ð¸Ð²!","Invalid image":"ÐÐµÐ²ÐµÑ€Ð½Ð¾Ðµ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ!"};const localize=new LocalizedStrings$1({EN:EN,DE:DE,ES:ES,FR:FR,PT:PT,RU:RU}),regexImage=new RegExp(/^[a-zA-Z0-9_@()-][a-zA-Z0-9_.@()-\s]+.(jpeg|jpg|png|bpm|webp)$/),status=e=>e.status>=200&&e.status<300?Promise.resolve(e):Promise.reject(new Error(e.statusText)),isValidImageType=e=>regexImage.test(e),fetchArchive=(e,t,n)=>{fetch(e,{mode:"cors"}).then(status).then(e=>{e.headers.get("Content-Type");return e.blob()}).then(t).catch(e=>{n&&n(localize["Cant open archive"]),console.error("Request failed",e)})},asyncForEach=async(e,t)=>{for(let n=0;n<e.length;n++)await t(e[n],n,e)},getKeyByValue=(e,t)=>Object.keys(e).find(n=>e[n]===t);var Icon=createCommonjsModule((function(e){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=propTypes},function(e,t){e.exports=React__default},function(e,t,n){n.r(t);var i=n(1),r=n(0),o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},s=0,a=i.forwardRef((function(e,t){var n=e.title,r=void 0===n?null:n,a=e.description,l=void 0===a?null:a,c=e.size,u=void 0===c?null:c,h=e.color,d=void 0===h?null:h,p=e.horizontal,f=void 0===p?null:p,m=e.vertical,g=void 0===m?null:m,v=e.rotate,y=void 0===v?null:v,w=e.spin,b=void 0===w?null:w,S=e.style,T=void 0===S?{}:S,_=e.children,x=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n}(e,["title","description","size","color","horizontal","vertical","rotate","spin","style","children"]);s++;var E,P=null!==b&&b,R=i.Children.map(_,(function(e){var t=e;!0!==P&&(P=!0===(null===b?t.props.spin:b));var n=t.props.size;"number"==typeof u&&"number"==typeof t.props.size&&(n=t.props.size/u);var r={size:n,color:null===d?t.props.color:d,horizontal:null===f?t.props.horizontal:f,vertical:null===g?t.props.vertical:g,rotate:null===y?t.props.rotate:y,spin:null===b?t.props.spin:b,inStack:!0};return i.cloneElement(t,r)}));null!==u&&(T.width="string"==typeof u?u:1.5*u+"rem");var C,O="stack_labelledby_"+s,k="stack_describedby_"+s;if(r)E=l?O+" "+k:O;else if(C="presentation",l)throw new Error("title attribute required when description is set");return i.createElement("svg",o({ref:t,viewBox:"0 0 24 24",style:T,role:C,"aria-labelledby":E},x),r&&i.createElement("title",{id:O},r),l&&i.createElement("desc",{id:k},l),P&&i.createElement("style",null,"@keyframes spin { to { transform: rotate(360deg) } }","@keyframes spin-inverse { to { transform: rotate(-360deg) } }"),R)}));a.displayName="Stack",a.propTypes={size:r.oneOfType([r.number,r.string]),color:r.string,horizontal:r.bool,vertical:r.bool,rotate:r.number,spin:r.oneOfType([r.bool,r.number]),children:r.oneOfType([r.arrayOf(r.node),r.node]).isRequired,className:r.string,style:r.object},a.defaultProps={size:null,color:null,horizontal:null,vertical:null,rotate:null,spin:null};var l=a;n.d(t,"Icon",(function(){return h})),n.d(t,"Stack",(function(){return l}));var c=function(){return(c=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},u=0,h=i.forwardRef((function(e,t){var n=e.path,r=e.title,o=void 0===r?null:r,s=e.description,a=void 0===s?null:s,l=e.size,h=void 0===l?null:l,d=e.color,p=void 0===d?null:d,f=e.horizontal,m=void 0!==f&&f,g=e.vertical,v=void 0!==g&&g,y=e.rotate,w=void 0===y?0:y,b=e.spin,S=void 0!==b&&b,T=e.style,_=void 0===T?{}:T,x=e.inStack,E=void 0!==x&&x,P=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&(n[i[r]]=e[i[r]])}return n}(e,["path","title","description","size","color","horizontal","vertical","rotate","spin","style","inStack"]);u++;var R={},C=[];null!==h&&(E?C.push("scale("+h+")"):(_.width="string"==typeof h?h:1.5*h+"rem",_.height=_.width)),m&&C.push("scaleX(-1)"),v&&C.push("scaleY(-1)"),0!==w&&C.push("rotate("+w+"deg)"),null!==p&&(R.fill=p);var O=i.createElement("path",c({d:n,style:R},E?P:{})),k=O;C.length>0&&(_.transform=C.join(" "),_.transformOrigin="center",E&&(k=i.createElement("g",{style:_},O,i.createElement("rect",{width:"24",height:"24",fill:"transparent"}))));var M,I=k,D=!0===S||"number"!=typeof S?2:S,L=!E&&(m||v);if(D<0&&(L=!L),S&&(I=i.createElement("g",{style:{animation:"spin"+(L?"-inverse":"")+" linear "+Math.abs(D)+"s infinite",transformOrigin:"center"}},k,!(m||v||0!==w)&&i.createElement("rect",{width:"24",height:"24",fill:"transparent"}))),E)return I;var H,A="icon_labelledby_"+u,B="icon_describedby_"+u;if(o)M=a?A+" "+B:A;else if(H="presentation",a)throw new Error("title attribute required when description is set");return i.createElement("svg",c({ref:t,viewBox:"0 0 24 24",style:_,role:H,"aria-labelledby":M},P),o&&i.createElement("title",{id:A},o),a&&i.createElement("desc",{id:B},a),!E&&S&&(L?i.createElement("style",null,"@keyframes spin-inverse { to { transform: rotate(-360deg) } }"):i.createElement("style",null,"@keyframes spin { to { transform: rotate(360deg) } }")),I)}));h.displayName="Icon",h.propTypes={path:r.string.isRequired,size:r.oneOfType([r.number,r.string]),color:r.string,horizontal:r.bool,vertical:r.bool,rotate:r.number,spin:r.oneOfType([r.bool,r.number]),style:r.object,inStack:r.bool,className:r.string},h.defaultProps={size:null,color:null,horizontal:!1,vertical:!1,rotate:0,spin:!1},t.default=h}])})),Icon$1=unwrapExports(Icon);const Error$1=React__default.memo(e=>{const{icon:t,message:n}=e;return React__default.createElement("div",{className:"villain-overlay villain-overlay--canvas"},React__default.createElement(Icon$1,{className:"villain-icon",path:t,size:3}),React__default.createElement("div",{className:"villain-overlay--message"},React__default.createElement("h3",null,n)))}),Loader=({id:e})=>React__default.createElement("div",{className:"villain-overlay",id:e},React__default.createElement("div",{className:"villain-loader-indicator"}));var Loader$1=React__default.memo(Loader),mdiBookOpen="M13,12H20V13.5H13M13,9.5H20V11H13M13,14.5H20V16H13M21,4H3A2,2 0 0,0 1,6V19A2,2 0 0,0 3,21H21A2,2 0 0,0 23,19V6A2,2 0 0,0 21,4M21,19H12V6H21",mdiBookOpenOutline="M21,4H3A2,2 0 0,0 1,6V19A2,2 0 0,0 3,21H21A2,2 0 0,0 23,19V6A2,2 0 0,0 21,4M3,19V6H11V19H3M21,19H13V6H21V19M14,9.5H20V11H14V9.5M14,12H20V13.5H14V12M14,14.5H20V16H14V14.5Z",mdiChevronLeft="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z",mdiChevronRight="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z",mdiFileAlert="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M10,18H8V16H10V18M10,14H8V9H10V14M13,9V3.5L18.5,9H13Z",mdiFullscreen="M5,5H10V7H7V10H5V5M14,5H19V10H17V7H14V5M17,14H19V19H14V17H17V14M10,17V19H5V14H7V17H10Z",mdiFullscreenExit="M14,14H19V16H16V19H14V14M5,14H10V19H8V16H5V14M8,5H10V10H5V8H8V5M19,8V10H14V5H16V8H19Z",mdiImageBrokenVariant="M21,5V11.59L18,8.58L14,12.59L10,8.59L6,12.59L3,9.58V5A2,2 0 0,1 5,3H19A2,2 0 0,1 21,5M18,11.42L21,14.43V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V12.42L6,15.41L10,11.41L14,15.41",mdiMinus="M19,13H5V11H19V13Z",mdiPin="M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z",mdiPlus="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z",mdiSettings="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z",mdiWeatherNight="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4L13.5,1L14.56,4L17.75,4.09M21.25,11L19.61,12.25L20.2,14.23L18.5,13.06L16.8,14.23L17.39,12.25L15.75,11L17.81,10.95L18.5,9L19.19,10.95L21.25,11M18.97,15.95C19.8,15.87 20.69,17.05 20.16,17.8C19.84,18.25 19.5,18.67 19.08,19.07C15.17,23 8.84,23 4.94,19.07C1.03,15.17 1.03,8.83 4.94,4.93C5.34,4.53 5.76,4.17 6.21,3.85C6.96,3.32 8.14,4.21 8.06,5.04C7.79,7.9 8.75,10.87 10.95,13.06C13.14,15.26 16.1,16.22 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C7.36,12.31 6.2,9.5 6.04,6.68C3.23,9.82 3.34,14.64 6.35,17.66C9.37,20.67 14.19,20.78 17.33,17.97Z",mdiWhiteBalanceSunny="M3.55,18.54L4.96,19.95L6.76,18.16L5.34,16.74M11,22.45C11.32,22.45 13,22.45 13,22.45V19.5H11M12,5.5A6,6 0 0,0 6,11.5A6,6 0 0,0 12,17.5A6,6 0 0,0 18,11.5C18,8.18 15.31,5.5 12,5.5M20,12.5H23V10.5H20M17.24,18.16L19.04,19.95L20.45,18.54L18.66,16.74M20.45,4.46L19.04,3.05L17.24,4.84L18.66,6.26M13,0.55H11V3.5H13M4,10.5H1V12.5H4M6.76,4.84L4.96,3.05L3.55,4.46L5.34,6.26L6.76,4.84Z",jasmineUtils=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.equals=function(e,t,n,a){return function e(t,n,o,s,a,c){var u=!0;var h=function(e,t){var n=i(e),r=i(t);if(n&&r)return;if(n)return e.asymmetricMatch(t);if(r)return t.asymmetricMatch(e)}(t,n);if(void 0!==h)return h;for(var d=0;d<a.length;d++){var p=a[d](t,n);if(void 0!==p)return p}if(t instanceof Error&&n instanceof Error)return t.message==n.message;if(Object.is(t,n))return!0;if(null===t||null===n)return t===n;var f=Object.prototype.toString.call(t);if(f!=Object.prototype.toString.call(n))return!1;switch(f){case"[object String]":return t==String(n);case"[object Number]":return Object.is(Number(t),Number(n));case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;if(l(t)&&l(n))return t.isEqualNode(n);var m=o.length;for(;m--;){if(o[m]===t)return s[m]===n;if(s[m]===n)return!1}o.push(t);s.push(n);var g=0;if("[object Array]"==f){if((g=t.length)!==n.length)return!1;for(;g--;)if(!(u=e(t[g],n[g],o,s,a,c)))return!1}var v,y=r(t,"[object Array]"==f,c);g=y.length;if(r(n,"[object Array]"==f,c).length!==g)return!1;for(;g--;)if(v=y[g],!(u=c(n,v)&&e(t[v],n[v],o,s,a,c)))return!1;o.pop();s.pop();return u}(e,t,[],[],n=n||[],a?s:o)},t.isA=a,t.fnNameFor=function(e){if(e.name)return e.name;const t=n.call(e).match(/^(?:async)?\s*function\s*\*?\s*([\w$]+)\s*\(/);return t?t[1]:"<anonymous>"},t.isUndefined=function(e){return void 0===e},t.hasProperty=function e(t,n){if(!t)return!1;if(Object.prototype.hasOwnProperty.call(t,n))return!0;return e(function(e){if(Object.getPrototypeOf)return Object.getPrototypeOf(e);if(e.constructor.prototype==e)return null;return e.constructor.prototype}(t),n)},t.isImmutableUnorderedKeyed=function(e){return!(!e||!e[c]||e[h])},t.isImmutableUnorderedSet=function(e){return!(!e||!e[u]||e[h])};const n=Function.prototype.toString;function i(e){return!!e&&a("Function",e.asymmetricMatch)}function r(e,t,n){var i=function(e){var t=[];for(var i in e)n(e,i)&&t.push(i);return t.concat(Object.getOwnPropertySymbols(e).filter(t=>Object.getOwnPropertyDescriptor(e,t).enumerable))}(e);if(!t)return i;var r=[];if(0===i.length)return i;for(var o=0;o<i.length;o++)"symbol"!=typeof i[o]&&i[o].match(/^[0-9]+$/)||r.push(i[o]);return r}function o(e,t){return s(e,t)&&void 0!==e[t]}function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function a(e,t){return Object.prototype.toString.apply(t)==="[object "+e+"]"}function l(e){return null!==e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName&&"function"==typeof e.isEqualNode}const c="@@__IMMUTABLE_KEYED__@@",u="@@__IMMUTABLE_SET__@@",h="@@__IMMUTABLE_ORDERED__@@"}));unwrapExports(jasmineUtils);var jasmineUtils_1=jasmineUtils.equals,jasmineUtils_2=jasmineUtils.isA,jasmineUtils_3=jasmineUtils.fnNameFor,jasmineUtils_4=jasmineUtils.isUndefined,jasmineUtils_5=jasmineUtils.hasProperty,jasmineUtils_6=jasmineUtils.isImmutableUnorderedKeyed,jasmineUtils_7=jasmineUtils.isImmutableUnorderedSet;function getType(e){if(void 0===e)return"undefined";if(null===e)return"null";if(Array.isArray(e))return"array";if("boolean"==typeof e)return"boolean";if("function"==typeof e)return"function";if("number"==typeof e)return"number";if("string"==typeof e)return"string";if("object"==typeof e){if(null!=e){if(e.constructor===RegExp)return"regexp";if(e.constructor===Map)return"map";if(e.constructor===Set)return"set";if(e.constructor===Date)return"date"}return"object"}if("symbol"==typeof e)return"symbol";throw new Error(`value of unknown type: ${e}`)}getType.isPrimitive=e=>Object(e)!==e;var build=getType,utils$1=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.emptyObject=function(e){return!(!e||"object"!=typeof e)&&!Object.keys(e).length},t.isOneline=t.isError=t.partition=t.sparseArrayEquality=t.typeEquality=t.subsetEquality=t.iterableEquality=t.getObjectSubset=t.getPath=t.hasOwnProperty=void 0;var n=commonjsGlobal["jest-symbol-do-not-touch"]||commonjsGlobal.Symbol;const i=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)||((e,t)=>{const n=e.constructor;if(n===Object)return!1;if("function"!=typeof n)return!1;const i=Object.getOwnPropertyDescriptor(n.prototype,t);return void 0!==i&&"function"==typeof i.get})(e,t);t.hasOwnProperty=i;const r=(e,t)=>{if(Array.isArray(t)||(t=t.split(".")),t.length){const n=1===t.length,i=t[0],o=e[i];if(!n&&null==o)return{hasEndProp:!1,lastTraversedObject:e,traversedPath:[]};const s=r(o,t.slice(1));return null===s.lastTraversedObject&&(s.lastTraversedObject=e),s.traversedPath.unshift(i),n&&(s.hasEndProp=void 0!==o||!(0,build.isPrimitive)(e)&&i in e,s.hasEndProp||s.traversedPath.shift()),s}return{lastTraversedObject:null,traversedPath:[],value:e}};t.getPath=r;const o=(e,t,n=new WeakMap)=>{if(Array.isArray(e)){if(Array.isArray(t)&&t.length===e.length)return t.map((t,n)=>o(e[n],t))}else{if(e instanceof Date)return e;if(c(e)&&c(t)){const r={};if(n.set(e,r),Object.keys(e).filter(e=>i(t,e)).forEach(i=>{r[i]=n.has(e[i])?n.get(e[i]):o(e[i],t[i],n)}),Object.keys(r).length>0)return r}}return e};t.getObjectSubset=o;const s=n.iterator,a=e=>!(null==e||!e[s]),l=(e,t,i=[],r=[])=>{if("object"!=typeof e||"object"!=typeof t||Array.isArray(e)||Array.isArray(t)||!a(e)||!a(t))return;if(e.constructor!==t.constructor)return!1;let o=i.length;for(;o--;)if(i[o]===e)return r[o]===t;i.push(e),r.push(t);const c=(e,t)=>l(e,t,[...i],[...r]);if(void 0!==e.size){if(e.size!==t.size)return!1;if((0,jasmineUtils.isA)("Set",e)||(0,jasmineUtils.isImmutableUnorderedSet)(e)){let o=!0;var u=!0,h=!1,d=void 0;try{for(var p,f=e[n.iterator]();!(u=(p=f.next()).done);u=!0){const e=p.value;if(!t.has(e)){let i=!1;var m=!0,g=!1,v=void 0;try{for(var y,w=t[n.iterator]();!(m=(y=w.next()).done);m=!0){const t=y.value;!0===(0,jasmineUtils.equals)(e,t,[c])&&(i=!0)}}catch(e){g=!0,v=e}finally{try{m||null==w.return||w.return()}finally{if(g)throw v}}if(!1===i){o=!1;break}}}}catch(e){h=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(h)throw d}}return i.pop(),r.pop(),o}if((0,jasmineUtils.isA)("Map",e)||(0,jasmineUtils.isImmutableUnorderedKeyed)(e)){let o=!0;var b=!0,S=!1,T=void 0;try{for(var _,x=e[n.iterator]();!(b=(_=x.next()).done);b=!0){const e=_.value;if(!t.has(e[0])||!(0,jasmineUtils.equals)(e[1],t.get(e[0]),[c])){let i=!1;var E=!0,P=!1,R=void 0;try{for(var C,O=t[n.iterator]();!(E=(C=O.next()).done);E=!0){const t=C.value,n=(0,jasmineUtils.equals)(e[0],t[0],[c]);let r=!1;!0===n&&(r=(0,jasmineUtils.equals)(e[1],t[1],[c])),!0===r&&(i=!0)}}catch(e){P=!0,R=e}finally{try{E||null==O.return||O.return()}finally{if(P)throw R}}if(!1===i){o=!1;break}}}}catch(e){S=!0,T=e}finally{try{b||null==x.return||x.return()}finally{if(S)throw T}}return i.pop(),r.pop(),o}}const k=t[s]();var M=!0,I=!1,D=void 0;try{for(var L,H=e[n.iterator]();!(M=(L=H.next()).done);M=!0){const e=L.value,t=k.next();if(t.done||!(0,jasmineUtils.equals)(e,t.value,[c]))return!1}}catch(e){I=!0,D=e}finally{try{M||null==H.return||H.return()}finally{if(I)throw D}}return!!k.next().done&&(i.pop(),r.pop(),!0)};t.iterableEquality=l;const c=e=>null!==e&&"object"==typeof e,u=e=>c(e)&&!(e instanceof Error)&&!(e instanceof Array)&&!(e instanceof Date);t.subsetEquality=(e,t)=>{const n=(e=new WeakMap)=>(t,r)=>{if(u(r))return Object.keys(r).every(o=>{if(u(r[o])){if(e.get(r[o]))return(0,jasmineUtils.equals)(t[o],r[o],[l]);e.set(r[o],!0)}return null!=t&&i(t,o)&&(0,jasmineUtils.equals)(t[o],r[o],[l,n(e)])})};return n()(e,t)};const h=(e,t)=>{if(null!=e&&null!=t&&e.constructor!==t.constructor)return!1};t.typeEquality=h;t.sparseArrayEquality=(e,t)=>{if(!Array.isArray(e)||!Array.isArray(t))return;const n=Object.keys(e),i=Object.keys(t);return(0,jasmineUtils.equals)(e,t,[l,h],!0)&&(0,jasmineUtils.equals)(n,i)};t.partition=(e,t)=>{const n=[[],[]];return e.forEach(e=>n[t(e)?0:1].push(e)),n};t.isError=e=>{switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return e instanceof Error}};const d=/[\r\n]/;t.isOneline=(e,t)=>!("string"!=typeof e||"string"!=typeof t||d.test(e)&&d.test(t))}));unwrapExports(utils$1);var utils_1$1=utils$1.emptyObject,utils_2$1=utils$1.isOneline,utils_3$1=utils$1.isError,utils_4$1=utils$1.partition,utils_5=utils$1.sparseArrayEquality,utils_6=utils$1.typeEquality,utils_7=utils$1.subsetEquality,utils_8=utils$1.iterableEquality,utils_9=utils$1.getObjectSubset,utils_10=utils$1.getPath,asymmetricMatchers=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.stringNotMatching=t.stringMatching=t.stringNotContaining=t.stringContaining=t.objectNotContaining=t.objectContaining=t.arrayNotContaining=t.arrayContaining=t.anything=t.any=t.AsymmetricMatcher=void 0;var n=commonjsGlobal["jest-symbol-do-not-touch"]||commonjsGlobal.Symbol;function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class r{constructor(e){i(this,"sample",void 0),i(this,"$$typeof",void 0),i(this,"inverse",void 0),this.$$typeof=n.for("jest.asymmetricMatcher"),this.sample=e}}t.AsymmetricMatcher=r;class o extends r{constructor(e){if(void 0===e)throw new TypeError("any() expects to be passed a constructor function. Please pass one or use anything() to match any object.");super(e)}asymmetricMatch(e){return this.sample==String?"string"==typeof e||e instanceof String:this.sample==Number?"number"==typeof e||e instanceof Number:this.sample==Function?"function"==typeof e||e instanceof Function:this.sample==Object?"object"==typeof e:this.sample==Boolean?"boolean"==typeof e:e instanceof this.sample}toString(){return"Any"}getExpectedType(){return this.sample==String?"string":this.sample==Number?"number":this.sample==Function?"function":this.sample==Object?"object":this.sample==Boolean?"boolean":(0,jasmineUtils.fnNameFor)(this.sample)}toAsymmetricMatcher(){return"Any<"+(0,jasmineUtils.fnNameFor)(this.sample)+">"}}class s extends r{asymmetricMatch(e){return!(0,jasmineUtils.isUndefined)(e)&&null!==e}toString(){return"Anything"}toAsymmetricMatcher(){return"Anything"}}class a extends r{constructor(e,t=!1){super(e),this.inverse=t}asymmetricMatch(e){if(!Array.isArray(this.sample))throw new Error(`You must provide an array to ${this.toString()}, not '`+typeof this.sample+"'.");const t=0===this.sample.length||Array.isArray(e)&&this.sample.every(t=>e.some(e=>(0,jasmineUtils.equals)(t,e)));return this.inverse?!t:t}toString(){return`Array${this.inverse?"Not":""}Containing`}getExpectedType(){return"array"}}class l extends r{constructor(e,t=!1){super(e),this.inverse=t}asymmetricMatch(e){if("object"!=typeof this.sample)throw new Error(`You must provide an object to ${this.toString()}, not '`+typeof this.sample+"'.");if(this.inverse){for(const t in this.sample)if((0,jasmineUtils.hasProperty)(e,t)&&(0,jasmineUtils.equals)(this.sample[t],e[t])&&!(0,utils$1.emptyObject)(this.sample[t])&&!(0,utils$1.emptyObject)(e[t]))return!1;return!0}for(const t in this.sample)if(!(0,jasmineUtils.hasProperty)(e,t)||!(0,jasmineUtils.equals)(this.sample[t],e[t]))return!1;return!0}toString(){return`Object${this.inverse?"Not":""}Containing`}getExpectedType(){return"object"}}class c extends r{constructor(e,t=!1){if(!(0,jasmineUtils.isA)("String",e))throw new Error("Expected is not a string");super(e),this.inverse=t}asymmetricMatch(e){const t=(0,jasmineUtils.isA)("String",e)&&e.includes(this.sample);return this.inverse?!t:t}toString(){return`String${this.inverse?"Not":""}Containing`}getExpectedType(){return"string"}}class u extends r{constructor(e,t=!1){if(!(0,jasmineUtils.isA)("String",e)&&!(0,jasmineUtils.isA)("RegExp",e))throw new Error("Expected is not a String or a RegExp");super(new RegExp(e)),this.inverse=t}asymmetricMatch(e){const t=(0,jasmineUtils.isA)("String",e)&&this.sample.test(e);return this.inverse?!t:t}toString(){return`String${this.inverse?"Not":""}Matching`}getExpectedType(){return"string"}}t.any=e=>new o(e);t.anything=()=>new s;t.arrayContaining=e=>new a(e);t.arrayNotContaining=e=>new a(e,!0);t.objectContaining=e=>new l(e);t.objectNotContaining=e=>new l(e,!0);t.stringContaining=e=>new c(e);t.stringNotContaining=e=>new c(e,!0);t.stringMatching=e=>new u(e);t.stringNotMatching=e=>new u(e,!0)}));unwrapExports(asymmetricMatchers);var asymmetricMatchers_1=asymmetricMatchers.stringNotMatching,asymmetricMatchers_2=asymmetricMatchers.stringMatching,asymmetricMatchers_3=asymmetricMatchers.stringNotContaining,asymmetricMatchers_4=asymmetricMatchers.stringContaining,asymmetricMatchers_5=asymmetricMatchers.objectNotContaining,asymmetricMatchers_6=asymmetricMatchers.objectContaining,asymmetricMatchers_7=asymmetricMatchers.arrayNotContaining,asymmetricMatchers_8=asymmetricMatchers.arrayContaining,asymmetricMatchers_9=asymmetricMatchers.anything,asymmetricMatchers_10=asymmetricMatchers.any,asymmetricMatchers_11=asymmetricMatchers.AsymmetricMatcher,jestMatchersObject=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.setMatchers=t.getMatchers=t.setState=t.getState=t.INTERNAL_MATCHER_FLAG=void 0;var n=commonjsGlobal["jest-symbol-do-not-touch"]||commonjsGlobal.Symbol;const i=n.for("$$jest-matchers-object"),r=n.for("$$jest-internal-matcher");t.INTERNAL_MATCHER_FLAG=r,commonjsGlobal.hasOwnProperty(i)||Object.defineProperty(commonjsGlobal,i,{value:{matchers:Object.create(null),state:{assertionCalls:0,expectedAssertionsNumber:null,isExpectingAssertions:!1,suppressedErrors:[]}}});t.getState=()=>commonjsGlobal[i].state;t.setState=e=>{Object.assign(commonjsGlobal[i].state,e)};t.getMatchers=()=>commonjsGlobal[i].matchers;t.setMatchers=(e,t,n)=>{Object.keys(e).forEach(i=>{const o=e[i];if(Object.defineProperty(o,r,{value:t}),!t){class e extends asymmetricMatchers.AsymmetricMatcher{constructor(e=!1,...t){super(t),this.inverse=e}asymmetricMatch(e){const t=o(e,...this.sample).pass;return this.inverse?!t:t}toString(){return`${this.inverse?"not.":""}${i}`}getExpectedType(){return"any"}toAsymmetricMatcher(){return`${this.toString()}<${this.sample.join(", ")}>`}}n[i]=(...t)=>new e(!1,...t),n.not||(n.not={}),n.not[i]=(...t)=>new e(!0,...t)}}),Object.assign(commonjsGlobal[i].matchers,e)}}));unwrapExports(jestMatchersObject);var jestMatchersObject_1=jestMatchersObject.setMatchers,jestMatchersObject_2=jestMatchersObject.getMatchers,jestMatchersObject_3=jestMatchersObject.setState,jestMatchersObject_4=jestMatchersObject.getState,jestMatchersObject_5=jestMatchersObject.INTERNAL_MATCHER_FLAG;const Uncompress=({file:e=null,workerUrl:t=null,preview:n=null,children:i})=>{const r=React.useContext(ReaderContext),{ready:o,error:s}=(React.useState({size:null,name:null,type:null}),r.state);React.useEffect(()=>(Archive.init({workerUrl:t}),()=>{c()}),[]),React.useEffect(()=>{if(!e)return void jestMatchersObject_3({name:null,size:null,type:null});const{name:t,size:n,type:i}=e;jestMatchersObject_3({name:t,size:n,type:i}),"string"==typeof e&&(r.clear(),a(e)),e instanceof Blob&&(r.clear(),l(e))},[e]);const a=e=>{fetchArchive(e,h,u)},l=e=>{h(e)},c=()=>{const{pages:e}=r.state;e&&e.length>0&&e.forEach(e=>{URL.revokeObjectURL(e.src)})},u=e=>{console.error(e),r.trigger("error",e.message||e)},h=async e=>{try{const t=await p(e);if(t&&t.length>0){const e=n?t.splice(0,n):t;await asyncForEach(e,async(e,t)=>{const n=await e.file.extract();d(n,t)})}else r.trigger("error",localize["Cant open archive"])}catch(e){console.error(e),u(e)}},d=(e,t)=>{const{size:n,name:i}=e,o={index:t,url:URL.createObjectURL(e),name:i,size:n,type:"image"};r.createPage(o)},p=async e=>{const t=await Archive.open(e),i=(await t.getFilesArray()).filter(e=>isValidImageType(e.file.name));i.length;const{type:o,size:s}=e,a={type:o,size:s,totalPages:n&&n<i.length?n:i.length};return r.trigger("loaded",a),i.length>0?i:null};return React__default.createElement(React__default.Fragment,null,s&&React__default.createElement(Error$1,{message:s.message||s,icon:mdiFileAlert})||(o?i:React__default.createElement(Loader$1,null)))};Uncompress.propTypes={file:propTypes.oneOfType([propTypes.string,propTypes.instanceOf(Blob)]),workerUrl:propTypes.string,preview:propTypes.number};var openseadragon=createCommonjsModule((function(module){function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}var root,factory,$,fullScreenApi;!function(e){e.version={versionStr:"2.4.1",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("1",10)};var t,n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,r=Object.prototype.hasOwnProperty;e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null==e?String(e):n[i.call(e)]||"object"},e.isPlainObject=function(t){if(!t||"object"!==OpenSeadragon.type(t)||t.nodeType||e.isWindow(t))return!1;if(t.constructor&&!r.call(t,"constructor")&&!r.call(t.constructor.prototype,"isPrototypeOf"))return!1;var n;for(var i in t)n=i;return void 0===n||r.call(t,n)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.freezeObject=function(t){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(e){return e},e.freezeObject(t)},e.supportsCanvas=(t=document.createElement("canvas"),!(!e.isFunction(t.getContext)||!t.getContext("2d"))),e.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){t=!0}return t},e.pixelDensityRatio=function(){if(e.supportsCanvas){var t=document.createElement("canvas").getContext("2d"),n=window.devicePixelRatio||1,i=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return Math.max(n,1)/i}return 1}()}(OpenSeadragon),function($){$.extend=function(){var e,t,n,i,r,o,s=arguments[0]||{},a=arguments.length,l=!1,c=1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},c=2),"object"==typeof s||OpenSeadragon.isFunction(s)||(s={}),a===c&&(s=this,--c);c<a;c++)if(null!==(e=arguments[c])||void 0!==e)for(t in e)n=s[t],s!==(i=e[t])&&(l&&i&&(OpenSeadragon.isPlainObject(i)||(r=OpenSeadragon.isArray(i)))?(r?(r=!1,o=n&&OpenSeadragon.isArray(n)?n:[]):o=n&&OpenSeadragon.isPlainObject(n)?n:{},s[t]=OpenSeadragon.extend(l,o,i)):void 0!==i&&(s[t]=i));return s};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var n=arguments;return void 0===n&&(n=[]),t.apply(e,n)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(e){var t,n,i=new $.Point;for(n=getOffsetParent(e=$.getElement(e),t="fixed"==$.getElementStyle(e).position);n;)i.x+=e.offsetLeft,i.y+=e.offsetTop,t&&(i=i.plus($.getPageScroll())),n=getOffsetParent(e=n,t="fixed"==$.getElementStyle(e).position);return i},getElementOffset:function(e){var t,n,i=(e=$.getElement(e))&&e.ownerDocument,r={top:0,left:0};return i?(t=i.documentElement,void 0!==e.getBoundingClientRect&&(r=e.getBoundingClientRect()),n=i==i.window?i:9===i.nodeType&&(i.defaultView||i.parentWindow),new $.Point(r.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0),r.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0))):new $.Point},getElementSize:function(e){return e=$.getElement(e),new $.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return(e=$.getElement(e)).currentStyle}:function(e){return e=$.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var t={};return $.getCssPropertyWithVendorPrefix=function(e){if(void 0!==t[e])return t[e];var n=document.createElement("div").style,i=null;if(void 0!==n[e])i=e;else for(var r=["Webkit","Moz","MS","O","webkit","moz","ms","o"],o=$.capitalizeFirstLetter(e),s=0;s<r.length;s++){var a=r[s]+o;if(void 0!==n[a]){i=a;break}}return t[e]=i,i},$.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var n=e%t;return n<0&&(n+=t),n},pointInElement:function(e,t){e=$.getElement(e);var n=$.getElementOffset(e),i=$.getElementSize(e);return t.x>=n.x&&t.x<n.x+i.x&&t.y<n.y+i.y&&t.y>=n.y},getEvent:function(e){return $.getEvent=e?function(e){return e}:function(){return window.event},$.getEvent(e)},getMousePosition:function(e){if("number"==typeof e.pageX)$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.pageX,t.y=e.pageY,t};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t}}return $.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(e){if(void 0!==window.scrollTo)$.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var t=$.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var n=$.getPageScroll();if(n.x!==t.x&&n.y!==t.y)return void($.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(n=$.getPageScroll()).x!==t.x&&n.y!==t.y)return void($.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});$.setPageScroll=function(e){}}return $.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!t.clientWidth&&!t.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(e){e=$.getElement(e);var t=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(t[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(t[1].style,{display:"table-row"}),$.extend(t[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),t[0].appendChild(t[1]),t[1].appendChild(t[2]),t[2].appendChild(e),t[0]},makeNeutralElement:function(e){var t=document.createElement(e),n=t.style;return n.background="transparent none",n.border="none",n.margin="0px",n.padding="0px",n.position="static",t},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(e){return $.makeTransparentImage=function(e){var t=$.makeNeutralElement("img");return t.src=e,t},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(e){var t=$.makeNeutralElement("img"),n=null;return(n=$.makeNeutralElement("span")).style.display="inline-block",t.onload=function(){n.style.width=n.style.width||t.width+"px",n.style.height=n.style.height||t.height+"px",t.onload=null,t=null},t.src=e,n.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",n}),$.makeTransparentImage(e)},setElementOpacity:function(e,t,n){var i;e=$.getElement(e),n&&!$.Browser.alpha&&(t=Math.round(t)),$.Browser.opacity?e.style.opacity=t<1?t:"":t<1?(i="alpha(opacity="+Math.round(100*t)+")",e.style.filter=i):e.style.filter=""},setElementTouchActionNone:function(e){void 0!==(e=$.getElement(e)).style.touchAction?e.style.touchAction="none":void 0!==e.style.msTouchAction&&(e.style.msTouchAction="none")},addClass:function(e,t){(e=$.getElement(e)).className?-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t):e.className=t},indexOf:function(e,t,n){return Array.prototype.indexOf?this.indexOf=function(e,t,n){return e.indexOf(t,n)}:this.indexOf=function(e,t,n){var i,r,o=n||0;if(!e)throw new TypeError;if(0===(r=e.length)||o>=r)return-1;for(o<0&&(o=r-Math.abs(o)),i=o;i<r;i++)if(e[i]===t)return i;return-1},this.indexOf(e,t,n)},removeClass:function(e,t){var n,i,r=[];for(n=(e=$.getElement(e)).className.split(/\s+/),i=0;i<n.length;i++)n[i]&&n[i]!==t&&r.push(n[i]);e.className=r.join(" ")},addEvent:function(){if(window.addEventListener)return function(e,t,n,i){(e=$.getElement(e)).addEventListener(t,n,i)};if(window.attachEvent)return function(e,t,n,i){(e=$.getElement(e)).attachEvent("on"+t,n)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(e,t,n,i){(e=$.getElement(e)).removeEventListener(t,n,i)};if(window.detachEvent)return function(e,t,n,i){(e=$.getElement(e)).detachEvent("on"+t,n)};throw new Error("No known event model.")}(),cancelEvent:function(e){(e=$.getEvent(e)).preventDefault?$.cancelEvent=function(e){e.preventDefault()}:$.cancelEvent=function(e){(e=$.getEvent(e)).cancel=!0,e.returnValue=!1},$.cancelEvent(e)},stopEvent:function(e){(e=$.getEvent(e)).stopPropagation?$.stopEvent=function(e){e.stopPropagation()}:$.stopEvent=function(e){(e=$.getEvent(e)).cancelBubble=!0},$.stopEvent(e)},createCallback:function(e,t){var n,i=[];for(n=2;n<arguments.length;n++)i.push(arguments[n]);return function(){var n,r=i.concat([]);for(n=0;n<arguments.length;n++)r.push(arguments[n]);return t.apply(e,r)}},getUrlParameter:function(e){var t=URLPARAMS[e];return t||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}if(t)window.XMLHttpRequest?$.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(e)},makeAjaxRequest:function(e,t,n){var i,r,o;$.isPlainObject(e)&&(t=e.success,n=e.error,i=e.withCredentials,r=e.headers,o=e.responseType||null,e=e.url);var s=$.getUrlProtocol(e),a=$.createAjaxRequest("file:"===s);if(!$.isFunction(t))throw new Error("makeAjaxRequest requires a success callback");a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=function(){},a.status>=200&&a.status<300||0===a.status&&"http:"!==s&&"https:"!==s?t(a):($.console.log("AJAX request returned %d: %s",a.status,e),$.isFunction(n)&&n(a)))};try{if(a.open("GET",e,!0),o&&(a.responseType=o),r)for(var l in r)r.hasOwnProperty(l)&&r[l]&&a.setRequestHeader(l,r[l]);i&&(a.withCredentials=!0),a.send(null)}catch(i){var c=i.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==i.number&&-2147024891==i.number&&(c+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",i.name,c),a.onreadystatechange=function(){},window.XDomainRequest){var u=new XDomainRequest;if(u){u.onload=function(e){$.isFunction(t)&&t({responseText:u.responseText,status:200,statusText:"OK"})},u.onerror=function(e){$.isFunction(n)&&n({responseText:u.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{u.open("GET",e),u.send()}catch(e){$.isFunction(n)&&n(a,i)}}}else $.isFunction(n)&&n(a,i)}return a},jsonp:function(e){var t,n=e.url,i=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=e.callbackName||"openseadragon"+$.now(),o=window[r],s="$1"+r+"$2",a=e.param||"callback",l=e.callback;n=n.replace(/(\=)\?(&|$)|\?\?/i,s),n+=(/\?/.test(n)?"&":"?")+a+"="+r,window[r]=function(e){if(o)window[r]=o;else try{delete window[r]}catch(e){}l&&$.isFunction(l)&&l(e)},t=document.createElement("script"),void 0===e.async&&!1===e.async||(t.async="async"),e.scriptCharset&&(t.charset=e.scriptCharset),t.src=n,t.onload=t.onreadystatechange=function(e,n){(n||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,i&&t.parentNode&&i.removeChild(t),t=void 0)},i.insertBefore(t,i.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)$.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return $.parseXml(e)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(e){return!!FILEFORMATS[(e=e||"").toLowerCase()]}}),$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};!function(){var e=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(t.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):t.indexOf("Safari")>=0?($.Browser.vendor=t.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}var n,i,r,o=window.location.search.substring(1).split("&");for(r=0;r<o.length;r++)(i=(n=o[r]).indexOf("="))>0&&(URLPARAMS[n.substring(0,i)]=decodeURIComponent(n.substring(i+1)));$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}();var nullfunction=function(e){};function getOffsetParent(e,t){return t&&e!=document.body?document.body:e.offsetParent}$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},function(e){var t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,n=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.msCancelAnimationFrame;if(t&&n)$.requestAnimationFrame=function(){return t.apply(e,arguments)},$.cancelAnimationFrame=function(){return n.apply(e,arguments)};else{var i,r=[],o=[],s=0;$.requestAnimationFrame=function(e){return r.push([++s,e]),i||(i=setInterval((function(){if(r.length){var e=$.now(),t=o;for(o=r,r=t;o.length;)o.shift()[1](e)}else clearInterval(i),i=void 0}),20)),s},$.cancelAnimationFrame=function(e){var t,n;for(t=0,n=r.length;t<n;t+=1)if(r[t][0]===e)return void r.splice(t,1);for(t=0,n=o.length;t<n;t+=1)if(o[t][0]===e)return void o.splice(t,1)}}}(window)}(OpenSeadragon),root=commonjsGlobal,factory=function(){return OpenSeadragon},module.exports?module.exports=factory():root.OpenSeadragon=factory(),$=OpenSeadragon,fullScreenApi={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""},document.exitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.fullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.requestFullscreen()},fullScreenApi.exitFullScreen=function(){document.exitFullscreen()},fullScreenApi.fullScreenEventName="fullscreenchange",fullScreenApi.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.msFullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.msRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.msExitFullscreen()},fullScreenApi.fullScreenEventName="MSFullscreenChange",fullScreenApi.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitFullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.webkitRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.webkitExitFullscreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},fullScreenApi.requestFullScreen=function(e){return e.webkitRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.webkitCancelFullScreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.mozFullScreenElement},fullScreenApi.requestFullScreen=function(e){return e.mozRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.mozCancelFullScreen()},fullScreenApi.fullScreenEventName="mozfullscreenchange",fullScreenApi.fullScreenErrorEventName="mozfullscreenerror"),fullScreenApi.isFullScreen=function(){return null!==fullScreenApi.getFullScreenElement()},fullScreenApi.cancelFullScreen=function(){$.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),fullScreenApi.exitFullScreen()},$.extend($,fullScreenApi),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(e,t,n,i){var r=this;i=i||1;var o=0,s=function(n){++o===i&&r.removeHandler(e,s),t(n)};this.addHandler(e,s,n)},addHandler:function(t,n,i){var r=this.events[t];r||(this.events[t]=r=[]),n&&e.isFunction(n)&&(r[r.length]={handler:n,userData:i||null})},removeHandler:function(t,n){var i,r=this.events[t],o=[];if(r&&e.isArray(r)){for(i=0;i<r.length;i++)r[i].handler!==n&&o.push(r[i]);this.events[t]=o}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(e,n){var i,r=t.length;for(i=0;i<r;i++)t[i]&&(n.eventSource=e,n.userData=t[i].userData,t[i].handler(n))}):null},raiseEvent:function(e,t){var n=this.getHandler(e);n&&(t||(t={}),n(this,t))}}}(OpenSeadragon),function(e){var t,n,i,r,o,s,a=[],l={};function c(t){var n,i=l[t.hash],r=i.activePointersLists.length;for(n=0;n<r;n++)i.activePointersLists[n].captureCount>0&&(e.removeEvent(e.MouseTracker.captureElement,"mousemove",i.mousemovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"mouseup",i.mouseupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",i.pointermovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",i.pointerupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchmove",i.touchmovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchend",i.touchendcaptured,!0),i.activePointersLists[n].captureCount=0);for(n=0;n<r;n++)i.activePointersLists.pop()}function u(t){var n,i,r=l[t.hash];if(r.tracking){for(i=0;i<e.MouseTracker.subscribeEvents.length;i++)n=e.MouseTracker.subscribeEvents[i],e.removeEvent(t.element,n,r[n],!1);c(t),r.tracking=!1}}function h(t,n){var i=l[t.hash];if("pointerevent"===n)return{upName:e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:i.pointerupcaptured,moveName:e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:i.pointermovecaptured};if("mouse"===n)return{upName:"mouseup",upHandler:i.mouseupcaptured,moveName:"mousemove",moveHandler:i.mousemovecaptured};if("touch"===n)return{upName:"touchend",upHandler:i.touchendcaptured,moveName:"touchmove",moveHandler:i.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function d(t,n,i){var r,o=t.getActivePointersListByType(n);o.captureCount+=i||1,1===o.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.setCapture(!0):(r=h(t,e.MouseTracker.havePointerEvents?"pointerevent":n),ye&&we(window.top)&&e.addEvent(window.top,r.upName,r.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,r.upName,r.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,r.moveName,r.moveHandler,!0)))}function p(t,n,i){var r,o=t.getActivePointersListByType(n);o.captureCount-=i||1,0===o.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.releaseCapture():(r=h(t,e.MouseTracker.havePointerEvents?"pointerevent":n),ye&&we(window.top)&&e.removeEvent(window.top,r.upName,r.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,r.moveName,r.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,r.upName,r.upHandler,!0)))}function f(t){var n;if(e.MouseTracker.unprefixedPointerEvents)n=t.pointerType;else switch(t.pointerType){case 2:n="touch";break;case 3:n="pen";break;case 4:n="mouse";break;default:n=""}return n}function m(t){return e.getMousePosition(t)}function g(e,t){return v(m(e),t)}function v(t,n){var i=e.getElementOffset(n);return t.minus(i)}function y(t,n){return new e.Point((t.x+n.x)/2,(t.y+n.y)/2)}function w(t,n){t.clickHandler&&e.cancelEvent(n)}function b(t,n){t.dblClickHandler&&e.cancelEvent(n)}function S(t,n){t.keyDownHandler&&(n=e.getEvent(n),t.keyDownHandler({eventSource:t,keyCode:n.keyCode?n.keyCode:n.charCode,ctrl:n.ctrlKey,shift:n.shiftKey,alt:n.altKey,meta:n.metaKey,originalEvent:n,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(n))}function T(t,n){t.keyUpHandler&&(n=e.getEvent(n),t.keyUpHandler({eventSource:t,keyCode:n.keyCode?n.keyCode:n.charCode,ctrl:n.ctrlKey,shift:n.shiftKey,alt:n.altKey,meta:n.metaKey,originalEvent:n,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(n))}function _(t,n){t.keyHandler&&(n=e.getEvent(n),t.keyHandler({eventSource:t,keyCode:n.keyCode?n.keyCode:n.charCode,ctrl:n.ctrlKey,shift:n.shiftKey,alt:n.altKey,meta:n.metaKey,originalEvent:n,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(n))}function x(t,n){t.focusHandler&&(n=e.getEvent(n),!1===t.focusHandler({eventSource:t,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n))}function E(t,n){t.blurHandler&&(n=e.getEvent(n),!1===t.blurHandler({eventSource:t,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n))}function P(e,t){C(e,t,t)}function R(t,n){var i={target:(n=e.getEvent(n)).target||n.srcElement,type:"wheel",shiftKey:n.shiftKey||!1,clientX:n.clientX,clientY:n.clientY,pageX:n.pageX?n.pageX:n.clientX,pageY:n.pageY?n.pageY:n.clientY,deltaMode:"MozMousePixelScroll"==n.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==e.MouseTracker.wheelEventName?i.deltaY=-n.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:i.deltaY=n.detail,C(t,i,n)}function C(t,n,i){var r;r=n.deltaY<0?1:-1,t.scrollHandler&&!1===t.scrollHandler({eventSource:t,pointerType:"mouse",position:g(n,t.element),scroll:r,shift:n.shiftKey,isTouchEvent:!1,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)}function O(e,t){if(e===t)return!1;for(;t&&t!==e;)t=t.parentNode;return t===e}function k(t,n){I(t,n=e.getEvent(n))}function M(t,n){(n=e.getEvent(n)).currentTarget===n.relatedTarget||O(n.currentTarget,n.relatedTarget)||I(t,n)}function I(t,n){pe(t,n,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(n),currentTime:e.now()}])}function D(t,n){H(t,n=e.getEvent(n))}function L(t,n){(n=e.getEvent(n)).currentTarget===n.relatedTarget||O(n.currentTarget,n.relatedTarget)||H(t,n)}function H(t,n){fe(t,n,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(n),currentTime:e.now()}])}function A(t){return e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?1===t?0:2===t?2:4===t?1:-1:t}function B(t,n){me(t,n=e.getEvent(n),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(n),currentTime:e.now()}],A(n.button))&&(e.stopEvent(n),d(t,"mouse")),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler)&&e.cancelEvent(n)}function F(e,t){z(e,t)}function j(t,n){z(t,n),e.stopEvent(n)}function z(t,n){ge(t,n=e.getEvent(n),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(n),currentTime:e.now()}],A(n.button))&&p(t,"mouse")}function N(e,t){V(e,t)}function $(t,n){V(t,n),e.stopEvent(n)}function V(t,n){ve(t,n=e.getEvent(n),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(n),currentTime:e.now()}])}function U(e,t,n){var i,r=n.getLength(),o=[];if("touch"===n.type||n.contacts>0){for(i=0;i<r;i++)o.push(n.getByIndex(i));o.length>0&&(ge(e,t,o,0),n.captureCount=1,p(e,n.type),fe(e,t,o))}}function W(t,n){var i,r,o,s,l=n.changedTouches.length,c=[],u=t.getActivePointersListByType("touch");for(i=e.now(),u.getLength()>n.touches.length-l&&(e.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),U(t,n,u)),r=0;r<l;r++)c.push({id:n.changedTouches[r].identifier,type:"touch",currentPos:m(n.changedTouches[r]),currentTime:i});for(pe(t,n,c),r=0;r<a.length;r++)if(a[r]!==t&&a[r].isTracking()&&O(a[r].element,t.element)){for(s=[],o=0;o<l;o++)s.push({id:n.changedTouches[o].identifier,type:"touch",currentPos:m(n.changedTouches[o]),currentTime:i});pe(a[r],n,s)}me(t,n,c,0)&&(e.stopEvent(n),d(t,"touch",l)),e.cancelEvent(n)}function q(e,t){Z(e,t)}function G(t,n){Z(t,n),e.stopEvent(n)}function Z(t,n){var i,r,o,s,l=n.changedTouches.length,c=[];for(i=e.now(),r=0;r<l;r++)c.push({id:n.changedTouches[r].identifier,type:"touch",currentPos:m(n.changedTouches[r]),currentTime:i});for(ge(t,n,c,0)&&p(t,"touch",l),fe(t,n,c),r=0;r<a.length;r++)if(a[r]!==t&&a[r].isTracking()&&O(a[r].element,t.element)){for(s=[],o=0;o<l;o++)s.push({id:n.changedTouches[o].identifier,type:"touch",currentPos:m(n.changedTouches[o]),currentTime:i});fe(a[r],n,s)}e.cancelEvent(n)}function K(e,t){Y(e,t)}function X(t,n){Y(t,n),e.stopEvent(n)}function Y(t,n){var i,r=n.changedTouches.length,o=[];for(i=0;i<r;i++)o.push({id:n.changedTouches[i].identifier,type:"touch",currentPos:m(n.changedTouches[i]),currentTime:e.now()});ve(t,n,o),e.cancelEvent(n)}function Q(e,t){var n=e.getActivePointersListByType("touch");U(e,t,n)}function J(e,t){return t.stopPropagation(),t.preventDefault(),!1}function ee(e,t){return t.stopPropagation(),t.preventDefault(),!1}function te(t,n){n.currentTarget===n.relatedTarget||O(n.currentTarget,n.relatedTarget)||pe(t,n,[{id:n.pointerId,type:f(n),isPrimary:n.isPrimary,currentPos:m(n),currentTime:e.now()}])}function ne(t,n){n.currentTarget===n.relatedTarget||O(n.currentTarget,n.relatedTarget)||fe(t,n,[{id:n.pointerId,type:f(n),isPrimary:n.isPrimary,currentPos:m(n),currentTime:e.now()}])}function ie(t,n){var i;me(t,n,[i={id:n.pointerId,type:f(n),isPrimary:n.isPrimary,currentPos:m(n),currentTime:e.now()}],n.button)&&(e.stopEvent(n),d(t,i.type)),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.cancelEvent(n)}function re(e,t){se(e,t)}function oe(t,n){t.getActivePointersListByType(f(n)).getById(n.pointerId)&&se(t,n),e.stopEvent(n)}function se(t,n){var i;ge(t,n,[i={id:n.pointerId,type:f(n),isPrimary:n.isPrimary,currentPos:m(n),currentTime:e.now()}],n.button)&&p(t,i.type)}function ae(e,t){ce(e,t)}function le(t,n){t.getActivePointersListByType(f(n)).getById(n.pointerId)&&ce(t,n),e.stopEvent(n)}function ce(t,n){ve(t,n,[{id:n.pointerId,type:f(n),isPrimary:n.isPrimary,currentPos:m(n),currentTime:e.now()}])}function ue(e,t){!function(e,t,n){ge(e,t,n,0),fe(e,t,n)}(e,t,[{id:t.pointerId,type:f(t)}])}function he(e,t){return t.hasOwnProperty("isPrimary")||(0===e.getLength()?t.isPrimary=!0:t.isPrimary=!1),t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function de(e,t){var n,i;return e.getById(t.id)?(n=e.removeById(t.id),t.hasOwnProperty("isPrimary")||(i=e.getPrimary())||(i=e.getByIndex(0))&&(i.isPrimary=!0)):n=e.getLength(),n}function pe(t,n,i){var r,o,s,a=t.getActivePointersListByType(i[0].type),l=i.length;for(r=0;r<l;r++)o=i[r],(s=a.getById(o.id))?(s.insideElement=!0,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime,o=s):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,he(a,o)),t.enterHandler&&!1===t.enterHandler({eventSource:t,pointerType:o.type,position:v(o.currentPos,t.element),buttons:a.buttons,pointers:t.getActivePointerCount(),insideElementPressed:o.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===o.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)}function fe(t,n,i){var r,o,s,a=t.getActivePointersListByType(i[0].type),l=i.length;for(r=0;r<l;r++)o=i[r],(s=a.getById(o.id))&&(s.captured?(s.insideElement=!1,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime):de(a,s),o=s),t.exitHandler&&!1===t.exitHandler({eventSource:t,pointerType:o.type,position:v(o.currentPos,t.element),buttons:a.buttons,pointers:t.getActivePointerCount(),insideElementPressed:!!s&&s.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===o.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)}function me(t,n,i,r){var o,s,a,c=l[t.hash],u=t.getActivePointersListByType(i[0].type),h=i.length;void 0!==n.buttons?u.buttons=n.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===r?u.buttons+=1:1===r?u.buttons+=4:2===r?u.buttons+=2:3===r?u.buttons+=8:4===r?u.buttons+=16:5===r&&(u.buttons+=32):0===r?u.buttons|=1:1===r?u.buttons|=4:2===r?u.buttons|=2:3===r?u.buttons|=8:4===r?u.buttons|=16:5===r&&(u.buttons|=32);var d=t.getActivePointersListsExceptType(i[0].type);for(o=0;o<d.length;o++)U(t,n,d[o]);if(0!==r)return t.nonPrimaryPressHandler&&!1===t.nonPrimaryPressHandler({eventSource:t,pointerType:i[0].type,position:v(i[0].currentPos,t.element),button:r,buttons:u.buttons,isTouchEvent:"touch"===i[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n),!1;for(o=0;o<h;o++)s=i[o],(a=u.getById(s.id))?(a.captured=!0,a.insideElementPressed=!0,a.insideElement=!0,a.contactPos=s.currentPos,a.contactTime=s.currentTime,a.lastPos=a.currentPos,a.lastTime=a.currentTime,a.currentPos=s.currentPos,a.currentTime=s.currentTime,s=a):(s.captured=!0,s.insideElementPressed=!0,s.insideElement=!0,he(u,s)),u.addContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(t,s),1===u.contacts?t.pressHandler&&!1===t.pressHandler({eventSource:t,pointerType:s.type,position:v(s.contactPos,t.element),buttons:u.buttons,isTouchEvent:"touch"===s.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n):2===u.contacts&&t.pinchHandler&&"touch"===s.type&&(c.pinchGPoints=u.asArray(),c.lastPinchDist=c.currentPinchDist=c.pinchGPoints[0].currentPos.distanceTo(c.pinchGPoints[1].currentPos),c.lastPinchCenter=c.currentPinchCenter=y(c.pinchGPoints[0].currentPos,c.pinchGPoints[1].currentPos));return!0}function ge(t,n,i,r){var o,s,a,c,u,h,d=l[t.hash],p=t.getActivePointersListByType(i[0].type),f=i.length,m=!1,g=!1;if(void 0!==n.buttons?p.buttons=n.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===r?p.buttons-=1:1===r?p.buttons-=4:2===r?p.buttons-=2:3===r?p.buttons-=8:4===r?p.buttons-=16:5===r&&(p.buttons-=32):0===r?p.buttons^=-2:1===r?p.buttons^=-5:2===r?p.buttons^=-3:3===r?p.buttons^=-9:4===r?p.buttons^=-17:5===r&&(p.buttons^=-33),0!==r){t.nonPrimaryReleaseHandler&&!1===t.nonPrimaryReleaseHandler({eventSource:t,pointerType:i[0].type,position:v(i[0].currentPos,t.element),button:r,buttons:p.buttons,isTouchEvent:"touch"===i[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n);var w=t.getActivePointersListByType("mouse");return U(t,n,w),!1}for(a=0;a<f;a++)c=i[a],(u=p.getById(c.id))&&(u.captured&&(u.captured=!1,m=!0,g=!0),u.lastPos=u.currentPos,u.lastTime=u.currentTime,u.currentPos=c.currentPos,u.currentTime=c.currentTime,u.insideElement||de(p,u),o=u.currentPos,s=u.currentTime,g?(p.removeContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(t,u),0===p.contacts?(t.releaseHandler&&!1===t.releaseHandler({eventSource:t,pointerType:u.type,position:v(o,t.element),buttons:p.buttons,insideElementPressed:u.insideElementPressed,insideElementReleased:u.insideElement,isTouchEvent:"touch"===u.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n),t.dragEndHandler&&!u.currentPos.equals(u.contactPos)&&!1===t.dragEndHandler({eventSource:t,pointerType:u.type,position:v(u.currentPos,t.element),speed:u.speed,direction:u.direction,shift:n.shiftKey,isTouchEvent:"touch"===u.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n),(t.clickHandler||t.dblClickHandler)&&u.insideElement&&(h=s-u.contactTime<=t.clickTimeThreshold&&u.contactPos.distanceTo(o)<=t.clickDistThreshold,t.clickHandler&&!1===t.clickHandler({eventSource:t,pointerType:u.type,position:v(u.currentPos,t.element),quick:h,shift:n.shiftKey,isTouchEvent:"touch"===u.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n),t.dblClickHandler&&h&&(p.clicks++,1===p.clicks?(d.lastClickPos=o,d.dblClickTimeOut=setTimeout((function(){p.clicks=0}),t.dblClickTimeThreshold)):2===p.clicks&&(clearTimeout(d.dblClickTimeOut),p.clicks=0,d.lastClickPos.distanceTo(o)<=t.dblClickDistThreshold&&!1===t.dblClickHandler({eventSource:t,pointerType:u.type,position:v(u.currentPos,t.element),shift:n.shiftKey,isTouchEvent:"touch"===u.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n),d.lastClickPos=null)))):2===p.contacts&&t.pinchHandler&&"touch"===u.type&&(d.pinchGPoints=p.asArray(),d.lastPinchDist=d.currentPinchDist=d.pinchGPoints[0].currentPos.distanceTo(d.pinchGPoints[1].currentPos),d.lastPinchCenter=d.currentPinchCenter=y(d.pinchGPoints[0].currentPos,d.pinchGPoints[1].currentPos))):t.releaseHandler&&!1===t.releaseHandler({eventSource:t,pointerType:u.type,position:v(o,t.element),buttons:p.buttons,insideElementPressed:u.insideElementPressed,insideElementReleased:u.insideElement,isTouchEvent:"touch"===u.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n));return m}function ve(t,n,i){var r,o,s,a,c,u=l[t.hash],h=t.getActivePointersListByType(i[0].type),d=i.length;for(void 0!==n.buttons&&(h.buttons=n.buttons),r=0;r<d;r++)o=i[r],(s=h.getById(o.id))?(o.hasOwnProperty("isPrimary")&&(s.isPrimary=o.isPrimary),s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,he(h,o));t.stopHandler&&"mouse"===i[0].type&&(clearTimeout(t.stopTimeOut),t.stopTimeOut=setTimeout((function(){!function(e,t,n){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:n,position:g(t,e.element),buttons:e.getActivePointersListByType(n).buttons,isTouchEvent:"touch"===n,originalEvent:t,preventDefaultAction:!1,userData:e.userData})}(t,n,i[0].type)}),t.stopDelay)),0===h.contacts?t.moveHandler&&!1===t.moveHandler({eventSource:t,pointerType:i[0].type,position:v(i[0].currentPos,t.element),buttons:h.buttons,isTouchEvent:"touch"===i[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n):1===h.contacts?(t.moveHandler&&(s=h.asArray()[0],!1===t.moveHandler({eventSource:t,pointerType:s.type,position:v(s.currentPos,t.element),buttons:h.buttons,isTouchEvent:"touch"===s.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),t.dragHandler&&(c=(s=h.asArray()[0]).currentPos.minus(s.lastPos),!1===t.dragHandler({eventSource:t,pointerType:s.type,position:v(s.currentPos,t.element),buttons:h.buttons,delta:c,speed:s.speed,direction:s.direction,shift:n.shiftKey,isTouchEvent:"touch"===s.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n))):2===h.contacts&&(t.moveHandler&&(a=h.asArray(),!1===t.moveHandler({eventSource:t,pointerType:a[0].type,position:v(y(a[0].currentPos,a[1].currentPos),t.element),buttons:h.buttons,isTouchEvent:"touch"===a[0].type,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)),t.pinchHandler&&"touch"===i[0].type&&(c=u.pinchGPoints[0].currentPos.distanceTo(u.pinchGPoints[1].currentPos))!=u.currentPinchDist&&(u.lastPinchDist=u.currentPinchDist,u.currentPinchDist=c,u.lastPinchCenter=u.currentPinchCenter,u.currentPinchCenter=y(u.pinchGPoints[0].currentPos,u.pinchGPoints[1].currentPos),!1===t.pinchHandler({eventSource:t,pointerType:"touch",gesturePoints:u.pinchGPoints,lastCenter:v(u.lastPinchCenter,t.element),center:v(u.currentPinchCenter,t.element),lastDistance:u.lastPinchDist,distance:u.currentPinchDist,shift:n.shiftKey,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)))}e.MouseTracker=function(t){a.push(this);var n=arguments;e.isPlainObject(t)||(t={element:n[0],clickTimeThreshold:n[1],clickDistThreshold:n[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=t.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=t.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=t.userData||null,this.stopDelay=t.stopDelay||50,this.enterHandler=t.enterHandler||null,this.exitHandler=t.exitHandler||null,this.pressHandler=t.pressHandler||null,this.nonPrimaryPressHandler=t.nonPrimaryPressHandler||null,this.releaseHandler=t.releaseHandler||null,this.nonPrimaryReleaseHandler=t.nonPrimaryReleaseHandler||null,this.moveHandler=t.moveHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dblClickHandler=t.dblClickHandler||null,this.dragHandler=t.dragHandler||null,this.dragEndHandler=t.dragEndHandler||null,this.pinchHandler=t.pinchHandler||null,this.stopHandler=t.stopHandler||null,this.keyDownHandler=t.keyDownHandler||null,this.keyUpHandler=t.keyUpHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null;var i=this;l[this.hash]={click:function(e){w(i,e)},dblclick:function(e){b(i,e)},keydown:function(e){S(i,e)},keyup:function(e){T(i,e)},keypress:function(e){_(i,e)},focus:function(e){x(i,e)},blur:function(e){E(i,e)},wheel:function(e){P(i,e)},mousewheel:function(e){R(i,e)},DOMMouseScroll:function(e){R(i,e)},MozMousePixelScroll:function(e){R(i,e)},mouseenter:function(e){k(i,e)},mouseleave:function(e){D(i,e)},mouseover:function(e){M(i,e)},mouseout:function(e){L(i,e)},mousedown:function(e){B(i,e)},mouseup:function(e){F(i,e)},mouseupcaptured:function(e){j(i,e)},mousemove:function(e){N(i,e)},mousemovecaptured:function(e){$(i,e)},touchstart:function(e){W(i,e)},touchend:function(e){q(i,e)},touchendcaptured:function(e){G(i,e)},touchmove:function(e){K(i,e)},touchmovecaptured:function(e){X(i,e)},touchcancel:function(e){Q(i,e)},gesturestart:function(e){J(i,e)},gesturechange:function(e){ee(i,e)},pointerover:function(e){te(i,e)},MSPointerOver:function(e){te(i,e)},pointerout:function(e){ne(i,e)},MSPointerOut:function(e){ne(i,e)},pointerdown:function(e){ie(i,e)},MSPointerDown:function(e){ie(i,e)},pointerup:function(e){re(i,e)},MSPointerUp:function(e){re(i,e)},pointermove:function(e){ae(i,e)},MSPointerMove:function(e){ae(i,e)},pointercancel:function(e){ue(i,e)},MSPointerCancel:function(e){ue(i,e)},pointerupcaptured:function(e){oe(i,e)},pointermovecaptured:function(e){le(i,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},t.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var e;for(u(this),this.element=null,e=0;e<a.length;e++)if(a[e]===this){a.splice(e,1);break}l[this.hash]=null,delete l[this.hash]},isTracking:function(){return l[this.hash].tracking},setTracking:function(t){return t?function(t){var n,i,r=l[t.hash];if(!r.tracking){for(i=0;i<e.MouseTracker.subscribeEvents.length;i++)n=e.MouseTracker.subscribeEvents[i],e.addEvent(t.element,n,r[n],!1);c(t),r.tracking=!0}}(this):u(this),this},getActivePointersListsExceptType:function(e){for(var t=l[this.hash],n=[],i=0;i<t.activePointersLists.length;++i)t.activePointersLists[i].type!==e&&n.push(t.activePointersLists[i]);return n},getActivePointersListByType:function(t){var n,i,r=l[this.hash],o=r.activePointersLists.length;for(n=0;n<o;n++)if(r.activePointersLists[n].type===t)return r.activePointersLists[n];return i=new e.MouseTracker.GesturePointList(t),r.activePointersLists.push(i),i},getActivePointerCount:function(){var e,t=l[this.hash],n=t.activePointersLists.length,i=0;for(e=0;e<n;e++)i+=t.activePointersLists[e].getLength();return i},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},e.MouseTracker.resetAllMouseTrackers=function(){for(var e=0;e<a.length;e++)a[e].isTracking()&&(a[e].setTracking(!1),a[e].setTracking(!0))},e.MouseTracker.gesturePointVelocityTracker=(t=[],n=0,i=0,r=function(e,t){return e.hash.toString()+t.type+t.id.toString()},o=function(){var n,r,o,s,a,l,c=t.length,u=e.now();for(s=u-i,i=u,n=0;n<c;n++)(o=(r=t[n]).gPoint).direction=Math.atan2(o.currentPos.y-r.lastPos.y,o.currentPos.x-r.lastPos.x),a=r.lastPos.distanceTo(o.currentPos),r.lastPos=o.currentPos,l=1e3*a/(s+1),o.speed=.75*l+.25*o.speed},{addPoint:function(s,a){var l=r(s,a);t.push({guid:l,gPoint:a,lastPos:a.currentPos}),1===t.length&&(i=e.now(),n=window.setInterval(o,50))},removePoint:function(e,i){var o,s=r(e,i),a=t.length;for(o=0;o<a;o++)if(t[o].guid===s){t.splice(o,1),0==--a&&window.clearInterval(n);break}}}),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.supportsMouseCapture=(s=document.createElement("div"),e.isFunction(s.setCapture)&&e.isFunction(s.releaseCapture)),e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",e.MouseTracker.wheelEventName],"DOMMouseScroll"==e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||e.Browser.vendor!==e.BROWSERS.IE)?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),e.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):(e.MouseTracker.havePointerEvents=!1,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?(e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),e.MouseTracker.haveMouseEnter=!0):(e.MouseTracker.subscribeEvents.push("mouseover","mouseout"),e.MouseTracker.haveMouseEnter=!1),e.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.maxTouchPoints=10),e.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,n=this._gPoints.length;for(t=0;t<n;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,n=this._gPoints.length;for(t=0;t<n;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(e){var t,n=this._gPoints.length;for(t=0;t<n;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var ye=function(){try{return window.self!==window.top}catch(e){return!0}}();function we(e){try{return e.addEventListener&&e.removeEventListener}catch(e){return!1}}}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,n,i){var r=t.parentNode;"number"==typeof n&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),n={anchor:n}),n.attachToViewer=void 0===n.attachToViewer||n.attachToViewer,this.autoFade=void 0===n.autoFade||n.autoFade,this.element=t,this.anchor=n.anchor,this.container=i,this.anchor==e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof n.top?n.top+"px":n.top,this.wrapper.style.left="number"==typeof n.left?n.left+"px":n.left,this.wrapper.style.height="number"==typeof n.height?n.height+"px":n.height,this.wrapper.style.width="number"==typeof n.width?n.width+"px":n.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),n.attachToViewer?this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):r.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor==e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(e,t){var n,i=e.controls;for(n=i.length-1;n>=0;n--)if(i[n].element==t)return n;return-1}e.ControlDock=function(t){var n,i,r=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),i=0;i<r.length;i++)n=r[i],this.controls[n]=e.makeNeutralElement("div"),this.controls[n].style.position="absolute",n.match("left")&&(this.controls[n].style.left="0px"),n.match("right")&&(this.controls[n].style.right="0px"),n.match("top")&&(this.controls[n].style.top="0px"),n.match("bottom")&&(this.controls[n].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(n,i){var r=null;if(!(t(this,n=e.getElement(n))>=0)){switch(i.anchor){case e.ControlAnchor.TOP_RIGHT:r=this.controls.topright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:r=this.controls.bottomright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:r=this.controls.bottomleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:r=this.controls.topleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:r=this.container,n.style.margin="0px",n.style.padding="0px";break;default:case e.ControlAnchor.NONE:r=this.container,n.style.margin="0px",n.style.padding="0px"}this.controls.push(new e.Control(n,i,r)),n.style.display="inline-block"}},removeControl:function(n){var i=t(this,n=e.getElement(n));return i>=0&&(this.controls[i].destroy(),this.controls.splice(i,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(e){var t={},n=1;function i(t){return t=e.getElement(t),new e.Point(0===t.clientWidth?1:t.clientWidth,0===t.clientHeight?1:t.clientHeight)}function r(t,n){if(n instanceof e.Overlay)return n;var i=null;if(n.element)i=e.getElement(n.element);else{var r=n.id?n.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(i=e.getElement(n.id))||((i=document.createElement("a")).href="#/overlay/"+r),i.id=r,e.addClass(i,n.className?n.className:"openseadragon-overlay")}var o=n.location,s=n.width,a=n.height;if(!o){var l=n.x,c=n.y;if(void 0!==n.px){var u=t.viewport.imageToViewportRectangle(new e.Rect(n.px,n.py,s||0,a||0));l=u.x,c=u.y,s=void 0!==s?u.width:void 0,a=void 0!==a?u.height:void 0}o=new e.Point(l,c)}var h=n.placement;return h&&"string"===e.type(h)&&(h=e.Placement[n.placement.toUpperCase()]),new e.Overlay({element:i,location:o,placement:h,onDraw:n.onDraw,checkResize:n.checkResize,width:s,height:a,rotationMode:n.rotationMode})}function o(e,t){var n;for(n=e.length-1;n>=0;n--)if(e[n].element===t)return n;return-1}function s(t,n){return e.requestAnimationFrame((function(){n(t)}))}function a(t){e.requestAnimationFrame((function(){!function(t){var n,i,r,o;if(t.controlsShouldFade){for(n=e.now(),i=n-t.controlsFadeBeginTime,r=1-i/t.controlsFadeLength,r=Math.min(1,r),r=Math.max(0,r),o=t.controls.length-1;o>=0;o--)t.controls[o].autoFade&&t.controls[o].setOpacity(r);r>0&&a(t)}}(t)}))}function l(t){t.autoHideControls&&(t.controlsShouldFade=!0,t.controlsFadeBeginTime=e.now()+t.controlsFadeDelay,window.setTimeout((function(){a(t)}),t.controlsFadeDelay))}function c(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function u(){c(this)}function h(){l(this)}function d(t){var n={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",n),n.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 38:return n.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return n.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function p(t){var n={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",n),n.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return n.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return n.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return n.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function f(e){var t;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var n={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-click",n),!n.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType)).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function m(e){var t,n={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-double-click",n),!n.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function g(e){var t,n={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.raiseEvent("canvas-drag",n),!n.preventDefaultAction&&this.viewport){if(t=this.gestureSettingsByDeviceType(e.pointerType),this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan){var i=this.viewport.deltaPointsFromPixels(e.delta.negate());this.viewport.centerSpringX.target.value+=i.x,this.viewport.centerSpringY.target.value+=i.y;var r=this.viewport.getBounds(),o=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=i.x,this.viewport.centerSpringY.target.value-=i.y,r.x!=o.x&&(e.delta.x=0),r.y!=o.y&&(e.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled&&!this.constrainDuringPan)}}function v(t){if(!t.preventDefaultAction&&this.viewport){var n=this.gestureSettingsByDeviceType(t.pointerType);if(n.flickEnabled&&t.speed>=n.flickMinSpeed){var i=0;this.panHorizontal&&(i=n.flickMomentum*t.speed*Math.cos(t.direction));var r=0;this.panVertical&&(r=n.flickMomentum*t.speed*Math.sin(t.direction));var o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),s=this.viewport.pointFromPixel(new e.Point(o.x-i,o.y-r));this.viewport.panTo(s,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:t.eventSource,position:t.position,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent})}function y(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function w(t){window.location!=window.parent.location&&e.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function b(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function S(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function T(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function _(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function x(e){var t,n,i;if(!e.preventDefaultAction&&this.viewport&&((t=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom&&(n=this.viewport.pointFromPixel(e.center,!0),i=this.viewport.pointFromPixel(e.lastCenter,!0).minus(n),this.panHorizontal||(i.x=0),this.panVertical||(i.y=0),this.viewport.zoomBy(e.distance/e.lastDistance,n,!0),t.zoomToRefPoint&&this.viewport.panBy(i,!0),this.viewport.applyConstraints()),t.pinchRotate)){var r=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),o=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(r-o)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:e.eventSource,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent}),!1}function E(t){var n,i,r;if((r=e.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=r,this.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x),!t.preventDefaultAction&&this.viewport&&(n=this.gestureSettingsByDeviceType(t.pointerType)).scrollToZoom&&(i=Math.pow(this.zoomPerScroll,t.scroll),this.viewport.zoomBy(i,n.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent}),n&&n.scrollToZoom)return!1}else if((n=this.gestureSettingsByDeviceType(t.pointerType))&&n.scrollToZoom)return!1}function P(e){t[this.hash].mouseInside=!0,c(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function R(e){e.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||l(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function C(e){!function(e){if(e._opening)return;if(e.autoResize){var n=i(e.container),r=t[e.hash].prevContainerSize;if(!n.equals(r)){var o=e.viewport;if(e.preserveImageSizeOnResize){var s=r.x/n.x,a=o.getZoom()*s,u=o.getCenter();o.resize(n,!1),o.zoomTo(a,null,!0),o.panTo(u,!0)}else{var h=o.getBounds();o.resize(n,!0),o.fitBoundsWithConstraints(h,!0)}t[e.hash].prevContainerSize=n,t[e.hash].forceRedraw=!0}}var d=e.viewport.update(),p=e.world.update()||d;d&&e.raiseEvent("viewport-change");e.referenceStrip&&(p=e.referenceStrip.update(e.viewport)||p);!t[e.hash].animating&&p&&(e.raiseEvent("animation-start"),c(e));(p||t[e.hash].forceRedraw||e.world.needsDraw())&&(!function(e){e.imageLoader.clear(),e.drawer.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),t[e.hash].forceRedraw=!1,p&&e.raiseEvent("animation"));t[e.hash].animating&&!p&&(e.raiseEvent("animation-finish"),t[e.hash].mouseInside||l(e));t[e.hash].animating=p}(e),e.isOpen()?e._updateRequestId=s(e,C):e._updateRequestId=!1}function O(e,t){return e?e+t:t}function k(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,D(this)}function M(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,D(this)}function I(){t[this.hash].zooming=!1}function D(t){e.requestAnimationFrame(e.delegate(t,L))}function L(){var n,i,r;t[this.hash].zooming&&this.viewport&&(i=(n=e.now())-t[this.hash].lastZoomTime,r=Math.pow(t[this.hash].zoomFactor,i/1e3),this.viewport.zoomBy(r),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=n,D(this))}function H(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function A(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function B(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function F(){this.viewport&&this.viewport.goHome()}function j(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function z(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t+this.rotationIncrement,360):e.positiveModulo(t-this.rotationIncrement,360),this.viewport.setRotation(t)}}function N(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t-this.rotationIncrement,360):e.positiveModulo(t+this.rotationIncrement,360),this.viewport.setRotation(t)}}function $(){this.viewport.toggleFlip()}function V(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)}function U(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}e.Viewer=function(r){var o,a,c=arguments,u=this;if(e.isPlainObject(r)||(r={id:c[0],xmlPath:c.length>1?c[1]:void 0,prefixUrl:c.length>2?c[2]:void 0,controls:c.length>3?c[3]:void 0,overlays:c.length>4?c[4]:void 0}),r.config&&(e.extend(!0,r,r.config),delete r.config),e.extend(!0,this,{id:r.id,hash:r.hash||n++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,r),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==t[this.hash]&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",(function(t){var n=e.getString("Errors.OpenFailed",t.eventSource,t.message);u._showMessage(n)})),e.ControlDock.call(this,r),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(a=this.canvas.style).width="100%",a.height="100%",a.overflow="hidden",a.position="absolute",a.top="0px",a.left="0px",e.setElementTouchActionNone(this.canvas),""!==r.tabIndex&&(this.canvas.tabIndex=void 0===r.tabIndex?0:r.tabIndex),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:e.delegate(this,d),keyHandler:e.delegate(this,p),clickHandler:e.delegate(this,f),dblClickHandler:e.delegate(this,m),dragHandler:e.delegate(this,g),dragEndHandler:e.delegate(this,v),enterHandler:e.delegate(this,y),exitHandler:e.delegate(this,w),pressHandler:e.delegate(this,b),releaseHandler:e.delegate(this,S),nonPrimaryPressHandler:e.delegate(this,T),nonPrimaryReleaseHandler:e.delegate(this,_),scrollHandler:e.delegate(this,E),pinchHandler:e.delegate(this,x)}),this.outerTracker=new e.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,P),exitHandler:e.delegate(this,R)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=i(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",(function(e){u.source=u.world.getItemAt(0).source,t[u.hash].forceRedraw=!0,u._updateRequestId||(u._updateRequestId=s(u,C))})),this.world.addHandler("remove-item",(function(e){u.world.getItemCount()?u.source=u.world.getItemAt(0).source:u.source=null,t[u.hash].forceRedraw=!0})),this.world.addHandler("metrics-change",(function(e){u.viewport&&u.viewport._setContentBounds(u.world.getHomeBounds(),u.world.getContentFactor())})),this.world.addHandler("item-index-change",(function(e){u.source=u.world.getItemAt(0).source})),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:r.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(o=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(o,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(o=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(o,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),o=0;o<this.customControls.length;o++)this.addControl(this.customControls[o].id,{anchor:this.customControls[o].anchor});e.requestAnimationFrame((function(){l(u)})),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(t){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(t)},openTileSource:function(t){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(t)},open:function(t,n){var i=this;if(this.close(),t){if(this.sequenceMode&&e.isArray(t))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===n||isNaN(n)||(this.initialPage=n),this.tileSources=t,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(e.isArray(t)||(t=[t]),t.length){this._opening=!0;for(var o,s=t.length,a=0,l=0,c=function(){if(a+l===s)if(a){!i._firstOpen&&i.preserveViewport||(i.viewport.goHome(!0),i.viewport.update()),i._firstOpen=!1;var e=t[0];if(e.tileSource&&(e=e.tileSource),i.overlays&&!i.preserveOverlays)for(var n=0;n<i.overlays.length;n++)i.currentOverlays[n]=r(i,i.overlays[n]);i._drawOverlays(),i._opening=!1,i.raiseEvent("open",{source:e})}else i._opening=!1,i.raiseEvent("open-failed",o)},u=function(t){e.isPlainObject(t)&&t.tileSource||(t={tileSource:t}),void 0!==t.index&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete t.index),void 0===t.collectionImmediately&&(t.collectionImmediately=!0);var n=t.success;t.success=function(e){if(a++,t.tileSource.overlays)for(var r=0;r<t.tileSource.overlays.length;r++)i.addOverlay(t.tileSource.overlays[r]);n&&n(e),c()};var r=t.error;t.error=function(e){l++,o||(o=e),r&&r(e),c()},i.addTiledImage(t)},h=0;h<t.length;h++)u(t[h]);return this}}},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(t[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisible();return t},setControlsEnabled:function(e){return e?c(this):l(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(n){var i,r,o=document.body,s=o.style,a=document.documentElement.style,l=this;if(n==this.isFullPage())return this;var c={fullPage:n,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",c),c.preventDefaultAction)return this;if(n){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=s.margin,this.docMargin=a.margin,s.margin="0",a.margin="0",this.bodyPadding=s.padding,this.docPadding=a.padding,s.padding="0",a.padding="0",this.bodyWidth=s.width,this.docWidth=a.width,s.width="100%",a.width="100%",this.bodyHeight=s.height,this.docHeight=a.height,s.height="100%",a.height="100%",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,i=o.childNodes.length,r=0;r<i;r++)this.previousBody.push(o.childNodes[0]),o.removeChild(o.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,o.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),o.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,P)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,s.margin=this.bodyMargin,a.margin=this.docMargin,s.padding=this.bodyPadding,a.padding=this.docPadding,s.width=this.bodyWidth,a.width=this.docWidth,s.height=this.bodyHeight,a.height=this.docHeight,o.removeChild(this.element),i=this.previousBody.length,r=0;r<i;r++)o.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(o.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var u=0,h=function(){e.setPageScroll(l.pageScroll);var t=e.getPageScroll();++u<10&&(t.x!==l.pageScroll.x||t.y!==l.pageScroll.y)&&e.requestAnimationFrame(h)};e.requestAnimationFrame(h),t[this.hash].fullPage=!1,e.delegate(this,R)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:n}),this},setFullScreen:function(t){var n=this;if(!e.supportsFullScreen)return this.setFullPage(t);if(e.isFullScreen()===t)return this;var i={fullScreen:t,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",i),i.preventDefaultAction)return this;if(t){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var r=function(){var t=e.isFullScreen();t||(e.removeEvent(document,e.fullScreenEventName,r),e.removeEvent(document,e.fullScreenErrorEventName,r),n.setFullPage(!1),n.isFullPage()&&(n.element.style.width=n.fullPageStyleWidth,n.element.style.height=n.fullPageStyleHeight)),n.navigator&&n.viewport&&setTimeout((function(){n.navigator.update(n.viewport)})),n.raiseEvent("full-screen",{fullScreen:t})};e.addEvent(document,e.fullScreenEventName,r),e.addEvent(document,e.fullScreenErrorEventName,r),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(t){e.console.assert(t,"[Viewer.addTiledImage] options is required"),e.console.assert(t.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!t.replace||t.index>-1&&t.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var n=this;t.replace&&(t.replaceItem=n.world.getItemAt(t.index)),this._hideMessage(),void 0===t.placeholderFillStyle&&(t.placeholderFillStyle=this.placeholderFillStyle),void 0===t.opacity&&(t.opacity=this.opacity),void 0===t.preload&&(t.preload=this.preload),void 0===t.compositeOperation&&(t.compositeOperation=this.compositeOperation),void 0===t.crossOriginPolicy&&(t.crossOriginPolicy=void 0!==t.tileSource.crossOriginPolicy?t.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===t.ajaxWithCredentials&&(t.ajaxWithCredentials=this.ajaxWithCredentials),void 0===t.loadTilesWithAjax&&(t.loadTilesWithAjax=this.loadTilesWithAjax),void 0===t.ajaxHeaders||null===t.ajaxHeaders?t.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(t.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(t.ajaxHeaders=e.extend({},this.ajaxHeaders,t.ajaxHeaders));var i={options:t};function r(e){for(var r=0;r<n._loadQueue.length;r++)if(n._loadQueue[r]===i){n._loadQueue.splice(r,1);break}0===n._loadQueue.length&&o(i),n.raiseEvent("add-item-failed",e),t.error&&t.error(e)}function o(e){n.collectionMode&&(n.world.arrange({immediately:e.options.collectionImmediately,rows:n.collectionRows,columns:n.collectionColumns,layout:n.collectionLayout,tileSize:n.collectionTileSize,tileMargin:n.collectionTileMargin}),n.world.setAutoRefigureSizes(!0))}function s(){for(var t,i,r;n._loadQueue.length&&(t=n._loadQueue[0]).tileSource;){if(n._loadQueue.splice(0,1),t.options.replace){var s=n.world.getIndexOfItem(t.options.replaceItem);-1!=s&&(t.options.index=s),n.world.removeItem(t.options.replaceItem)}i=new e.TiledImage({viewer:n,source:t.tileSource,viewport:n.viewport,drawer:n.drawer,tileCache:n.tileCache,imageLoader:n.imageLoader,x:t.options.x,y:t.options.y,width:t.options.width,height:t.options.height,fitBounds:t.options.fitBounds,fitBoundsPlacement:t.options.fitBoundsPlacement,clip:t.options.clip,placeholderFillStyle:t.options.placeholderFillStyle,opacity:t.options.opacity,preload:t.options.preload,degrees:t.options.degrees,compositeOperation:t.options.compositeOperation,springStiffness:n.springStiffness,animationTime:n.animationTime,minZoomImageRatio:n.minZoomImageRatio,wrapHorizontal:n.wrapHorizontal,wrapVertical:n.wrapVertical,immediateRender:n.immediateRender,blendTime:n.blendTime,alwaysBlend:n.alwaysBlend,minPixelRatio:n.minPixelRatio,smoothTileEdgesMinZoom:n.smoothTileEdgesMinZoom,iOSDevice:n.iOSDevice,crossOriginPolicy:t.options.crossOriginPolicy,ajaxWithCredentials:t.options.ajaxWithCredentials,loadTilesWithAjax:t.options.loadTilesWithAjax,ajaxHeaders:t.options.ajaxHeaders,debugMode:n.debugMode}),n.collectionMode&&n.world.setAutoRefigureSizes(!1),n.world.addItem(i,{index:t.options.index}),0===n._loadQueue.length&&o(t),1!==n.world.getItemCount()||n.preserveViewport||n.viewport.goHome(!0),n.navigator&&(r=e.extend({},t.options,{replace:!1,originalTiledImage:i,tileSource:t.tileSource}),n.navigator.addTiledImage(r)),t.options.success&&t.options.success({item:i})}}e.isArray(t.tileSource)?setTimeout((function(){r({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:t.tileSource,options:t})})):(this._loadQueue.push(i),function(t,n,i,r,o){var s=t;if("string"==e.type(n))if(n.match(/^\s*<.*>\s*$/))n=e.parseXml(n);else if(n.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var a=e.parseJSON(n);n=a}catch(e){}function l(e,t){e.ready?r(e):(e.addHandler("ready",(function(){r(e)})),e.addHandler("open-failed",(function(e){o({message:e.message,source:t})})))}setTimeout((function(){if("string"==e.type(n))(n=new e.TileSource({url:n,crossOriginPolicy:void 0!==i.crossOriginPolicy?i.crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,ajaxHeaders:t.ajaxHeaders,useCanvas:t.useCanvas,success:function(e){r(e.tileSource)}})).addHandler("open-failed",(function(e){o(e)}));else if(e.isPlainObject(n)||n.nodeType)if(void 0!==n.crossOriginPolicy||void 0===i.crossOriginPolicy&&void 0===t.crossOriginPolicy||(n.crossOriginPolicy=void 0!==i.crossOriginPolicy?i.crossOriginPolicy:t.crossOriginPolicy),void 0===n.ajaxWithCredentials&&(n.ajaxWithCredentials=t.ajaxWithCredentials),void 0===n.useCanvas&&(n.useCanvas=t.useCanvas),e.isFunction(n.getTileUrl)){var a=new e.TileSource(n);a.getTileUrl=n.getTileUrl,r(a)}else{var c=e.TileSource.determineType(s,n);if(!c)return void o({message:"Unable to load TileSource",source:n});var u=c.prototype.configure.apply(s,[n]);l(new c(u),n)}else l(n,n)}))}(this,t.tileSource,t,(function(e){i.tileSource=e,s()}),(function(e){e.options=t,r(e),s()})))},addSimpleImage:function(t){e.console.assert(t,"[Viewer.addSimpleImage] options is required"),e.console.assert(t.url,"[Viewer.addSimpleImage] options.url is required");var n=e.extend({},t,{tileSource:{type:"image",url:t.url}});delete n.url,this.addTiledImage(n)},addLayer:function(t){var n=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var i=e.extend({},t,{success:function(e){n.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){n.raiseEvent("add-layer-failed",e)}});return this.addTiledImage(i),this},getLayerAtLevel:function(t){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(t)},getLevelOfLayer:function(t){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(t)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(t,n){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(t,n)},removeLayer:function(t){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(t)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var t=e.delegate(this,u),n=e.delegate(this,h),i=e.delegate(this,U),r=e.delegate(this,V),o=this.navImages,s=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(s=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:O(this.prefixUrl,o.previous.REST),srcGroup:O(this.prefixUrl,o.previous.GROUP),srcHover:O(this.prefixUrl,o.previous.HOVER),srcDown:O(this.prefixUrl,o.previous.DOWN),onRelease:r,onFocus:t,onBlur:n}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:O(this.prefixUrl,o.next.REST),srcGroup:O(this.prefixUrl,o.next.GROUP),srcHover:O(this.prefixUrl,o.next.HOVER),srcDown:O(this.prefixUrl,o.next.DOWN),onRelease:i,onFocus:t,onBlur:n}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),s&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var t=e.delegate(this,k),n=e.delegate(this,I),i=e.delegate(this,H),r=e.delegate(this,M),o=e.delegate(this,A),s=e.delegate(this,F),a=e.delegate(this,j),l=e.delegate(this,z),c=e.delegate(this,N),d=e.delegate(this,$),p=e.delegate(this,u),f=e.delegate(this,h),m=this.navImages,g=[],v=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(v=!1),this.showZoomControl&&(g.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:O(this.prefixUrl,m.zoomIn.REST),srcGroup:O(this.prefixUrl,m.zoomIn.GROUP),srcHover:O(this.prefixUrl,m.zoomIn.HOVER),srcDown:O(this.prefixUrl,m.zoomIn.DOWN),onPress:t,onRelease:n,onClick:i,onEnter:t,onExit:n,onFocus:p,onBlur:f})),g.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:O(this.prefixUrl,m.zoomOut.REST),srcGroup:O(this.prefixUrl,m.zoomOut.GROUP),srcHover:O(this.prefixUrl,m.zoomOut.HOVER),srcDown:O(this.prefixUrl,m.zoomOut.DOWN),onPress:r,onRelease:n,onClick:o,onEnter:r,onExit:n,onFocus:p,onBlur:f}))),this.showHomeControl&&g.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:O(this.prefixUrl,m.home.REST),srcGroup:O(this.prefixUrl,m.home.GROUP),srcHover:O(this.prefixUrl,m.home.HOVER),srcDown:O(this.prefixUrl,m.home.DOWN),onRelease:s,onFocus:p,onBlur:f})),this.showFullPageControl&&g.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:O(this.prefixUrl,m.fullpage.REST),srcGroup:O(this.prefixUrl,m.fullpage.GROUP),srcHover:O(this.prefixUrl,m.fullpage.HOVER),srcDown:O(this.prefixUrl,m.fullpage.DOWN),onRelease:a,onFocus:p,onBlur:f})),this.showRotationControl&&(g.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:O(this.prefixUrl,m.rotateleft.REST),srcGroup:O(this.prefixUrl,m.rotateleft.GROUP),srcHover:O(this.prefixUrl,m.rotateleft.HOVER),srcDown:O(this.prefixUrl,m.rotateleft.DOWN),onRelease:l,onFocus:p,onBlur:f})),g.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:O(this.prefixUrl,m.rotateright.REST),srcGroup:O(this.prefixUrl,m.rotateright.GROUP),srcHover:O(this.prefixUrl,m.rotateright.HOVER),srcDown:O(this.prefixUrl,m.rotateright.DOWN),onRelease:c,onFocus:p,onBlur:f}))),this.showFlipControl&&g.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:O(this.prefixUrl,m.flip.REST),srcGroup:O(this.prefixUrl,m.flip.GROUP),srcHover:O(this.prefixUrl,m.flip.HOVER),srcDown:O(this.prefixUrl,m.flip.DOWN),onRelease:d,onFocus:p,onBlur:f})),v&&(this.buttons=new e.ButtonGroup({buttons:g,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",e.delegate(this,B)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&e>=0&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(t,n,i,s){var a;if(a=e.isPlainObject(t)?t:{element:t,location:n,placement:i,onDraw:s},t=e.getElement(a.element),o(this.currentOverlays,t)>=0)return this;var l=r(this,a);return this.currentOverlays.push(l),l.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:t,location:a.location,placement:a.placement}),this},updateOverlay:function(n,i,r){var s;return n=e.getElement(n),(s=o(this.currentOverlays,n))>=0&&(this.currentOverlays[s].update(i,r),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:n,location:i,placement:r})),this},removeOverlay:function(n){var i;return n=e.getElement(n),(i=o(this.currentOverlays,n))>=0&&(this.currentOverlays[i].destroy(),this.currentOverlays.splice(i,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:n})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(t){var n;return t=e.getElement(t),(n=o(this.currentOverlays,t))>=0?this.currentOverlays[n]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(t){this._hideMessage();var n=e.makeNeutralElement("div");n.appendChild(document.createTextNode(t)),this.messageDiv=e.makeCenteredNode(n),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var e,t=this.currentOverlays.length;for(e=0;e<t;e++)this.currentOverlays[e].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(e){function t(e){var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",t),!t.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var n=this.viewport.pointFromPixel(e.position);this.panVertical?this.panHorizontal||(n.x=this.viewer.viewport.getCenter(!0).x):n.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(n),this.viewer.viewport.applyConstraints()}}function n(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function i(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function r(e){return this.viewer.raiseEvent("navigator-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function o(e,t){s(e,"rotate("+t+"deg)")}function s(e,t){e.style.webkitTransform=t,e.style.mozTransform=t,e.style.msTransform=t,e.style.oTransform=t,e.style.transform=t}e.Navigator=function(s){var a,l,c,u,h=s.viewer,d=this;function p(e){o(d.displayRegionContainer,e),o(d.displayRegion,-e),d.viewport.setRotation(e)}(s.id?(this.element=document.getElementById(s.id),s.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(s.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),s.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:s.autoFade},s.position&&("BOTTOM_RIGHT"==s.position?s.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==s.position?s.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==s.position?s.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==s.position?s.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"==s.position&&(s.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,s.controlOptions.top=s.top,s.controlOptions.left=s.left,s.controlOptions.height=s.height,s.controlOptions.width=s.width))),this.element.id=s.id,this.element.className+=" navigator",(s=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},s,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:s.autoResize,minZoomImageRatio:1,background:s.background,opacity:s.opacity,borderColor:s.borderColor,displayRegionColor:s.displayRegionColor})).minPixelRatio=this.minPixelRatio=h.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),s.controlOptions.anchor!=e.ControlAnchor.NONE&&(c=this.element.style,u=this.borderWidth,c.margin="0px",c.border=u+"px solid "+s.borderColor,c.padding="0px",c.background=s.background,c.opacity=s.opacity,c.overflow="hidden"),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid "+s.displayRegionColor,e.margin="0px",e.padding="0px",e.background="transparent",e.float="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",h.addControl(this.element,s.controlOptions),this._resizeWithViewer=s.controlOptions.anchor!=e.ControlAnchor.ABSOLUTE&&s.controlOptions.anchor!=e.ControlAnchor.NONE,this._resizeWithViewer&&(s.width&&s.height?(this.element.style.height="number"==typeof s.height?s.height+"px":s.height,this.element.style.width="number"==typeof s.width?s.width+"px":s.width):(a=e.getElementSize(h.element),this.element.style.height=Math.round(a.y*s.sizeRatio)+"px",this.element.style.width=Math.round(a.x*s.sizeRatio)+"px",this.oldViewerSize=a),l=e.getElementSize(this.element),this.elementArea=l.x*l.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[s]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),s.navigatorRotate)&&(p(s.viewer.viewport?s.viewer.viewport.getRotation():s.viewer.degrees||0),s.viewer.addHandler("rotate",(function(e){p(e.degrees)})));this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,n),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,i),scrollHandler:e.delegate(this,r)}),this.addHandler("reset-size",(function(){d.viewport&&d.viewport.goHome(!0)})),h.world.addHandler("item-index-change",(function(e){window.setTimeout((function(){var t=d.world.getItemAt(e.previousIndex);d.world.setItemIndex(t,e.newIndex)}),1)})),h.world.addHandler("remove-item",(function(e){var t=e.item,n=d._getMatchingItem(t);n&&d.world.removeItem(n)})),this.update(h.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.drawer.clear(),this.world.draw())}},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){s(this.displayRegion,e),s(this.canvas,e),s(this.element,e)},update:function(t){var n,i,r,o,s,a;if(n=e.getElementSize(this.viewer.element),this._resizeWithViewer&&n.x&&n.y&&!n.equals(this.oldViewerSize)&&(this.oldViewerSize=n,this.maintainSizeRatio||!this.elementArea?(i=n.x*this.sizeRatio,r=n.y*this.sizeRatio):(i=Math.sqrt(this.elementArea*(n.x/n.y)),r=this.elementArea/i),this.element.style.width=Math.round(i)+"px",this.element.style.height=Math.round(r)+"px",this.elementArea||(this.elementArea=i*r),this.updateSize()),t&&this.viewport){o=t.getBoundsNoRotate(!0),s=this.viewport.pixelFromPointNoRotate(o.getTopLeft(),!1),a=this.viewport.pixelFromPointNoRotate(o.getBottomRight(),!1).minus(this.totalBorderWidths);var l=this.displayRegion.style;l.display=this.world.getItemCount()?"block":"none",l.top=Math.round(s.y)+"px",l.left=Math.round(s.x)+"px";var c=Math.abs(s.x-a.x),u=Math.abs(s.y-a.y);l.width=Math.round(Math.max(c,0))+"px",l.height=Math.round(Math.max(u,0))+"px"}},addTiledImage:function(t){var n=this,i=t.originalTiledImage;delete t.original;var r=e.extend({},t,{success:function(e){var t=e.item;function r(){n._matchBounds(t,i)}t._originalForNavigator=i,n._matchBounds(t,i,!0),i.addHandler("bounds-change",r),i.addHandler("clip-change",r),i.addHandler("opacity-change",(function(){n._matchOpacity(t,i)})),i.addHandler("composite-operation-change",(function(){n._matchCompositeOperation(t,i)}))}});return e.Viewer.prototype.addTiledImage.apply(this,[r])},_getMatchingItem:function(e){for(var t,n=this.world.getItemCount(),i=0;i<n;i++)if((t=this.world.getItemAt(i))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,n){var i=t.getBoundsNoRotate();e.setPosition(i.getTopLeft(),n),e.setWidth(i.width,n),e.setRotation(t.getRotation(),n),e.setClip(t.getClip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(n){var i,r=n.split("."),o=null,s=arguments,a=t;for(i=0;i<r.length-1;i++)a=a[r[i]]||{};return"string"!=typeof(o=a[r[i]])&&(e.console.log("Untranslated source string:",n),o=""),o.replace(/\{\d+\}/g,(function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<s.length?s[t]:""}))},setString:function(e,n){var i,r=e.split("."),o=t;for(i=0;i<r.length-1;i++)o[r[i]]||(o[r[i]]={}),o=o[r[i]];o[r[i]]=n}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,n){var i,r;if(n=n||new e.Point(0,0),t%90==0){switch(e.positiveModulo(t,360)){case 0:i=1,r=0;break;case 90:i=0,r=1;break;case 180:i=-1,r=0;break;case 270:i=0,r=-1}}else{var o=t*Math.PI/180;i=Math.cos(o),r=Math.sin(o)}var s=i*(this.x-n.x)-r*(this.y-n.y)+n.x,a=r*(this.x-n.x)+i*(this.y-n.y)+n.y;return new e.Point(s,a)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(e){e.TileSource=function(t,n,i,r,o,s){var a,l,c=this,u=arguments;if(a=e.isPlainObject(t)?t:{width:u[0],height:u[1],tileSize:u[2],tileOverlap:u[3],minLevel:u[4],maxLevel:u[5]},e.EventSource.call(this),e.extend(!0,this,a),!this.success)for(l=0;l<arguments.length;l++)if(e.isFunction(arguments[l])){this.success=arguments[l];break}this.success&&this.addHandler("ready",(function(e){c.success(e)})),"string"==e.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=a.width&&a.height?a.width/a.height:1,this.dimensions=new e.Point(a.width,a.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=a.tileOverlap?a.tileOverlap:0,this.minLevel=a.minLevel?a.minLevel:0,this.maxLevel=void 0!==a.maxLevel&&null!==a.maxLevel?a.maxLevel:a.width&&a.height?Math.ceil(Math.log(Math.max(a.width,a.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(t){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},getLevelScale:function(e){var t,n={};for(t=0;t<=this.maxLevel;t++)n[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return n[e]},this.getLevelScale(e)},getNumTiles:function(t){var n=this.getLevelScale(t),i=Math.ceil(n*this.dimensions.x/this.getTileWidth(t)),r=Math.ceil(n*this.dimensions.y/this.getTileHeight(t));return new e.Point(i,r)},getPixelRatio:function(t){var n=this.dimensions.times(this.getLevelScale(t)),i=1/n.x,r=1/n.y;return new e.Point(i,r)},getClosestLevel:function(){var e,t;for(e=this.minLevel+1;e<=this.maxLevel&&!((t=this.getNumTiles(e)).x>1||t.y>1);e++);return e-1},getTileAtPoint:function(t,n){var i=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio;e.console.assert(i,"[TileSource.getTileAtPoint] must be called with a valid point.");var r=this.dimensions.x*this.getLevelScale(t),o=n.x*r,s=n.y*r,a=Math.floor(o/this.getTileWidth(t)),l=Math.floor(s/this.getTileHeight(t));n.x>=1&&(a=this.getNumTiles(t).x-1);return n.y>=1/this.aspectRatio-1e-15&&(l=this.getNumTiles(t).y-1),new e.Point(a,l)},getTileBounds:function(t,n,i,r){var o=this.dimensions.times(this.getLevelScale(t)),s=this.getTileWidth(t),a=this.getTileHeight(t),l=0===n?0:s*n-this.tileOverlap,c=0===i?0:a*i-this.tileOverlap,u=s+(0===n?1:2)*this.tileOverlap,h=a+(0===i?1:2)*this.tileOverlap,d=1/o.x;return u=Math.min(u,o.x-l),h=Math.min(h,o.y-c),r?new e.Rect(0,0,u,h):new e.Rect(l*d,c*d,u*d,h*d)},getImageInfo:function(t){var n,i,r,o,s,a,l,c=this;t&&(l=(a=(s=t.split("/"))[s.length-1]).lastIndexOf("."))>-1&&(s[s.length-1]=a.slice(0,l)),i=function(n){"string"==typeof n&&(n=e.parseXml(n));var i=e.TileSource.determineType(c,n,t);i?(void 0===(o=i.prototype.configure.apply(c,[n,t])).ajaxWithCredentials&&(o.ajaxWithCredentials=c.ajaxWithCredentials),r=new i(o),c.ready=!0,c.raiseEvent("ready",{tileSource:r})):c.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t})},t.match(/\.js$/)?(n=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:n,callback:i})):e.makeAjaxRequest({url:t,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(t){var n=function(t){var n,i,r=t.responseText,o=t.status;if(!t)throw new Error(e.getString("Errors.Security"));if(200!==t.status&&0!==t.status)throw o=t.status,n=404==o?"Not Found":t.statusText,new Error(e.getString("Errors.Status",o,n));if(r.match(/\s*<.*/))try{i=t.responseXML&&t.responseXML.documentElement?t.responseXML:e.parseXml(r)}catch(e){i=t.responseText}else if(r.match(/\s*[\{\[].*/))try{i=e.parseJSON(r)}catch(e){i=r}else i=r;return i}(t);i(n)},error:function(e,n){var i;try{i="HTTP "+e.status+" attempting to load TileSource"}catch(e){i=(void 0!==n&&n.toString?n.toString():"Unknown error")+" attempting to load TileSource"}c.raiseEvent("open-failed",{message:i,source:t})}})},supports:function(e,t){return!1},configure:function(e,t){throw new Error("Method not implemented.")},getTileUrl:function(e,t,n){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(e,t,n){return{}},tileExists:function(e,t,n){var i=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&n>=0&&t<i.x&&n<i.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype),e.TileSource.determineType=function(t,n,i){var r;for(r in OpenSeadragon)if(r.match(/.+TileSource$/)&&e.isFunction(OpenSeadragon[r])&&e.isFunction(OpenSeadragon[r].prototype.supports)&&OpenSeadragon[r].prototype.supports.call(t,n,i))return OpenSeadragon[r];e.console.error("No TileSource was able to open %s %s",i,n)}}(OpenSeadragon),function(e){function t(t,n){var i,r,o=n.Image,s=o.Url,a=o.Format,l=o.Size,c=o.DisplayRect||[],u=parseInt(l.Width,10),h=parseInt(l.Height,10),d=parseInt(o.TileSize,10),p=parseInt(o.Overlap,10),f=[];for(r=0;r<c.length;r++)i=c[r].Rect,f.push(new e.DisplayRect(parseInt(i.X,10),parseInt(i.Y,10),parseInt(i.Width,10),parseInt(i.Height,10),parseInt(i.MinLevel,10),parseInt(i.MaxLevel,10)));return e.extend(!0,{width:u,height:h,tileSize:d,tileOverlap:p,minLevel:null,maxLevel:null,tilesUrl:s,fileFormat:a,displayRects:f},n)}e.DziTileSource=function(t,n,i,r,o,s,a,l,c){var u,h,d,p;if(p=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=p.tilesUrl,this.fileFormat=p.fileFormat,this.displayRects=p.displayRects,this.displayRects)for(u=this.displayRects.length-1;u>=0;u--)for(d=(h=this.displayRects[u]).minLevel;d<=h.maxLevel;d++)this._levelRects[d]||(this._levelRects[d]=[]),this._levelRects[d].push(h);e.TileSource.apply(this,[p])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){var n;return e.Image?n=e.Image.xmlns:e.documentElement&&("Image"!=e.documentElement.localName&&"Image"!=e.documentElement.tagName||(n=e.documentElement.namespaceURI)),-1!==(n=(n||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==n.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(n,i){var r;return r=e.isPlainObject(n)?t(this,n):function(n,i){if(!i||!i.documentElement)throw new Error(e.getString("Errors.Xml"));var r,o,s,a,l,c=i.documentElement,u=c.localName||c.tagName,h=i.documentElement.namespaceURI,d=null,p=[];if("Image"==u)try{if(void 0===(a=c.getElementsByTagName("Size")[0])&&(a=c.getElementsByTagNameNS(h,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:c.getAttribute("Url"),Format:c.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(c.getAttribute("Overlap"),10),TileSize:parseInt(c.getAttribute("TileSize"),10),Size:{Height:parseInt(a.getAttribute("Height"),10),Width:parseInt(a.getAttribute("Width"),10)}}},!e.imageFormatSupported(d.Image.Format))throw new Error(e.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(void 0===(r=c.getElementsByTagName("DisplayRect"))&&(r=c.getElementsByTagNameNS(h,"DisplayRect")[0]),l=0;l<r.length;l++)o=r[l],void 0===(s=o.getElementsByTagName("Rect")[0])&&(s=o.getElementsByTagNameNS(h,"Rect")[0]),p.push({Rect:{X:parseInt(s.getAttribute("X"),10),Y:parseInt(s.getAttribute("Y"),10),Width:parseInt(s.getAttribute("Width"),10),Height:parseInt(s.getAttribute("Height"),10),MinLevel:parseInt(o.getAttribute("MinLevel"),10),MaxLevel:parseInt(o.getAttribute("MaxLevel"),10)}});return p.length&&(d.Image.DisplayRect=p),t(n,d)}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.Dzi"))}else{if("Collection"==u)throw new Error(e.getString("Errors.Dzc"));if("Error"==u){var f=c.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(f)}}throw new Error(e.getString("Errors.Dzi"))}(this,n),i&&!r.tilesUrl&&(r.tilesUrl=i.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=i.search(/\.(dzi|xml|js)\?/)?r.queryParams=i.match(/\?.*/):r.queryParams=""),r},getTileUrl:function(e,t,n){return[this.tilesUrl,e,"/",t,"_",n,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,n){var i,r,o,s,a,l,c,u=this._levelRects[e];if(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)return!1;if(!u||!u.length)return!0;for(c=u.length-1;c>=0;c--)if(!(e<(i=u[c]).minLevel||e>i.maxLevel)&&(r=this.getLevelScale(e),o=i.x*r,s=i.y*r,a=o+i.width*r,l=s+i.height*r,o=Math.floor(o/this._tileWidth),s=Math.floor(s/this._tileWidth),a=Math.ceil(a/this._tileWidth),l=Math.ceil(l/this._tileWidth),o<=t&&t<a&&s<=n&&n<l))return!0;return!1}})}(OpenSeadragon),function(e){e.IIIFTileSource=function(t){if(e.extend(!0,this,t),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(t.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.tile_width&&this.tile_height)t.tileWidth=this.tile_width,t.tileHeight=this.tile_height;else if(this.tile_width)t.tileSize=this.tile_width;else if(this.tile_height)t.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)t.tileWidth=this.tiles[0].width,t.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var n=0;n<this.tiles.length;n++)for(var i=0;i<this.tiles[n].scaleFactors.length;i++){var r=this.tiles[n].scaleFactors[i];this.scale_factors.push(r),t.tileSizePerScaleFactor[r]={width:this.tiles[n].width,height:this.tiles[n].height||this.tiles[n].width}}}else if(function(e){var t=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json"].indexOf(e[0]),n=!1;e.length>1&&e[1].supports&&(n=-1!==e[1].supports.indexOf("sizeByW"));return!t||n}(t.profile)){for(var o=Math.min(this.height,this.width),s=[256,512,1024],a=[],l=0;l<s.length;l++)s[l]<=o&&a.push(s[l]);a.length>0?t.tileSize=Math.max.apply(null,a):t.tileSize=o}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,t.levels=function(e){for(var t=[],n=0;n<e.sizes.length;n++)t.push({url:e["@id"]+"/full/"+e.sizes[n].width+",/0/default."+e.tileFormat,width:e.sizes[n].width,height:e.sizes[n].height});return t.sort((function(e,t){return e.width-t.width}))}(this),e.extend(!0,t,{width:t.levels[t.levels.length-1].width,height:t.levels[t.levels.length-1].height,tileSize:Math.max(t.height,t.width),tileOverlap:0,minLevel:0,maxLevel:t.levels.length-1}),this.levels=t.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!t.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var c=Math.max.apply(null,this.scale_factors);t.maxLevel=Math.round(Math.log(c)*Math.LOG2E)}else t.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));e.TileSource.apply(this,[t])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return!(!e.protocol||"http://iiif.io/api/image"!=e.protocol)||(!(!e["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=e["@context"]&&"http://iiif.io/api/image/1/context.json"!=e["@context"])||(!(!e.profile||0!==e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(e.identifier&&e.width&&e.height)||!(!e.documentElement||"info"!=e.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=e.documentElement.namespaceURI))))},configure:function(t,n){if(e.isPlainObject(t)){if(t["@context"]||(t["@context"]="http://iiif.io/api/image/1.0/context.json",t["@id"]=n.replace("/info.json","")),t.preferredFormats)for(var i=0;i<t.preferredFormats.length;i++)if(OpenSeadragon.imageFormatSupported(t.preferredFormats[i])){t.tileFormat=t.preferredFormats[i];break}return t}var r=function(t){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var n=t.documentElement,i=n.tagName,r=null;if("info"==i)try{return function t(n,i,r){var o,s;if(3==n.nodeType&&r)(s=n.nodeValue.trim()).match(/^\d*$/)&&(s=Number(s)),i[r]?(e.isArray(i[r])||(i[r]=[i[r]]),i[r].push(s)):i[r]=s;else if(1==n.nodeType)for(o=0;o<n.childNodes.length;o++)t(n.childNodes[o],i,n.nodeName)}(n,r={}),r}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}(t);return r["@context"]="http://iiif.io/api/image/1.0/context.json",r["@id"]=n.replace("/info.xml",""),r},getTileWidth:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,t);var n=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[n]?this.tileSizePerScaleFactor[n].width:this._tileWidth},getTileHeight:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,t);var n=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[n]?this.tileSizePerScaleFactor[n].height:this._tileHeight},getLevelScale:function(t){if(this.emulateLegacyImagePyramid){var n=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(n=this.levels[t].width/this.levels[this.maxLevel].width),n}return e.TileSource.prototype.getLevelScale.call(this,t)},getNumTiles:function(t){return this.emulateLegacyImagePyramid?this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0):e.TileSource.prototype.getNumTiles.call(this,t)},getTileAtPoint:function(t,n){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,t,n)},getTileUrl:function(e,t,n){if(this.emulateLegacyImagePyramid){var i=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(i=this.levels[e].url),i}var r,o,s,a,l,c,u,h,d,p,f,m,g,v=Math.pow(.5,this.maxLevel-e),y=Math.ceil(this.width*v),w=Math.ceil(this.height*v);return r=this.getTileWidth(e),o=this.getTileHeight(e),s=Math.ceil(r/v),a=Math.ceil(o/v),m=(g=this["@context"].indexOf("/1.0/context.json")>-1||this["@context"].indexOf("/1.1/context.json")>-1||this["@context"].indexOf("/1/context.json")>-1)?"native."+this.tileFormat:"default."+this.tileFormat,y<r&&w<o?(p=g||y!==this.width?y+",":"max",l="full"):(c=t*s,u=n*a,h=Math.min(s,this.width-c),d=Math.min(a,this.height-u),l=0===t&&0===n&&h===this.width&&d===this.height?"full":[c,u,h,d].join(","),f=Math.ceil(h*v),p=g||f!==this.width?f+",":"max"),[this["@id"],l,p,"0",m].join("/")}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t,n,i,r,o){var s;(s=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}).width&&s.height||(s.width=65572864,s.height=65572864),s.tileSize||(s.tileSize=256,s.tileOverlap=0),s.tilesUrl||(s.tilesUrl="http://tile.openstreetmap.org/"),s.minLevel=8,e.TileSource.apply(this,[s])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"openstreetmaps"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,n){return this.tilesUrl+(e-8)+"/"+t+"/"+n+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t,n,i,r,o){var s;s=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var a,l=256*Math.ceil(s.width/256),c=256*Math.ceil(s.height/256);a=l>c?l/256:c/256,s.maxLevel=Math.ceil(Math.log(a)/Math.log(2))-1,s.tileSize=256,s.width=l,s.height=c,e.TileSource.apply(this,[s])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"tiledmapservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,n){var i=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(i-n)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(e){e.tileSize=256;var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,n){return{x:Math.ceil(e/n),y:Math.ceil(t/n)}},_calculateAbsoluteTileNumber:function(e,t,n){for(var i=0,r={},o=0;o<e;o++)i+=(r=this.gridSize[o]).x*r.y;return i+=(r=this.gridSize[e]).x*n+t},supports:function(e,t){return e.type&&"zoomifytileservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,n){var i,r=this._calculateAbsoluteTileNumber(e,t,n);return i=Math.floor(r/256),this.tilesUrl+"TileGroup"+i+"/"+e+"-"+t+"-"+n+".jpg"}})}(OpenSeadragon),function(e){function t(e,t){return t.levels}e.LegacyTileSource=function(t){var n,i,r;e.isArray(t)&&(n={type:"legacy-image-pyramid",levels:t}),n.levels=function(t){var n,i,r=[];for(i=0;i<t.length;i++)(n=t[i]).height&&n.width&&n.url?r.push({url:n.url,width:Number(n.width),height:Number(n.height)}):e.console.error("Unsupported image format: %s",n.url?n.url:"<no URL>");return r.sort((function(e,t){return e.height-t.height}))}(n.levels),n.levels.length>0?(i=n.levels[n.levels.length-1].width,r=n.levels[n.levels.length-1].height):(i=0,r=0,e.console.error("No supported image formats found")),e.extend(!0,n,{width:i,height:r,tileSize:Math.max(r,i),tileOverlap:0,minLevel:0,maxLevel:n.levels.length>0?n.levels.length-1:0}),e.TileSource.apply(this,[n]),this.levels=n.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(n,i){return e.isPlainObject(n)?t(this,n):function(n,i){if(!i||!i.documentElement)throw new Error(e.getString("Errors.Xml"));var r,o,s=i.documentElement,a=s.tagName,l=null,c=[];if("image"==a)try{for(l={type:s.getAttribute("type"),levels:[]},c=s.getElementsByTagName("level"),o=0;o<c.length;o++)r=c[o],l.levels.push({url:r.getAttribute("url"),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10)});return t(n,l)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==a)throw new Error("Error: "+i)}throw new Error("Unknown element "+a)}(this,n)},getLevelScale:function(e){var t=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,n){var i=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(i=this.levels[e].url),i}})}(OpenSeadragon),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"image"===e.type},configure:function(e,t){return e},getImageInfo:function(t){var n=this._image=new Image,i=this;this.crossOriginPolicy&&(n.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(n.useCredentials=this.ajaxWithCredentials),e.addEvent(n,"load",(function(){i.width=Object.prototype.hasOwnProperty.call(n,"naturalWidth")?n.naturalWidth:n.width,i.height=Object.prototype.hasOwnProperty.call(n,"naturalHeight")?n.naturalHeight:n.height,i.aspectRatio=i.width/i.height,i.dimensions=new e.Point(i.width,i.height),i._tileWidth=i.width,i._tileHeight=i.height,i.tileOverlap=0,i.minLevel=0,i.levels=i._buildLevels(),i.maxLevel=i.levels.length-1,i.ready=!0,i.raiseEvent("ready",{tileSource:i})})),e.addEvent(n,"error",(function(){i.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})})),n.src=t},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,n){var i=null;return e>=this.minLevel&&e<=this.maxLevel&&(i=this.levels[e].url),i},getContext2D:function(e,t,n){var i=null;return e>=this.minLevel&&e<=this.maxLevel&&(i=this.levels[e].context2D),i},_buildLevels:function(){var t=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var n=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,i=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,r=document.createElement("canvas"),o=r.getContext("2d");if(r.width=n,r.height=i,o.drawImage(this._image,0,0,n,i),t[0].context2D=o,delete this._image,e.isCanvasTainted(r))return t;for(;n>=2&&i>=2;){n=Math.floor(n/2),i=Math.floor(i/2);var s=document.createElement("canvas"),a=s.getContext("2d");s.width=n,s.height=i,a.drawImage(r,0,0,n,i),t.splice(0,0,{context2D:a,width:n,height:i}),r=s,o=a}return t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t,n,i,r){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(e){function t(n){e.requestAnimationFrame((function(){!function(n){var i,r,o;n.shouldFade&&(i=e.now(),r=i-n.fadeBeginTime,o=1-r/n.fadeLength,o=Math.min(1,o),o=Math.max(0,o),n.imgGroup&&e.setElementOpacity(n.imgGroup,o,!0),o>0&&t(n))}(n)}))}function n(t,n){t.element.disabled||(n>=e.ButtonState.GROUP&&t.currentState==e.ButtonState.REST&&(!function(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}(t),t.currentState=e.ButtonState.GROUP),n>=e.ButtonState.HOVER&&t.currentState==e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),n>=e.ButtonState.DOWN&&t.currentState==e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function i(n,i){n.element.disabled||(i<=e.ButtonState.HOVER&&n.currentState==e.ButtonState.DOWN&&(n.imgDown&&(n.imgDown.style.visibility="hidden"),n.currentState=e.ButtonState.HOVER),i<=e.ButtonState.GROUP&&n.currentState==e.ButtonState.HOVER&&(n.imgHover&&(n.imgHover.style.visibility="hidden"),n.currentState=e.ButtonState.GROUP),i<=e.ButtonState.REST&&n.currentState==e.ButtonState.GROUP&&(!function(n){n.shouldFade=!0,n.fadeBeginTime=e.now()+n.fadeDelay,window.setTimeout((function(){t(n)}),n.fadeDelay)}(n),n.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var r=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("div"),t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t){t.insideElementPressed?(n(r,e.ButtonState.DOWN),r.raiseEvent("enter",{originalEvent:t.originalEvent})):t.buttonDownAny||n(r,e.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),r.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(t){i(r,e.ButtonState.GROUP),t.insideElementPressed&&r.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){this.exitHandler(e),r.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(t){n(r,e.ButtonState.DOWN),r.raiseEvent("press",{originalEvent:t.originalEvent})},releaseHandler:function(t){t.insideElementPressed&&t.insideElementReleased?(i(r,e.ButtonState.HOVER),r.raiseEvent("release",{originalEvent:t.originalEvent})):t.insideElementPressed?i(r,e.ButtonState.GROUP):n(r,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&r.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13!==e.keyCode||(r.raiseEvent("click",{originalEvent:e.originalEvent}),r.raiseEvent("release",{originalEvent:e.originalEvent}),!1)}}),i(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){n(this,e.ButtonState.GROUP)},notifyGroupExit:function(){i(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var n,i=this.buttons.concat([]),r=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",n=0;n<i.length;n++)this.element.appendChild(i[n].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){var t;for(t=0;t<r.buttons.length;t++)r.buttons[t].notifyGroupEnter()},exitHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<r.buttons.length;t++)r.buttons[t].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(e){e.Rect=function(t,n,i,r,o){var s,a;this.x="number"==typeof t?t:0,this.y="number"==typeof n?n:0,this.width="number"==typeof i?i:0,this.height="number"==typeof r?r:0,this.degrees="number"==typeof o?o:0,this.degrees=e.positiveModulo(this.degrees,360),this.degrees>=270?(s=this.getTopRight(),this.x=s.x,this.y=s.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=270):this.degrees>=180?(s=this.getBottomRight(),this.x=s.x,this.y=s.y,this.degrees-=180):this.degrees>=90&&(s=this.getBottomLeft(),this.x=s.x,this.y=s.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=90)},e.Rect.fromSummits=function(t,n,i){var r=t.distanceTo(n),o=t.distanceTo(i),s=n.minus(t),a=Math.atan(s.y/s.x);return s.x<0?a+=Math.PI:s.y<0&&(a+=2*Math.PI),new e.Rect(t.x,t.y,r,o,a/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var n=this.getBoundingBox(),i=t.getBoundingBox(),r=Math.min(n.x,i.x),o=Math.min(n.y,i.y),s=Math.max(n.x+n.width,i.x+i.width),a=Math.max(n.y+n.height,i.y+i.height);return new e.Rect(r,o,s-r,a-o)},intersection:function(t){var n=1e-10,i=[],r=this.getTopLeft();t.containsPoint(r,n)&&i.push(r);var o=this.getTopRight();t.containsPoint(o,n)&&i.push(o);var s=this.getBottomLeft();t.containsPoint(s,n)&&i.push(s);var a=this.getBottomRight();t.containsPoint(a,n)&&i.push(a);var l=t.getTopLeft();this.containsPoint(l,n)&&i.push(l);var c=t.getTopRight();this.containsPoint(c,n)&&i.push(c);var u=t.getBottomLeft();this.containsPoint(u,n)&&i.push(u);var h=t.getBottomRight();this.containsPoint(h,n)&&i.push(h);for(var d=this._getSegments(),p=t._getSegments(),f=0;f<d.length;f++)for(var m=d[f],g=0;g<p.length;g++){var v=p[g],y=w(m[0],m[1],v[0],v[1]);y&&i.push(y)}function w(t,i,r,o){var s=i.minus(t),a=o.minus(r),l=-a.x*s.y+s.x*a.y;if(0===l)return null;var c=(s.x*(t.y-r.y)-s.y*(t.x-r.x))/l,u=(a.x*(t.y-r.y)-a.y*(t.x-r.x))/l;return-n<=c&&c<=1-n&&-n<=u&&u<=1-n?new e.Point(t.x+u*s.x,t.y+u*s.y):null}if(0===i.length)return null;for(var b=i[0].x,S=i[0].x,T=i[0].y,_=i[0].y,x=1;x<i.length;x++){var E=i[x];E.x<b&&(b=E.x),E.x>S&&(S=E.x),E.y<T&&(T=E.y),E.y>_&&(_=E.y)}return new e.Rect(b,T,S-b,_-T)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),n=this.getBottomLeft(),i=this.getBottomRight();return[[e,t],[t,i],[i,n],[n,e]]},rotate:function(t,n){if(0===(t=e.positiveModulo(t,360)))return this.clone();n=n||this.getCenter();var i=this.getTopLeft().rotate(t,n),r=this.getTopRight().rotate(t,n).minus(i);r=r.apply((function(e){return Math.abs(e)<1e-15?0:e}));var o=Math.atan(r.y/r.x);return r.x<0?o+=Math.PI:r.y<0&&(o+=2*Math.PI),new e.Rect(i.x,i.y,this.width,this.height,o/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),n=this.getTopRight(),i=this.getBottomLeft(),r=this.getBottomRight(),o=Math.min(t.x,n.x,i.x,r.x),s=Math.max(t.x,n.x,i.x,r.x),a=Math.min(t.y,n.y,i.y,r.y),l=Math.max(t.y,n.y,i.y,r.y);return new e.Rect(o,a,s-o,l-a)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),n=Math.floor(t.x),i=Math.floor(t.y),r=Math.ceil(t.width+t.x-n),o=Math.ceil(t.height+t.y-i);return new e.Rect(n,i,r,o)},containsPoint:function(e,t){t=t||0;var n=this.getTopLeft(),i=this.getTopRight(),r=this.getBottomLeft(),o=i.minus(n),s=r.minus(n);return(e.x-n.x)*o.x+(e.y-n.y)*o.y>=-t&&(e.x-i.x)*o.x+(e.y-i.y)*o.y<=t&&(e.x-n.x)*s.x+(e.y-n.y)*s.y>=-t&&(e.x-r.x)*s.x+(e.y-r.y)*s.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(e){var t={};function n(t){var n=Number(this.element.style.marginLeft.replace("px","")),i=Number(this.element.style.marginTop.replace("px","")),o=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-t.delta.x>0?n>-(o-a.x)&&(this.element.style.marginLeft=n+2*t.delta.x+"px",r(this,a.x,n+2*t.delta.x)):-t.delta.x<0&&n<0&&(this.element.style.marginLeft=n+2*t.delta.x+"px",r(this,a.x,n+2*t.delta.x)):-t.delta.y>0?i>-(s-a.y)&&(this.element.style.marginTop=i+2*t.delta.y+"px",r(this,a.y,i+2*t.delta.y)):-t.delta.y<0&&i<0&&(this.element.style.marginTop=i+2*t.delta.y+"px",r(this,a.y,i+2*t.delta.y))),!1}function i(t){var n=Number(this.element.style.marginLeft.replace("px","")),i=Number(this.element.style.marginTop.replace("px","")),o=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?t.scroll>0?n>-(o-a.x)&&(this.element.style.marginLeft=n-60*t.scroll+"px",r(this,a.x,n-60*t.scroll)):t.scroll<0&&n<0&&(this.element.style.marginLeft=n-60*t.scroll+"px",r(this,a.x,n-60*t.scroll)):t.scroll<0?i>a.y-s&&(this.element.style.marginTop=i+60*t.scroll+"px",r(this,a.y,i+60*t.scroll)):t.scroll>0&&i<0&&(this.element.style.marginTop=i+60*t.scroll+"px",r(this,a.y,i+60*t.scroll))),!1}function r(t,n,i){var r,o,s,a,l,c,u;for(r="horizontal"==t.scroll?t.panelWidth:t.panelHeight,o=Math.ceil(n/r)+5,c=o=(o=(s=Math.ceil((Math.abs(i)+n)/r)+1)-o)<0?0:o;c<s&&c<t.panels.length;c++)if(!(u=t.panels[c]).activePanel){var h,d=t.viewer.tileSources[c];h=d.referenceStripThumbnailUrl?{type:"image",url:d.referenceStripThumbnailUrl}:d,(a=new e.Viewer({id:u.id,tileSources:[h],element:u,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0})).displayRegion=e.makeNeutralElement("div"),a.displayRegion.id=u.id+"-displayregion",a.displayRegion.className="displayregion",(l=a.displayRegion.style).position="relative",l.top="0px",l.left="0px",l.fontSize="0px",l.overflow="hidden",l.float="left",l.cssFloat="left",l.styleFloat="left",l.zIndex=999999999,l.cursor="default",l.width=t.panelWidth-4+"px",l.height=t.panelHeight-4+"px",a.displayRegion.innerTracker=new e.MouseTracker({element:a.displayRegion,startDisabled:!0}),u.getElementsByTagName("div")[0].appendChild(a.displayRegion),t.miniViewers[u.id]=a,u.activePanel=!0}}function o(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px",!1}function s(t){var n=t.eventSource.element;return"horizontal"==this.scroll?n.style.marginBottom="-"+e.getElementSize(n).y/2+"px":n.style.marginLeft="-"+e.getElementSize(n).x/2+"px",!1}function a(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function l(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return i.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return i.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}e.ReferenceStrip=function(c){var u,h,d,p=c.viewer,f=e.getElementSize(p.element);for(c.id||(c.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=c.id,this.element.className="referencestrip"),c=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},c,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,c),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(h=this.element.style).marginTop="0px",h.marginRight="0px",h.marginBottom="0px",h.marginLeft="0px",h.left="0px",h.bottom="0px",h.border="0px",h.background="#000",h.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=p,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,n),scrollHandler:e.delegate(this,i),enterHandler:e.delegate(this,o),exitHandler:e.delegate(this,s),keyDownHandler:e.delegate(this,a),keyHandler:e.delegate(this,l)}),c.width&&c.height?(this.element.style.width=c.width+"px",this.element.style.height=c.height+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"==c.scroll?(this.element.style.width=f.x*c.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=f.y*c.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=f.y*c.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=f.x*c.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=f.x*this.sizeRatio+8,this.panelHeight=f.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},d=0;d<p.tileSources.length;d++)(u=e.makeNeutralElement("div")).id=this.element.id+"-"+d,u.style.width=this.panelWidth+"px",u.style.height=this.panelHeight+"px",u.style.display="inline",u.style.float="left",u.style.cssFloat="left",u.style.styleFloat="left",u.style.padding="2px",e.setElementTouchActionNone(u),u.innerTracker=new e.MouseTracker({element:u,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(t){t.eventSource.dragging=e.now()},releaseHandler:function(t){var n=t.eventSource,i=n.element.id,r=Number(i.split("-")[2]),o=e.now();t.insideElementPressed&&t.insideElementReleased&&n.dragging&&o-n.dragging<n.clickTimeThreshold&&(n.dragging=null,p.goToPage(r))}}),this.element.appendChild(u),u.activePanel=!1,this.panels.push(u);r(this,"vertical"==this.scroll?f.y:f.x,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventSource.prototype,e.Viewer.prototype,{setFocus:function(t){var n,i=e.getElement(this.element.id+"-"+t),s=e.getElementSize(this.viewer.canvas),a=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),c=-Number(this.element.style.marginLeft.replace("px","")),u=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==i&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=i,this.currentSelected.style.background="#999","horizontal"==this.scroll?(n=Number(t)*(this.panelWidth+3))>c+s.x-this.panelWidth?(n=Math.min(n,a-s.x),this.element.style.marginLeft=-n+"px",r(this,s.x,-n)):n<c&&(n=Math.max(0,n-s.x/2),this.element.style.marginLeft=-n+"px",r(this,s.x,-n)):(n=Number(t)*(this.panelHeight+3))>u+s.y-this.panelHeight?(n=Math.min(n,l-s.y),this.element.style.marginTop=-n+"px",r(this,s.y,-n)):n<u&&(n=Math.max(0,n-s.y/2),this.element.style.marginTop=-n+"px",r(this,s.y,-n)),this.currentPage=t,o.call(this,{eventSource:this.innerTracker}))},update:function(){return!!t[this.id].animating&&(e.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,n,i,r,o,s){e.Rect.apply(this,[t,n,i,r]),this.minLevel=o,this.maxLevel=s},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){e.Spring=function(t){var n=arguments;"object"!=typeof t&&(t={initial:n.length&&"number"==typeof n[0]?n[0]:void 0,springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),e.console.assert("number"==typeof t.springStiffness&&0!==t.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert("number"==typeof t.animationTime&&t.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var t,n;this.current.time=e.now(),this._exponential?(t=this.start._logValue,n=this.target._logValue):(t=this.start.value,n=this.target.value);var i,r,o=this.current.time>=this.target.time?n:t+(n-t)*(i=this.springStiffness,r=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(i*-r))/(1-Math.exp(-i))),s=this.current.value;return this._exponential?this.current.value=Math.exp(o):this.current.value=o,s!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(e){function t(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},t),this.image=null}t.prototype={errorMsg:null,start:function(){var t=this,n=this.abort;this.image=new Image,this.image.onload=function(){t.finish(!0)},this.image.onabort=this.image.onerror=function(){t.errorMsg="Image load aborted",t.finish(!1)},this.jobId=window.setTimeout((function(){t.errorMsg="Image load exceeded timeout ("+t.timeout+" ms)",t.finish(!1)}),this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(e){var n;try{n=new window.Blob([e.response])}catch(t){var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===t.name&&i){var r=new i;r.append(e.response),n=r.getBlob()}}0===n.size&&(t.errorMsg="Empty image response.",t.finish(!1));var o=(window.URL||window.webkitURL).createObjectURL(n);t.image.src=o},error:function(e){t.errorMsg="Image load aborted - XHR error",t.finish(!1)}}),this.abort=function(){t.request.abort(),"function"==typeof n&&n()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(e){var n=this,i=new t({src:e.src,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.loadWithAjax?e.ajaxHeaders:null,crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,callback:function(t){!function(e,t,n){e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.jobQueue.length>0&&(e.jobQueue.shift().start(),e.jobsInProgress++);n(t.image,t.errorMsg,t.request)}(n,t,e.callback)},abort:e.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(i.start(),this.jobsInProgress++):this.jobQueue.push(i)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var t=this.jobQueue[e];"function"==typeof t.abort&&t.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(e){e.Tile=function(e,t,n,i,r,o,s,a,l,c){this.level=e,this.x=t,this.y=n,this.bounds=i,this.sourceBounds=c,this.exists=r,this.url=o,this.context2D=s,this.loadWithAjax=a,this.ajaxHeaders=l,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(t){this.cacheImageRecord?this.loaded?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",e.setElementOpacity(this.element,this.opacity)):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(t,n,i,r){var o,s,a,l=this.position.times(e.pixelDensityRatio),c=this.size.times(e.pixelDensityRatio);this.context2D||this.cacheImageRecord?(o=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&o?(t.save(),t.globalAlpha=this.opacity,"number"==typeof i&&1!==i&&(l=l.times(i),c=c.times(i)),r instanceof e.Point&&(l=l.plus(r)),1===t.globalAlpha&&this._hasTransparencyChannel()&&t.clearRect(l.x,l.y,c.x,c.y),n({context:t,tile:this,rendered:o}),this.sourceBounds?(s=Math.min(this.sourceBounds.width,o.canvas.width),a=Math.min(this.sourceBounds.height,o.canvas.height)):(s=o.canvas.width,a=o.canvas.height),t.drawImage(o.canvas,0,0,s,a,l.x,l.y,c.x,c.y),t.restore()):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;t=this.context2D}return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,n,i){var r=Math.max(1,Math.ceil((i.x-n.x)/2)),o=Math.max(1,Math.ceil((i.y-n.y)/2));return new e.Point(r,o).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply((function(e){return e%1})))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,n,i){var r;r=e.isPlainObject(t)?t:{element:t,location:n,placement:i},this.element=r.element,this.style=r.element.style,this._init(r)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=void 0===t.placement?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=void 0===t.checkResize||t.checkResize,this.width=void 0===t.width?null:t.width,this.height=void 0===t.height?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,n){var i=e.Placement.properties[this.placement];i&&(i.isHorizontallyCentered?t.x-=n.x/2:i.isRight&&(t.x-=n.x),i.isVerticallyCentered?t.y-=n.y/2:i.isBottom&&(t.y-=n.y))},destroy:function(){var t=this.element,n=this.style;t.parentNode&&(t.parentNode.removeChild(t),t.prevElementParent&&(n.display="none",document.body.appendChild(t))),this.onDraw=null,n.top="",n.left="",n.position="",null!==this.width&&(n.width=""),null!==this.height&&(n.height="");var i=e.getCssPropertyWithVendorPrefix("transformOrigin"),r=e.getCssPropertyWithVendorPrefix("transform");i&&r&&(n[i]="",n[r]="")},drawHTML:function(t,n){var i=this.element;i.parentNode!==t&&(i.prevElementParent=i.parentNode,i.prevNextSibling=i.nextSibling,t.appendChild(i),this.style.position="absolute",this.size=e.getElementSize(i));var r=this._getOverlayPositionAndSize(n),o=r.position,s=this.size=r.size,a=r.rotate;if(this.onDraw)this.onDraw(o,s,this.element);else{var l=this.style;l.left=o.x+"px",l.top=o.y+"px",null!==this.width&&(l.width=s.x+"px"),null!==this.height&&(l.height=s.y+"px");var c=e.getCssPropertyWithVendorPrefix("transformOrigin"),u=e.getCssPropertyWithVendorPrefix("transform");c&&u&&(a?(l[c]=this._getTransformOrigin(),l[u]="rotate("+a+"deg)"):(l[c]="",l[u]="")),"none"!==l.display&&(l.display="block")}},_getOverlayPositionAndSize:function(t){var n=t.pixelFromPoint(this.location,!0),i=this._getSizeInPixels(t);this.adjust(n,i);var r=0;if(t.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var o=new e.Rect(n.x,n.y,i.x,i.y),s=this._getBoundingBox(o,t.degrees);n=s.getTopLeft(),i=s.getSize()}else r=t.degrees;return{position:n,size:i,rotate:r}},_getSizeInPixels:function(t){var n=this.size.x,i=this.size.y;if(null!==this.width||null!==this.height){var r=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);null!==this.width&&(n=r.x),null!==this.height&&(i=r.y)}if(this.checkResize&&(null===this.width||null===this.height)){var o=this.size=e.getElementSize(this.element);null===this.width&&(n=o.x),null===this.height&&(i=o.y)}return new e.Point(n,i)},_getBoundingBox:function(e,t){var n=this._getPlacementPoint(e);return e.rotate(t,n).getBoundingBox()},_getPlacementPoint:function(t){var n=new e.Point(t.x,t.y),i=e.Placement.properties[this.placement];return i&&(i.isHorizontallyCentered?n.x+=t.width/2:i.isRight&&(n.x+=t.width),i.isVerticallyCentered?n.y+=t.height/2:i.isBottom&&(n.y+=t.height)),n},_getTransformOrigin:function(){var t="",n=e.Placement.properties[this.placement];return n?(n.isLeft?t="left":n.isRight&&(t="right"),n.isTop?t+=" top":n.isBottom&&(t+=" bottom"),t):t},update:function(t,n){var i=e.isPlainObject(t)?t:{location:t,placement:n};this._init({location:i.location||this.location,placement:void 0!==i.placement?i.placement:this.placement,onDraw:i.onDraw||this.onDraw,checkResize:i.checkResize||this.checkResize,width:void 0!==i.width?i.width:this.width,height:void 0!==i.height?i.height:this.height,rotationMode:i.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var n=this.width,i=this.height;if(null===n||null===i){var r=t.deltaPointsFromPixelsNoRotate(this.size,!0);null===n&&(n=r.x),null===i&&(i=r.y)}var o=this.location.clone();return this.adjust(o,new e.Point(n,i)),this._adjustBoundsForRotation(t,new e.Rect(o.x,o.y,n,i))},_adjustBoundsForRotation:function(t,n){if(!t||0===t.degrees||this.rotationMode===e.OverlayRotationMode.EXACT)return n;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return n;var i=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(i.position.x,i.position.y,i.size.x,i.size.y))}return n.rotate(-t.degrees,this._getPlacementPoint(n))}}}(OpenSeadragon),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var n=arguments;if(e.isPlainObject(t)||(t={source:n[0],viewport:n[1],element:n[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor="string"==typeof t.debugGridColor?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var i=this._calculateCanvasSize();this.canvas.width=i.x,this.canvas.height=i.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(t,n,i,r){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,n,i,r),this},updateOverlay:function(t,n,i){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,n,i),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var n=this.viewer.world,i=0;i<n.getItemCount();i++)n.getItemAt(i).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,n=0,i=0;i<t.getItemCount();i++){var r=t.getItemAt(i).getOpacity();r>n&&(n=r)}return n},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!=e.x||this.canvas.height!=e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas)){var t=this._calculateSketchCanvasSize();this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(e,t){if(this.useCanvas){var n=this._getContext(e);if(t)n.clearRect(t.x,t.y,t.width,t.height);else{var i=n.canvas;n.clearRect(0,0,i.width,i.height)}}},viewportToDrawerRectangle:function(t){var n=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),i=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio,i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio)},drawTile:function(t,n,i,r,o){if(e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(n,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var s=this._getContext(i);r=r||1,t.drawCanvas(s,n,r,o)}else t.drawHTML(this.canvas)},_getContext:function(e){var t=this.context;if(e){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var n=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=n.x,this.sketchCanvas.height=n.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var i=this;this.viewer.addHandler("rotate",(function e(){if(0!==i.viewport.getRotation()){i.viewer.removeHandler("rotate",e);var t=i._calculateSketchCanvasSize();i.sketchCanvas.width=t.x,i.sketchCanvas.height=t.y}}))}this._updateImageSmoothingEnabled(this.sketchContext)}t=this.sketchContext}return t},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(e,t){if(this.useCanvas){var n=this._getContext(t);n.beginPath(),n.rect(e.x,e.y,e.width,e.height),n.clip()}},drawRectangle:function(e,t,n){if(this.useCanvas){var i=this._getContext(n);i.save(),i.fillStyle=t,i.fillRect(e.x,e.y,e.width,e.height),i.restore()}},blendSketch:function(t,n,i,r){var o=t;if(e.isPlainObject(o)||(o={opacity:t,scale:n,translate:i,compositeOperation:r}),this.useCanvas&&this.sketchCanvas){t=o.opacity,r=o.compositeOperation;var s=o.bounds;if(this.context.save(),this.context.globalAlpha=t,r&&(this.context.globalCompositeOperation=r),s)s.x<0&&(s.width+=s.x,s.x=0),s.x+s.width>this.canvas.width&&(s.width=this.canvas.width-s.x),s.y<0&&(s.height+=s.y,s.y=0),s.y+s.height>this.canvas.height&&(s.height=this.canvas.height-s.y),this.context.drawImage(this.sketchCanvas,s.x,s.y,s.width,s.height,s.x,s.y,s.width,s.height);else{n=o.scale||1;var a=(i=o.translate)instanceof e.Point?i:new e.Point(0,0),l=0,c=0;if(i){var u=this.sketchCanvas.width-this.canvas.width,h=this.sketchCanvas.height-this.canvas.height;l=Math.round(u/2),c=Math.round(h/2)}this.context.drawImage(this.sketchCanvas,a.x-l*n,a.y-c*n,(this.canvas.width+2*l)*n,(this.canvas.height+2*c)*n,-l,-c,this.canvas.width+2*l,this.canvas.height+2*c)}this.context.restore()}},drawDebugInfo:function(t,n,i,r){if(this.useCanvas){var o=this.viewer.world.getIndexOfItem(r)%this.debugGridColor.length,s=this.context;s.save(),s.lineWidth=2*e.pixelDensityRatio,s.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",s.strokeStyle=this.debugGridColor[o],s.fillStyle=this.debugGridColor[o],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),r.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:r.getRotation(!0),point:r.viewport.pixelFromPointNoRotate(r._getRotationPoint(!0),!0)}),0===r.viewport.degrees&&r.getRotation(!0)%360==0&&r._drawer.viewer.viewport.getFlip()&&r._drawer._flip(),s.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var a=(t.position.x+t.size.x/2)*e.pixelDensityRatio,l=(t.position.y+t.size.y/2)*e.pixelDensityRatio;s.translate(a,l),s.rotate(Math.PI/180*-this.viewport.degrees),s.translate(-a,-l),0===t.x&&0===t.y&&(s.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),s.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),s.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),s.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),s.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),s.fillText("Order: "+i+" of "+n,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),s.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),s.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),r.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===r.viewport.degrees&&r.getRotation(!0)%360==0&&r._drawer.viewer.viewport.getFlip()&&r._drawer._flip(),s.restore()}},debugRect:function(t){if(this.useCanvas){var n=this.context;n.save(),n.lineWidth=2*e.pixelDensityRatio,n.strokeStyle=this.debugGridColor[0],n.fillStyle=this.debugGridColor[0],n.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),n.restore()}},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.mozImageSmoothingEnabled=this._imageSmoothingEnabled,e.webkitImageSmoothingEnabled=this._imageSmoothingEnabled,e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(t){var n=this._getContext(t).canvas;return new e.Point(n.width,n.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var n=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),i=this._getContext(t.useSketch);i.save(),i.translate(n.x,n.y),this.viewer.viewport.flipped?(i.rotate(Math.PI/180*-t.degrees),i.scale(-1,1)):i.rotate(Math.PI/180*t.degrees),i.translate(-n.x,-n.y)},_flip:function(t){var n=(t=t||{}).point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),i=this._getContext(t.useSketch);i.translate(n.x,0),i.scale(-1,1),i.translate(-n.x,0)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,n=this.viewport.getContainerSize();return{x:Math.round(n.x*t),y:Math.round(n.y*t)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;var t=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:t,y:t}}}}(OpenSeadragon),function(e){e.Viewport=function(t){var n=arguments;n.length&&n[0]instanceof e.Point&&(t={containerSize:n[0],contentSize:n[1],config:n[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(t.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(t.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,n){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,n)},_setContentBounds:function(t,n){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(t.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(t.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(n),this._contentBounds=t.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(n),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:n,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?e>=1?e:1:e>=1?1:e)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),n=1/this.getHomeZoom(),i=n/this.getAspectRatio();return new e.Rect(t.x-n/2,t.y-i/2,n,i)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert("object"===e.type(t),"[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(t){var n=this.getCenter(t),i=1/this.getZoom(t),r=i/this.getAspectRatio();return new e.Rect(n.x-i/2,n.y-r/2,i,r)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),n=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/n,t.y-=this._margins.top/n,t.width+=(this._margins.left+this._margins.right)/n,t.height+=(this._margins.top+this._margins.bottom)/n,t},getCenter:function(t){var n,i,r,o,s,a,l=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),c=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?l:this.zoomPoint?(n=this.pixelFromPoint(this.zoomPoint,!0),o=(r=1/(i=this.getZoom()))/this.getAspectRatio(),s=new e.Rect(l.x-r/2,l.y-o/2,r,o),a=this._pixelFromPoint(this.zoomPoint,s).minus(n).divide(this._containerInnerSize.x*i),c.plus(a)):c},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){var n=new e.Rect(t.x,t.y,t.width,t.height);if(this.wrapHorizontal);else{var i=this.visibilityRatio*n.width,r=n.x+n.width,o=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,s=this._contentBoundsNoRotate.x-r+i,a=o-n.x-i;i>this._contentBoundsNoRotate.width?n.x+=(s+a)/2:a<0?n.x+=a:s>0&&(n.x+=s)}if(this.wrapVertical);else{var l=this.visibilityRatio*n.height,c=n.y+n.height,u=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,h=this._contentBoundsNoRotate.y-c+l,d=u-n.y-l;l>this._contentBoundsNoRotate.height?n.y+=(h+d)/2:d<0?n.y+=d:h>0&&(n.y+=h)}return n},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t=this.getZoom(),n=this._applyZoomConstraints(t);t!==n&&this.zoomTo(n,this.zoomPoint,e);var i=this.getBoundsNoRotate(),r=this._applyBoundaryConstraints(i);return this._raiseConstraintsEvent(e),(i.x!==r.x||i.y!==r.y||e)&&this.fitBounds(r.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(t,n){var i=(n=n||{}).immediately||!1,r=n.constraints||!1,o=this.getAspectRatio(),s=t.getCenter(),a=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();a.getAspectRatio()>=o?a.height=a.width/o:a.width=a.height*o,a.x=s.x-a.width/2,a.y=s.y-a.height/2;var l=1/a.width;if(r){var c=a.getAspectRatio(),u=this._applyZoomConstraints(l);l!==u&&(l=u,a.width=1/l,a.x=s.x-a.width/2,a.height=a.width/c,a.y=s.y-a.height/2),s=(a=this._applyBoundaryConstraints(a)).getCenter(),this._raiseConstraintsEvent(i)}if(i)return this.panTo(s,!0),this.zoomTo(l,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var h=this.getBounds(),d=this.getZoom();if(0===d||Math.abs(l/d-1)<1e-8)return this.zoomTo(l,!0),this.panTo(s,i);var p=(a=a.rotate(-this.getRotation())).getTopLeft().times(l).minus(h.getTopLeft().times(d)).divide(l-d);return this.zoomTo(l,p,i)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(t){var n=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(n,t)},fitHorizontally:function(t){var n=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(n,t)},getConstrainedBounds:function(e){var t;return t=this.getBounds(e),this._applyBoundaryConstraints(t)},panBy:function(t,n){var i=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(i.plus(t),n)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,n){return this.zoomTo(this.zoomSpring.target.value*e,t,n)},zoomTo:function(t,n,i){var r=this;return this.zoomPoint=n instanceof e.Point&&!isNaN(n.x)&&!isNaN(n.y)?n:null,i?this._adjustCenterSpringsForZoomPoint((function(){r.zoomSpring.resetTo(t)})):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:n,immediately:i}),this},setRotation:function(t){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=e.positiveModulo(t,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t}),this):this},getRotation:function(){return this.degrees},resize:function(e,t){var n,i=this.getBoundsNoRotate(),r=i;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(n=e.x/this.containerSize.x,r.width=i.width*n,r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(r,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint((function(){e.zoomSpring.update()})),this.centerSpringX.update(),this.centerSpringY.update();var t=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var t=this.pixelFromPoint(this.zoomPoint,!0);e();var n=this.pixelFromPoint(this.zoomPoint,!0).minus(t),i=this.deltaPointsFromPixels(n,!0);this.centerSpringX.shiftBy(i.x),this.centerSpringY.shiftBy(i.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(t,n){return t.minus(n.getTopLeft()).times(this._containerInnerSize.x/n.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(t,n){var i=this.getBoundsNoRotate(n);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/i.width).plus(i.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(t,n){var i=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/i,n*this._contentSizeNoRotate.x/i)},viewportToImageCoordinates:function(t,n){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===i){return this.viewer.world.getItemAt(0).viewportToImageCoordinates(t,n,!0)}}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,n-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,n){var i=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*i,n/this._contentSizeNoRotate.x*i)},imageToViewportCoordinates:function(t,n){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===i){return this.viewer.world.getItemAt(0).imageToViewportCoordinates(t,n,!0)}}var r=this._imageToViewportDelta(t,n);return r.x+=this._contentBoundsNoRotate.x,r.y+=this._contentBoundsNoRotate.y,r},imageToViewportRectangle:function(t,n,i,r){var o=t;if(o instanceof e.Rect||(o=new e.Rect(t,n,i,r)),this.viewer){var s=this.viewer.world.getItemCount();if(s>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===s){return this.viewer.world.getItemAt(0).imageToViewportRectangle(t,n,i,r,!0)}}var a=this.imageToViewportCoordinates(o.x,o.y),l=this._imageToViewportDelta(o.width,o.height);return new e.Rect(a.x,a.y,l.x,l.y,o.degrees)},viewportToImageRectangle:function(t,n,i,r){var o=t;if(o instanceof e.Rect||(o=new e.Rect(t,n,i,r)),this.viewer){var s=this.viewer.world.getItemCount();if(s>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===s){return this.viewer.world.getItemAt(0).viewportToImageRectangle(t,n,i,r,!0)}}var a=this.viewportToImageCoordinates(o.x,o.y),l=this._viewportToImageDelta(o.width,o.height);return new e.Rect(a.x,a.y,l.x,l.y,o.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var n=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(n)},imageToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var n=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(n)},viewportToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===n){return this.viewer.world.getItemAt(0).viewportToImageZoom(t)}}var i=this._contentSizeNoRotate.x;return t*(this._containerInnerSize.x/i*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(t){if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===n){return this.viewer.world.getItemAt(0).imageToViewportZoom(t)}}return t*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e?this:(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e}),this)}}}(OpenSeadragon),function(e){function t(e,t,i,r,o,s,l,c,u){var h=l.getBoundingBox().getTopLeft(),d=l.getBoundingBox().getBottomRight();e.viewer&&e.viewer.raiseEvent("update-level",{tiledImage:e,havedrawn:t,level:r,opacity:o,visibility:s,drawArea:l,topleft:h,bottomright:d,currenttime:c,best:u}),a(e.coverage,r),a(e.loadingCoverage,r);for(var p=e._getCornerTiles(r,h,d),f=p.topLeft,m=p.bottomRight,g=e.source.getNumTiles(r),v=e.viewport.pixelFromPoint(e.viewport.getCenter()),y=f.x;y<=m.x;y++)for(var w=f.y;w<=m.y;w++){if(!e.wrapHorizontal&&!e.wrapVertical){var b=e.source.getTileBounds(r,y,w);if(null===l.intersection(b))continue}u=n(e,i,t,y,w,r,o,s,v,g,c,u)}return u}function n(t,n,r,a,l,c,u,h,d,p,f,m){var g=function(t,n,i,r,o,s,a,l,c,u){var h,d,p,f,m,g,v,y,w;s[i]||(s[i]={});s[i][t]||(s[i][t]={});s[i][t][n]||(h=(l.x+t%l.x)%l.x,d=(l.y+n%l.y)%l.y,p=o.getTileBounds(i,h,d),f=o.getTileBounds(i,h,d,!0),m=o.tileExists(i,h,d),g=o.getTileUrl(i,h,d),r.loadTilesWithAjax?(v=o.getTileAjaxHeaders(i,h,d),e.isPlainObject(r.ajaxHeaders)&&(v=e.extend({},r.ajaxHeaders,v))):v=null,y=o.getContext2D?o.getContext2D(i,h,d):void 0,p.x+=(t-h)/l.x,p.y+=u/c*((n-d)/l.y),w=new e.Tile(i,t,n,p,m,g,y,r.loadTilesWithAjax,v,f),h===l.x-1&&(w.isRightMost=!0),d===l.y-1&&(w.isBottomMost=!0),s[i][t][n]=w);return(w=s[i][t][n]).lastTouchTime=a,w}(a,l,c,t,t.source,t.tilesMatrix,f,p,t._worldWidthCurrent,t._worldHeightCurrent),v=r;t.viewer&&t.viewer.raiseEvent("update-tile",{tiledImage:t,tile:g}),s(t.coverage,c,a,l,!1);var y=g.loaded||g.loading||o(t.loadingCoverage,c,a,l);if(s(t.loadingCoverage,c,a,l,y),!g.exists)return m;if(n&&!v&&(o(t.coverage,c,a,l)?s(t.coverage,c,a,l,!0):v=!0),!v)return m;if(function(t,n,i,r,o,s){var a=t.bounds.getTopLeft();a.x*=s._scaleSpring.current.value,a.y*=s._scaleSpring.current.value,a.x+=s._xSpring.current.value,a.y+=s._ySpring.current.value;var l=t.bounds.getSize();l.x*=s._scaleSpring.current.value,l.y*=s._scaleSpring.current.value;var c=i.pixelFromPointNoRotate(a,!0),u=i.pixelFromPointNoRotate(a,!1),h=i.deltaPixelsFromPointsNoRotate(l,!0),d=i.deltaPixelsFromPointsNoRotate(l,!1),p=u.plus(d.divide(2)),f=r.squaredDistanceTo(p);n||(h=h.plus(new e.Point(1,1)));t.isRightMost&&s.wrapHorizontal&&(h.x+=.75);t.isBottomMost&&s.wrapVertical&&(h.y+=.75);t.position=c,t.size=h,t.squaredDistance=f,t.visibility=o}(g,t.source.tileOverlap,t.viewport,d,h,t),!g.loaded)if(g.context2D)i(t,g);else{var w=t._tileCache.getImageRecord(g.cacheKey);if(w)i(t,g,w.getImage())}g.loaded?function(e,t,n,i,r,o,a){var l,c,u=1e3*e.blendTime;t.blendStart||(t.blendStart=a);l=a-t.blendStart,c=u?Math.min(1,l/u):1,e.alwaysBlend&&(c*=o);if(t.opacity=c,e.lastDrawn.push(t),1===c)s(e.coverage,r,n,i,!0),e._hasOpaqueTile=!0;else if(l<u)return!0;return!1}(t,g,a,l,c,u,f)&&(t._needsDraw=!0):g.loading?t._tilesLoading++:y||(m=function(e,t){if(!e)return t;if(t.visibility>e.visibility)return t;if(t.visibility==e.visibility&&t.squaredDistance<e.squaredDistance)return t;return e}(m,g));return m}function i(e,t,n,i,r){var o=0;function s(){return o++,a}function a(){0===--o&&(t.loading=!1,t.loaded=!0,t.context2D||e._tileCache.cacheTile({image:n,tile:t,cutoff:i,tiledImage:e}),e._needsDraw=!0)}e.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:e,tileRequest:r,image:n,getCompletionCallback:s}),s()()}function r(e,t,n,i){var r,o,s,a;if(!e[t])return!1;if(void 0===n||void 0===i){for(s in r=e[t])if(r.hasOwnProperty(s))for(a in o=r[s])if(o.hasOwnProperty(a)&&!o[a])return!1;return!0}return void 0===e[t][n]||void 0===e[t][n][i]||!0===e[t][n][i]}function o(e,t,n,i){return void 0===n||void 0===i?r(e,t+1):r(e,t+1,2*n,2*i)&&r(e,t+1,2*n,2*i+1)&&r(e,t+1,2*n+1,2*i)&&r(e,t+1,2*n+1,2*i+1)}function s(t,n,i,r,o){t[n]?(t[n][i]||(t[n][i]={}),t[n][i][r]=o):e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",n)}function a(e,t){e[t]={}}e.TiledImage=function(t){var n=this;e.console.assert(t.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(t.drawer,"[TiledImage] options.drawer is required"),e.console.assert(t.viewer,"[TiledImage] options.viewer is required"),e.console.assert(t.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(t.source,"[TiledImage] options.source is required"),e.console.assert(!t.clip||t.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=t.tileCache,delete t.tileCache,this._drawer=t.drawer,delete t.drawer,this._imageLoader=t.imageLoader,delete t.imageLoader,t.clip instanceof e.Rect&&(this._clip=t.clip.clone()),delete t.clip;var i=t.x||0;delete t.x;var r=t.y||0;delete t.y,this.normHeight=t.source.dimensions.y/t.source.dimensions.x,this.contentAspectX=t.source.dimensions.x/t.source.dimensions.y;var o=1;t.width?(o=t.width,delete t.width,t.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete t.height)):t.height&&(o=t.height/this.normHeight,delete t.height);var s=t.fitBounds;delete t.fitBounds;var a=t.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete t.fitBoundsPlacement;var l=t.degrees||0;delete t.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},t),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:i,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),s&&this.fitBounds(s,a,!0),this._drawingHandler=function(t){n.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:n},t))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),n=this._scaleSpring.update(),i=this._degreesSpring.update();return!!(e||t||n||i)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(t){return t?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(t){var n=this.getBoundsNoRotate(t);if(this._clip){var i=(t?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,r=this._clip.times(i);n=new e.Rect(n.x+r.x,n.y+r.y,r.width,r.height)}return n.rotate(this.getRotation(t),this._getRotationPoint(t))},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(t,n,i){var r=i?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t*(this.source.dimensions.x/r),n*(this.source.dimensions.y*this.contentAspectX/r))},viewportToImageCoordinates:function(t,n,i){var r;return t instanceof e.Point?(i=n,r=t):r=new e.Point(t,n),r=r.rotate(-this.getRotation(i),this._getRotationPoint(i)),i?this._viewportToImageDelta(r.x-this._xSpring.current.value,r.y-this._ySpring.current.value):this._viewportToImageDelta(r.x-this._xSpring.target.value,r.y-this._ySpring.target.value)},_imageToViewportDelta:function(t,n,i){var r=i?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t/this.source.dimensions.x*r,n/this.source.dimensions.y/this.contentAspectX*r)},imageToViewportCoordinates:function(t,n,i){t instanceof e.Point&&(i=n,n=t.y,t=t.x);var r=this._imageToViewportDelta(t,n);return i?(r.x+=this._xSpring.current.value,r.y+=this._ySpring.current.value):(r.x+=this._xSpring.target.value,r.y+=this._ySpring.target.value),r.rotate(this.getRotation(i),this._getRotationPoint(i))},imageToViewportRectangle:function(t,n,i,r,o){var s=t;s instanceof e.Rect?o=n:s=new e.Rect(t,n,i,r);var a=this.imageToViewportCoordinates(s.getTopLeft(),o),l=this._imageToViewportDelta(s.width,s.height,o);return new e.Rect(a.x,a.y,l.x,l.y,s.degrees+this.getRotation(o))},viewportToImageRectangle:function(t,n,i,r,o){var s=t;t instanceof e.Rect?o=n:s=new e.Rect(t,n,i,r);var a=this.viewportToImageCoordinates(s.getTopLeft(),o),l=this._viewportToImageDelta(s.width,s.height,o);return new e.Rect(a.x,a.y,l.x,l.y,s.degrees-this.getRotation(o))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(t){var n=this._scaleSpring.current.value;return t=t.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((t.x-this._xSpring.current.value)/n,(t.y-this._ySpring.current.value)/n,t.width/n,t.height/n,t.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var n=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(n&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(n)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}n||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},fitBounds:function(t,n,i){n=n||e.Placement.CENTER;var r=e.Placement.properties[n],o=this.contentAspectX,s=0,a=0,l=1,c=1;if(this._clip&&(o=this._clip.getAspectRatio(),l=this._clip.width/this.source.dimensions.x,c=this._clip.height/this.source.dimensions.y,t.getAspectRatio()>o?(s=this._clip.x/this._clip.height*t.height,a=this._clip.y/this._clip.height*t.height):(s=this._clip.x/this._clip.width*t.width,a=this._clip.y/this._clip.width*t.width)),t.getAspectRatio()>o){var u=t.height/c,h=0;r.isHorizontallyCentered?h=(t.width-t.height*o)/2:r.isRight&&(h=t.width-t.height*o),this.setPosition(new e.Point(t.x-s+h,t.y-a),i),this.setHeight(u,i)}else{var d=t.width/l,p=0;r.isVerticallyCentered?p=(t.height-t.width/o)/2:r.isBottom&&(p=t.height-t.width/o),this.setPosition(new e.Point(t.x-s,t.y-a+p),i),this.setWidth(d,i)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(t){e.console.assert(!t||t instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),t instanceof e.Rect?this._clip=t.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var n=this._scaleSpring.target.value===e;if(t){if(n&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(n)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}n||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,n=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2))));return n=Math.max(n,this.source.minLevel||0),{lowestLevel:e=Math.min(e,n),highestLevel:n}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){this.lastDrawn.pop().beingDrawn=!1}var n=this.viewport,o=this._viewportToTiledImageRectangle(n.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var s=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(o=o.intersection(s)))return}for(var a=this._getLevelsInterval(),l=a.lowestLevel,c=a.highestLevel,u=null,h=!1,d=e.now(),p=c;p>=l;p--){var f=!1,m=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(p),!0).x*this._scaleSpring.current.value;if(p===l||!h&&m>=this.minPixelRatio)f=!0,h=!0;else if(!h)continue;var g=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(p),!1).x*this._scaleSpring.current.value,v=n.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,y=this.immediateRender?1:v;if(u=t(this,h,f,p,Math.min(1,(m-.5)/.5),y/Math.abs(y-g),o,d,u),r(this.coverage,p))break}!function(t,n){if(0===t.opacity||0===n.length&&!t.placeholderFillStyle)return;var i,r,o,s=n[0];s&&(i=t.opacity<1||t.compositeOperation&&"source-over"!==t.compositeOperation||!t._isBottomItem()&&s._hasTransparencyChannel());var a,l=t.viewport.getZoom(!0),c=t.viewportToImageZoom(l);n.length>1&&c>t.smoothTileEdgesMinZoom&&!t.iOSDevice&&t.getRotation(!0)%360==0&&e.supportsCanvas&&(i=!0,r=s.getScaleForEdgeSmoothing(),o=s.getTranslationForEdgeSmoothing(r,t._drawer.getCanvasSize(!1),t._drawer.getCanvasSize(!0)));i&&(r||(a=t.viewport.viewportToViewerElementRectangle(t.getClippedBounds(!0)).getIntegerBoundingBox().times(e.pixelDensityRatio),t._drawer.viewer.viewport.getFlip()&&(0===t.viewport.degrees&&t.getRotation(!0)%360==0||(a.x=t._drawer.viewer.container.clientWidth-(a.x+a.width)))),t._drawer._clear(!0,a));r||(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:i}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:i}),0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip());var u=!1;if(t._clip){t._drawer.saveContext(i);var h=t.imageToViewportRectangle(t._clip,!0);h=h.rotate(-t.getRotation(!0),t._getRotationPoint(!0));var d=t._drawer.viewportToDrawerRectangle(h);r&&(d=d.times(r)),o&&(d=d.translate(o)),t._drawer.setClip(d,i),u=!0}if(t.placeholderFillStyle&&!1===t._hasOpaqueTile){var p=t._drawer.viewportToDrawerRectangle(t.getBounds(!0));r&&(p=p.times(r)),o&&(p=p.translate(o));var f=null;f="function"==typeof t.placeholderFillStyle?t.placeholderFillStyle(t,t._drawer.context):t.placeholderFillStyle,t._drawer.drawRectangle(p,f,i)}for(var m=n.length-1;m>=0;m--)s=n[m],t._drawer.drawTile(s,t._drawingHandler,i,r,o),s.beingDrawn=!0,t.viewer&&t.viewer.raiseEvent("tile-drawn",{tiledImage:t,tile:s});u&&t._drawer.restoreContext(i);r||(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(i),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(i));i&&(r&&(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:!1}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:!1})),t._drawer.blendSketch({opacity:t.opacity,scale:r,translate:o,compositeOperation:t.compositeOperation,bounds:a}),r&&(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(!1),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(!1)));r||0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip();!function(t,n){if(t.debugMode)for(var i=n.length-1;i>=0;i--){var r=n[i];try{t._drawer.drawDebugInfo(r,n.length,i,t)}catch(t){e.console.error(t)}}}(t,n)}(this,this.lastDrawn),u&&!u.context2D?(!function(t,n,r){n.loading=!0,t._imageLoader.addJob({src:n.url,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.ajaxHeaders,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:function(o,s,a){!function(t,n,r,o,s,a){if(!o)return e.console.log("Tile %s failed to load: %s - error: %s",n,n.url,s),t.viewer.raiseEvent("tile-load-failed",{tile:n,tiledImage:t,time:r,message:s,tileRequest:a}),n.loading=!1,void(n.exists=!1);if(r<t.lastResetTime)return e.console.log("Ignoring tile %s loaded before reset: %s",n,n.url),void(n.loading=!1);var l=function(){var e=t.source.getClosestLevel();i(t,n,o,e,a)};t._midDraw?window.setTimeout(l,1):l()}(t,n,r,o,s,a)},abort:function(){n.loading=!1}})}(this,u,d),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(t,n,i){var r,o,s,a;this.wrapHorizontal?(r=e.positiveModulo(n.x,1),o=e.positiveModulo(i.x,1)):(r=Math.max(0,n.x),o=Math.min(1,i.x));var l=1/this.source.aspectRatio;this.wrapVertical?(s=e.positiveModulo(n.y,l),a=e.positiveModulo(i.y,l)):(s=Math.max(0,n.y),a=Math.min(l,i.y));var c=this.source.getTileAtPoint(t,new e.Point(r,s)),u=this.source.getTileAtPoint(t,new e.Point(o,a)),h=this.source.getNumTiles(t);return this.wrapHorizontal&&(c.x+=h.x*Math.floor(n.x),u.x+=h.x*Math.floor(i.x)),this.wrapVertical&&(c.y+=h.y*Math.floor(n.y/l),u.y+=h.y*Math.floor(i.y/l)),{topLeft:c,bottomRight:u}}})}(OpenSeadragon),function(e){var t=function(t){e.console.assert(t,"[TileCache.cacheTile] options is required"),e.console.assert(t.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(t.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=t.tile,this.tiledImage=t.tiledImage},n=function(t){e.console.assert(t,"[ImageRecord] options is required"),e.console.assert(t.image,"[ImageRecord] options.image is required"),this._image=t.image,this._tiles=[]};n.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var e=document.createElement("canvas");e.width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(t){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=t},addTile:function(t){e.console.assert(t,"[ImageRecord.addTile] tile is required"),this._tiles.push(t)},removeTile:function(t){for(var n=0;n<this._tiles.length;n++)if(this._tiles[n]===t)return void this._tiles.splice(n,1);e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",t)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(t){t=t||{},this._maxImageCacheCount=t.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(i){e.console.assert(i,"[TileCache.cacheTile] options is required"),e.console.assert(i.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(i.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(i.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var r=i.cutoff||0,o=this._tilesLoaded.length,s=this._imagesLoaded[i.tile.cacheKey];if(s||(e.console.assert(i.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),s=this._imagesLoaded[i.tile.cacheKey]=new n({image:i.image}),this._imagesLoadedCount++),s.addTile(i.tile),i.tile.cacheImageRecord=s,this._imagesLoadedCount>this._maxImageCacheCount){for(var a,l,c,u,h,d,p=null,f=-1,m=null,g=this._tilesLoaded.length-1;g>=0;g--)(a=(d=this._tilesLoaded[g]).tile).level<=r||a.beingDrawn||(p?(u=a.lastTouchTime,l=p.lastTouchTime,h=a.level,c=p.level,(u<l||u==l&&h>c)&&(p=a,f=g,m=d)):(p=a,f=g,m=d));p&&f>=0&&(this._unloadTile(m),o=f)}this._tilesLoaded[o]=new t({tile:i.tile,tiledImage:i.tiledImage})},clearTilesFor:function(t){var n;e.console.assert(t,"[TileCache.clearTilesFor] tiledImage is required");for(var i=0;i<this._tilesLoaded.length;++i)(n=this._tilesLoaded[i]).tiledImage===t&&(this._unloadTile(n),this._tilesLoaded.splice(i,1),i--)},getImageRecord:function(t){return e.console.assert(t,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[t]},_unloadTile:function(t){e.console.assert(t,"[TileCache._unloadTile] tileRecord is required");var n=t.tile,i=t.tiledImage;n.unload(),n.cacheImageRecord=null;var r=this._imagesLoaded[n.cacheKey];r.removeTile(n),r.getTileCount()||(r.destroy(),delete this._imagesLoaded[n.cacheKey],this._imagesLoadedCount--),i.viewer.raiseEvent("tile-unloaded",{tile:n,tiledImage:i})}}}(OpenSeadragon),function(e){e.World=function(t){var n=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(e){n._autoRefigureSizes?n._figureSizes():n._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,n){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(n=n||{}).index){var i=Math.max(0,Math.min(this._items.length,n.index));this._items.splice(i,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(void 0!==t,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,n){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(void 0!==n,"[World.setItemIndex] index is required");var i=this.getIndexOfItem(t);if(n>=this._items.length)throw new Error("Index bigger than number of layers.");n!==i&&-1!==i&&(this._items.splice(i,1),this._items.splice(n,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:i,newIndex:n}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var n=e.indexOf(this._items,t);-1!==n&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(n,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){var e,t;for(this.viewer._cancelPendingImages(),t=0;t<this._items.length;t++)(e=this._items[t]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var n=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<n.length;t++)e=n[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){var n,i=(t=t||{}).immediately||!1,r=t.layout||e.DEFAULT_SETTINGS.collectionLayout,o=t.rows||e.DEFAULT_SETTINGS.collectionRows,s=t.columns||e.DEFAULT_SETTINGS.collectionColumns,a=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,l=a+(t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin);n=!t.rows&&s?s:Math.ceil(this._items.length/o);var c,u,h,d,p,f=0,m=0;this.setAutoRefigureSizes(!1);for(var g=0;g<this._items.length;g++)g&&g%n==0&&("horizontal"===r?(m+=l,f=0):(f+=l,m=0)),d=(h=(u=(c=this._items[g]).getBounds()).width>u.height?a:a*(u.width/u.height))*(u.height/u.width),p=new e.Point(f+(a-h)/2,m+(a-d)/2),c.setPosition(p,i),c.setWidth(h,i),"horizontal"===r?f+=l:m+=l;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,n=this._contentSize?this._contentSize.clone():null,i=this._contentFactor||0;if(this._items.length){var r=this._items[0],o=r.getBounds();this._contentFactor=r.getContentSize().x/o.width;for(var s=r.getClippedBounds().getBoundingBox(),a=s.x,l=s.y,c=s.x+s.width,u=s.y+s.height,h=1;h<this._items.length;h++)o=(r=this._items[h]).getBounds(),this._contentFactor=Math.max(this._contentFactor,r.getContentSize().x/o.width),s=r.getClippedBounds().getBoundingBox(),a=Math.min(a,s.x),l=Math.min(l,s.y),c=Math.max(c,s.x+s.width),u=Math.max(u,s.y+s.height);this._homeBounds=new e.Rect(a,l,c-a,u-l),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;this._contentFactor===i&&this._homeBounds.equals(t)&&this._contentSize.equals(n)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(OpenSeadragon)}));const config={initialPage:0,visibilityRatio:1,imageLoaderLimit:500,maxZoomPixelRatio:1,constrainDuringPan:!0,preserveImageSizeOnResize:!1,immediateRender:!0,toolbar:!1,showNavigationControl:!1,showHomeControl:!1,showSequenceControl:!1,showFullPageControl:!1,gestureSettingsMouse:{clickToZoom:!1,flickEnabled:!0,dblClickToZoom:!0}};function warning(e,t){if(e){for(var n=t?"[reakit/"+t+"]\n":"[reakit]\n",i=arguments.length,r=new Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];var s=""+n+r.join("\n\n");console.warn(s);try{throw Error(s)}catch(e){}}}var defaultPrefix="id-",generateId=function(e){return void 0===e&&(e=defaultPrefix),""+e+Math.random().toString(32).substr(2,6)},Context=React.createContext(generateId);function useId(e){void 0===e&&(e=defaultPrefix);var t=React.useContext(Context);return React.useState((function(){return t(e)}))[0]}var SystemContext=React.createContext({});function _defineProperty$1(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(n,!0).forEach((function(t){_defineProperty$1(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}function isRenderProp(e){return"function"==typeof e}var useCreateElement=function(e,t,n){void 0===n&&(n=t.children);var i=React.useContext(SystemContext);if(i.useCreateElement)return i.useCreateElement(e,t,n);if(isRenderProp(n)){t.children;return n(_objectWithoutPropertiesLoose(t,["children"]))}return React.createElement(e,t,n)};function splitProps(e,t){for(var n={},i={},r=0,o=Object.keys(e);r<o.length;r++){var s=o[r];t.indexOf(s)>=0?n[s]=e[s]:i[s]=e[s]}return[n,i]}function memo(e,t){return React.memo(e,t)}function forwardRef(e){return React.forwardRef(e)}function createComponent(e){var t=e.as,n=e.useHook,i=e.keys,r=void 0===i?n&&n.__keys||[]:i,o=e.propsAreEqual,s=void 0===o?n&&n.__propsAreEqual:o,a=e.useCreateElement,l=void 0===a?useCreateElement:a,c=function(e,i){var o=e.as,s=void 0===o?t:o,a=_objectWithoutPropertiesLoose(e,["as"]);if(n){var c=splitProps(a,r),u=c[0],h=c[1],d=n(u,_objectSpread2({ref:i},h)),p=d.unstable_wrap,f=_objectWithoutPropertiesLoose(d,["unstable_wrap"]),m=s.render?s.render.__keys:s.__keys,g=m?splitProps(a,m)[0]:{},v=l(s,_objectSpread2({},f,{},g));return p?p(v):v}return l(s,a)};return c.__keys=r,n&&(c.displayName=n.name.replace(/^(unstable_)?use/,"")),memo(forwardRef(c),s)}function useToken(e,t){React.useDebugValue(e);var n=React.useContext(SystemContext);return null!=n[e]?n[e]:t}function useProps(e,t,n){void 0===t&&(t={}),void 0===n&&(n={});var i="use"+e+"Props";React.useDebugValue(i);var r=useToken(i);return r?r(t,n):n}function useOptions(e,t,n){void 0===t&&(t={}),void 0===n&&(n={});var i="use"+e+"Options";React.useDebugValue(i);var r=useToken(i);return r?_objectSpread2({},t,{},r(t,n)):t}function isObject(e){return"object"==typeof e&&null!=e}function toArray(e){return Array.isArray(e)?e:void 0!==e?[e]:[]}function deepEqual(e,t,n){if(void 0===n&&(n=1),e===t)return!0;if(!e||!t)return!1;var i=Object.keys(e),r=Object.keys(t),o=i.length;if(r.length!==o)return!1;for(var s=0,a=i;s<a.length;s++){var l=a[s];if(e[l]!==t[l]&&!(n&&isObject(e[l])&&isObject(t[l])&&deepEqual(e[l],t[l],n-1)))return!1}return!0}function createHook(e){var t=toArray(e.compose),n=function(n,i){return void 0===n&&(n={}),void 0===i&&(i={}),e.useOptions&&(n=e.useOptions(n,i)),n=useOptions(e.name,n,i),e.useProps&&(i=e.useProps(n,i)),i=useProps(e.name,n,i),e.useCompose?i=e.useCompose(n,i):e.compose&&t.forEach((function(e){i=e(n,i)})),i};return Object.defineProperty(n,"name",{value:e.name}),n.__keys=[].concat(t.reduce((function(e,t){return e.push.apply(e,t.__keys||[]),e}),[]),e.useState?e.useState.__keys:[],e.keys||[]),Boolean(e.propsAreEqual||t.find((function(e){return Boolean(e.__propsAreEqual)})))&&(n.__propsAreEqual=function(n,i){var r=e.propsAreEqual&&e.propsAreEqual(n,i);if(null!=r)return r;var o=t,s=Array.isArray(o),a=0;for(o=s?o:o[Symbol.iterator]();;){var l;if(s){if(a>=o.length)break;l=o[a++]}else{if((a=o.next()).done)break;l=a.value}var c=l.__propsAreEqual,u=c&&c(n,i);if(null!=u)return u}return deepEqual(n,i)}),n}var useBox=createHook({name:"Box",keys:["unstable_system"]}),Box=createComponent({as:"div",useHook:useBox});function _defineProperty$2(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys$1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _objectSpread2$1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(n,!0).forEach((function(t){_defineProperty$2(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$1(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _objectWithoutPropertiesLoose$1(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}function mergeRefs(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.filter(Boolean);return i.length?0===i.length?i[0]:function(e){var t=i,n=Array.isArray(t),r=0;for(t=n?t:t[Symbol.iterator]();;){var o;if(n){if(r>=t.length)break;o=t[r++]}else{if((r=t.next()).done)break;o=r.value}var s=o;"function"==typeof s?s(e):s&&(s.current=e)}}:null}function useAllCallbacks(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return React.useCallback((function(){var e=t.filter(Boolean),n=e,i=Array.isArray(n),r=0;for(n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if((r=n.next()).done)break;o=r.value}var s=o;s.apply(void 0,arguments)}}),t)}function useSealedState(e){return React.useState(e)[0]}function usePipe(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return React.useCallback((function(e){return t.filter(Boolean).reduce((function(e,t){return t(e)}),e)}),t)}function cx(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")||void 0}var useIsomorphicEffect="undefined"==typeof window?React.useEffect:React.useLayoutEffect;function useLastValue(e){var t=React.useRef(null);return useIsomorphicEffect((function(){t.current=e}),[e]),t}function useHiddenState(e){void 0===e&&(e={});var t=useId("hidden-"),n=useSealedState(e),i=n.unstable_hiddenId,r=void 0===i?t:i,o=n.unstable_animated,s=void 0!==o&&o,a=n.visible,l=void 0!==a&&a,c=n.unstable_isMounted,u=void 0!==c&&c,h=React.useState(l),d=h[0],p=h[1],f=React.useState(!1),m=f[0],g=f[1],v=React.useState(u),y=v[0],w=v[1],b=useLastValue(d);s&&!m&&null!=b.current&&b.current!==d&&g(!0),useIsomorphicEffect((function(){if("number"==typeof s){var e=setTimeout((function(){return g(!1)}),s);return function(){return clearTimeout(e)}}}),[s]);var S=React.useCallback((function(){warning(!y,"Hidden","You're trying to show a hidden element that hasn't been mounted yet.","You shouldn't conditionally render a `Hidden` component (or any of its derivatives) as this will make some features not work.","If this is intentional, you can omit this warning by passing `unstable_isMounted: true` to `useHiddenState` or just ignore it.","See https://reakit.io/docs/hidden/#conditionally-rendering"),p(!0)}),[y]),T=React.useCallback((function(){return p(!1)}),[]),_=React.useCallback((function(){warning(!y,"Hidden","You're trying to toggle a hidden element that hasn't been mounted yet.","You shouldn't conditionally render a `Hidden` component (or any of its derivatives) as this will make some features not work.","If this is intentional, you can omit this warning by passing `unstable_isMounted: true` to `useHiddenState` or just ignore it.","See https://reakit.io/docs/hidden/#conditionally-rendering"),p((function(e){return!e}))}),[y]),x=React.useCallback((function(){return g(!1)}),[]);return{unstable_hiddenId:r,unstable_animated:s,unstable_animating:m,visible:d,show:S,hide:T,toggle:_,unstable_stopAnimation:x,unstable_setIsMounted:w}}var keys=["unstable_hiddenId","unstable_animated","unstable_animating","visible","show","hide","toggle","unstable_stopAnimation","unstable_setIsMounted"];function useWarningIfMultiple(e){React.useEffect((function(){e.unstable_hiddenId&&warning(document.querySelectorAll("#"+e.unstable_hiddenId).length>1,"Hidden","You're reusing the same `useModuleState` for multiple components (Hidden, Dialog, Popover, Menu etc.).","This is not allowed! If you want to use multiple components, make sure you're using different states.","See https://reakit.io/docs/hidden/#multiple-components")}),[e.unstable_hiddenId])}function useSetIsMounted(e){React.useEffect((function(){return e.unstable_setIsMounted&&e.unstable_setIsMounted(!0),function(){e.unstable_setIsMounted&&e.unstable_setIsMounted(!1)}}),[e.unstable_setIsMounted])}useHiddenState.__keys=keys;var useHidden=createHook({name:"Hidden",compose:useBox,useState:useHiddenState,useProps:function(e,t){var n=t.onAnimationEnd,i=t.onTransitionEnd,r=t.className,o=t.style,s=_objectWithoutPropertiesLoose$1(t,["onAnimationEnd","onTransitionEnd","className","style"]),a=React.useState(null),l=a[0],c=a[1];useWarningIfMultiple(e),useSetIsMounted(e),React.useEffect((function(){c(e.visible?null:"hidden")}),[e.visible]);var u=React.useCallback((function(){e.unstable_animated&&e.unstable_stopAnimation&&e.unstable_stopAnimation()}),[e.unstable_animated,e.unstable_stopAnimation]),h=e.unstable_animated&&e.unstable_animating,d=!e.visible&&!h;return _objectSpread2$1({role:"region",id:e.unstable_hiddenId,className:cx(l,r),onAnimationEnd:useAllCallbacks(u,n),onTransitionEnd:useAllCallbacks(u,i),hidden:d},d?{style:_objectSpread2$1({display:"none"},o)}:o?{style:o}:{},{},s)}}),Hidden=createComponent({as:"div",useHook:useHidden}),PortalContext=React.createContext("undefined"!=typeof document?document.body:null);function Portal(e){var t=e.children,n=React.useContext(PortalContext),i=React.useState((function(){if("undefined"!=typeof document){var e=document.createElement("div");return e.className=Portal.__className,e}return null}))[0];return React.useEffect((function(){if(i&&n)return n.appendChild(i),function(){n.removeChild(i)}}),[i,n]),i?reactDom.createPortal(React.createElement(PortalContext.Provider,{value:i},t),i):null}function useDialogState(e){return void 0===e&&(e={}),useHiddenState(e)}Portal.__className="__reakit-portal",Portal.__selector="."+Portal.__className;var keys$1=[].concat(useHiddenState.__keys);useDialogState.__keys=keys$1;
/**!
   * @fileOverview Kickass library to create and place poppers near their reference elements.
   * @version 1.16.0
   * @license
   * Copyright (c) 2016 Federico Zivolo and contributors
   *
   * Permission is hereby granted, free of charge, to any person obtaining a copy
   * of this software and associated documentation files (the "Software"), to deal
   * in the Software without restriction, including without limitation the rights
   * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   * copies of the Software, and to permit persons to whom the Software is
   * furnished to do so, subject to the following conditions:
   *
   * The above copyright notice and this permission notice shall be included in all
   * copies or substantial portions of the Software.
   *
   * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   * SOFTWARE.
   */
var isBrowser="undefined"!=typeof window&&"undefined"!=typeof document&&"undefined"!=typeof navigator,timeoutDuration=function(){for(var e=["Edge","Trident","Firefox"],t=0;t<e.length;t+=1)if(isBrowser&&navigator.userAgent.indexOf(e[t])>=0)return 1;return 0}();function microtaskDebounce(e){var t=!1;return function(){t||(t=!0,window.Promise.resolve().then((function(){t=!1,e()})))}}function taskDebounce(e){var t=!1;return function(){t||(t=!0,setTimeout((function(){t=!1,e()}),timeoutDuration))}}var supportsMicroTasks=isBrowser&&window.Promise,debounce=supportsMicroTasks?microtaskDebounce:taskDebounce;function isFunction(e){return e&&"[object Function]"==={}.toString.call(e)}function getStyleComputedProperty(e,t){if(1!==e.nodeType)return[];var n=e.ownerDocument.defaultView.getComputedStyle(e,null);return t?n[t]:n}function getParentNode(e){return"HTML"===e.nodeName?e:e.parentNode||e.host}function getScrollParent(e){if(!e)return document.body;switch(e.nodeName){case"HTML":case"BODY":return e.ownerDocument.body;case"#document":return e.body}var t=getStyleComputedProperty(e),n=t.overflow,i=t.overflowX,r=t.overflowY;return/(auto|scroll|overlay)/.test(n+r+i)?e:getScrollParent(getParentNode(e))}function getReferenceNode(e){return e&&e.referenceNode?e.referenceNode:e}var isIE11=isBrowser&&!(!window.MSInputMethodContext||!document.documentMode),isIE10=isBrowser&&/MSIE 10/.test(navigator.userAgent);function isIE(e){return 11===e?isIE11:10===e?isIE10:isIE11||isIE10}function getOffsetParent(e){if(!e)return document.documentElement;for(var t=isIE(10)?document.body:null,n=e.offsetParent||null;n===t&&e.nextElementSibling;)n=(e=e.nextElementSibling).offsetParent;var i=n&&n.nodeName;return i&&"BODY"!==i&&"HTML"!==i?-1!==["TH","TD","TABLE"].indexOf(n.nodeName)&&"static"===getStyleComputedProperty(n,"position")?getOffsetParent(n):n:e?e.ownerDocument.documentElement:document.documentElement}function isOffsetContainer(e){var t=e.nodeName;return"BODY"!==t&&("HTML"===t||getOffsetParent(e.firstElementChild)===e)}function getRoot(e){return null!==e.parentNode?getRoot(e.parentNode):e}function findCommonOffsetParent(e,t){if(!(e&&e.nodeType&&t&&t.nodeType))return document.documentElement;var n=e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING,i=n?e:t,r=n?t:e,o=document.createRange();o.setStart(i,0),o.setEnd(r,0);var s=o.commonAncestorContainer;if(e!==s&&t!==s||i.contains(r))return isOffsetContainer(s)?s:getOffsetParent(s);var a=getRoot(e);return a.host?findCommonOffsetParent(a.host,t):findCommonOffsetParent(e,getRoot(t).host)}function getScroll(e){var t="top"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top")?"scrollTop":"scrollLeft",n=e.nodeName;if("BODY"===n||"HTML"===n){var i=e.ownerDocument.documentElement;return(e.ownerDocument.scrollingElement||i)[t]}return e[t]}function includeScroll(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=getScroll(t,"top"),r=getScroll(t,"left"),o=n?-1:1;return e.top+=i*o,e.bottom+=i*o,e.left+=r*o,e.right+=r*o,e}function getBordersSize(e,t){var n="x"===t?"Left":"Top",i="Left"===n?"Right":"Bottom";return parseFloat(e["border"+n+"Width"],10)+parseFloat(e["border"+i+"Width"],10)}function getSize(e,t,n,i){return Math.max(t["offset"+e],t["scroll"+e],n["client"+e],n["offset"+e],n["scroll"+e],isIE(10)?parseInt(n["offset"+e])+parseInt(i["margin"+("Height"===e?"Top":"Left")])+parseInt(i["margin"+("Height"===e?"Bottom":"Right")]):0)}function getWindowSizes(e){var t=e.body,n=e.documentElement,i=isIE(10)&&getComputedStyle(n);return{height:getSize("Height",t,n,i),width:getSize("Width",t,n,i)}}var classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),defineProperty=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},_extends$1=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};function getClientRect(e){return _extends$1({},e,{right:e.left+e.width,bottom:e.top+e.height})}function getBoundingClientRect(e){var t={};try{if(isIE(10)){t=e.getBoundingClientRect();var n=getScroll(e,"top"),i=getScroll(e,"left");t.top+=n,t.left+=i,t.bottom+=n,t.right+=i}else t=e.getBoundingClientRect()}catch(e){}var r={left:t.left,top:t.top,width:t.right-t.left,height:t.bottom-t.top},o="HTML"===e.nodeName?getWindowSizes(e.ownerDocument):{},s=o.width||e.clientWidth||r.width,a=o.height||e.clientHeight||r.height,l=e.offsetWidth-s,c=e.offsetHeight-a;if(l||c){var u=getStyleComputedProperty(e);l-=getBordersSize(u,"x"),c-=getBordersSize(u,"y"),r.width-=l,r.height-=c}return getClientRect(r)}function getOffsetRectRelativeToArbitraryNode(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=isIE(10),r="HTML"===t.nodeName,o=getBoundingClientRect(e),s=getBoundingClientRect(t),a=getScrollParent(e),l=getStyleComputedProperty(t),c=parseFloat(l.borderTopWidth,10),u=parseFloat(l.borderLeftWidth,10);n&&r&&(s.top=Math.max(s.top,0),s.left=Math.max(s.left,0));var h=getClientRect({top:o.top-s.top-c,left:o.left-s.left-u,width:o.width,height:o.height});if(h.marginTop=0,h.marginLeft=0,!i&&r){var d=parseFloat(l.marginTop,10),p=parseFloat(l.marginLeft,10);h.top-=c-d,h.bottom-=c-d,h.left-=u-p,h.right-=u-p,h.marginTop=d,h.marginLeft=p}return(i&&!n?t.contains(a):t===a&&"BODY"!==a.nodeName)&&(h=includeScroll(h,t)),h}function getViewportOffsetRectRelativeToArtbitraryNode(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.ownerDocument.documentElement,i=getOffsetRectRelativeToArbitraryNode(e,n),r=Math.max(n.clientWidth,window.innerWidth||0),o=Math.max(n.clientHeight,window.innerHeight||0),s=t?0:getScroll(n),a=t?0:getScroll(n,"left");return getClientRect({top:s-i.top+i.marginTop,left:a-i.left+i.marginLeft,width:r,height:o})}function isFixed(e){var t=e.nodeName;if("BODY"===t||"HTML"===t)return!1;if("fixed"===getStyleComputedProperty(e,"position"))return!0;var n=getParentNode(e);return!!n&&isFixed(n)}function getFixedPositionOffsetParent(e){if(!e||!e.parentElement||isIE())return document.documentElement;for(var t=e.parentElement;t&&"none"===getStyleComputedProperty(t,"transform");)t=t.parentElement;return t||document.documentElement}function getBoundaries(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o={top:0,left:0},s=r?getFixedPositionOffsetParent(e):findCommonOffsetParent(e,getReferenceNode(t));if("viewport"===i)o=getViewportOffsetRectRelativeToArtbitraryNode(s,r);else{var a=void 0;"scrollParent"===i?"BODY"===(a=getScrollParent(getParentNode(t))).nodeName&&(a=e.ownerDocument.documentElement):a="window"===i?e.ownerDocument.documentElement:i;var l=getOffsetRectRelativeToArbitraryNode(a,s,r);if("HTML"!==a.nodeName||isFixed(s))o=l;else{var c=getWindowSizes(e.ownerDocument),u=c.height,h=c.width;o.top+=l.top-l.marginTop,o.bottom=u+l.top,o.left+=l.left-l.marginLeft,o.right=h+l.left}}var d="number"==typeof(n=n||0);return o.left+=d?n:n.left||0,o.top+=d?n:n.top||0,o.right-=d?n:n.right||0,o.bottom-=d?n:n.bottom||0,o}function getArea(e){return e.width*e.height}function computeAutoPlacement(e,t,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(-1===e.indexOf("auto"))return e;var s=getBoundaries(n,i,o,r),a={top:{width:s.width,height:t.top-s.top},right:{width:s.right-t.right,height:s.height},bottom:{width:s.width,height:s.bottom-t.bottom},left:{width:t.left-s.left,height:s.height}},l=Object.keys(a).map((function(e){return _extends$1({key:e},a[e],{area:getArea(a[e])})})).sort((function(e,t){return t.area-e.area})),c=l.filter((function(e){var t=e.width,i=e.height;return t>=n.clientWidth&&i>=n.clientHeight})),u=c.length>0?c[0].key:l[0].key,h=e.split("-")[1];return u+(h?"-"+h:"")}function getReferenceOffsets(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return getOffsetRectRelativeToArbitraryNode(n,i?getFixedPositionOffsetParent(t):findCommonOffsetParent(t,getReferenceNode(n)),i)}function getOuterSizes(e){var t=e.ownerDocument.defaultView.getComputedStyle(e),n=parseFloat(t.marginTop||0)+parseFloat(t.marginBottom||0),i=parseFloat(t.marginLeft||0)+parseFloat(t.marginRight||0);return{width:e.offsetWidth+i,height:e.offsetHeight+n}}function getOppositePlacement(e){var t={left:"right",right:"left",bottom:"top",top:"bottom"};return e.replace(/left|right|bottom|top/g,(function(e){return t[e]}))}function getPopperOffsets(e,t,n){n=n.split("-")[0];var i=getOuterSizes(e),r={width:i.width,height:i.height},o=-1!==["right","left"].indexOf(n),s=o?"top":"left",a=o?"left":"top",l=o?"height":"width",c=o?"width":"height";return r[s]=t[s]+t[l]/2-i[l]/2,r[a]=n===a?t[a]-i[c]:t[getOppositePlacement(a)],r}function find(e,t){return Array.prototype.find?e.find(t):e.filter(t)[0]}function findIndex(e,t,n){if(Array.prototype.findIndex)return e.findIndex((function(e){return e[t]===n}));var i=find(e,(function(e){return e[t]===n}));return e.indexOf(i)}function runModifiers(e,t,n){return(void 0===n?e:e.slice(0,findIndex(e,"name",n))).forEach((function(e){e.function&&console.warn("`modifier.function` is deprecated, use `modifier.fn`!");var n=e.function||e.fn;e.enabled&&isFunction(n)&&(t.offsets.popper=getClientRect(t.offsets.popper),t.offsets.reference=getClientRect(t.offsets.reference),t=n(t,e))})),t}function update(){if(!this.state.isDestroyed){var e={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}};e.offsets.reference=getReferenceOffsets(this.state,this.popper,this.reference,this.options.positionFixed),e.placement=computeAutoPlacement(this.options.placement,e.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),e.originalPlacement=e.placement,e.positionFixed=this.options.positionFixed,e.offsets.popper=getPopperOffsets(this.popper,e.offsets.reference,e.placement),e.offsets.popper.position=this.options.positionFixed?"fixed":"absolute",e=runModifiers(this.modifiers,e),this.state.isCreated?this.options.onUpdate(e):(this.state.isCreated=!0,this.options.onCreate(e))}}function isModifierEnabled(e,t){return e.some((function(e){var n=e.name;return e.enabled&&n===t}))}function getSupportedPropertyName(e){for(var t=[!1,"ms","Webkit","Moz","O"],n=e.charAt(0).toUpperCase()+e.slice(1),i=0;i<t.length;i++){var r=t[i],o=r?""+r+n:e;if(void 0!==document.body.style[o])return o}return null}function destroy(){return this.state.isDestroyed=!0,isModifierEnabled(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.position="",this.popper.style.top="",this.popper.style.left="",this.popper.style.right="",this.popper.style.bottom="",this.popper.style.willChange="",this.popper.style[getSupportedPropertyName("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}function getWindow(e){var t=e.ownerDocument;return t?t.defaultView:window}function attachToScrollParents(e,t,n,i){var r="BODY"===e.nodeName,o=r?e.ownerDocument.defaultView:e;o.addEventListener(t,n,{passive:!0}),r||attachToScrollParents(getScrollParent(o.parentNode),t,n,i),i.push(o)}function setupEventListeners(e,t,n,i){n.updateBound=i,getWindow(e).addEventListener("resize",n.updateBound,{passive:!0});var r=getScrollParent(e);return attachToScrollParents(r,"scroll",n.updateBound,n.scrollParents),n.scrollElement=r,n.eventsEnabled=!0,n}function enableEventListeners(){this.state.eventsEnabled||(this.state=setupEventListeners(this.reference,this.options,this.state,this.scheduleUpdate))}function removeEventListeners(e,t){return getWindow(e).removeEventListener("resize",t.updateBound),t.scrollParents.forEach((function(e){e.removeEventListener("scroll",t.updateBound)})),t.updateBound=null,t.scrollParents=[],t.scrollElement=null,t.eventsEnabled=!1,t}function disableEventListeners(){this.state.eventsEnabled&&(cancelAnimationFrame(this.scheduleUpdate),this.state=removeEventListeners(this.reference,this.state))}function isNumeric(e){return""!==e&&!isNaN(parseFloat(e))&&isFinite(e)}function setStyles(e,t){Object.keys(t).forEach((function(n){var i="";-1!==["width","height","top","right","bottom","left"].indexOf(n)&&isNumeric(t[n])&&(i="px"),e.style[n]=t[n]+i}))}function setAttributes(e,t){Object.keys(t).forEach((function(n){!1!==t[n]?e.setAttribute(n,t[n]):e.removeAttribute(n)}))}function applyStyle(e){return setStyles(e.instance.popper,e.styles),setAttributes(e.instance.popper,e.attributes),e.arrowElement&&Object.keys(e.arrowStyles).length&&setStyles(e.arrowElement,e.arrowStyles),e}function applyStyleOnLoad(e,t,n,i,r){var o=getReferenceOffsets(r,t,e,n.positionFixed),s=computeAutoPlacement(n.placement,o,t,e,n.modifiers.flip.boundariesElement,n.modifiers.flip.padding);return t.setAttribute("x-placement",s),setStyles(t,{position:n.positionFixed?"fixed":"absolute"}),n}function getRoundedOffsets(e,t){var n=e.offsets,i=n.popper,r=n.reference,o=Math.round,s=Math.floor,a=function(e){return e},l=o(r.width),c=o(i.width),u=-1!==["left","right"].indexOf(e.placement),h=-1!==e.placement.indexOf("-"),d=t?u||h||l%2==c%2?o:s:a,p=t?o:a;return{left:d(l%2==1&&c%2==1&&!h&&t?i.left-1:i.left),top:p(i.top),bottom:p(i.bottom),right:d(i.right)}}var isFirefox=isBrowser&&/Firefox/i.test(navigator.userAgent);function computeStyle(e,t){var n=t.x,i=t.y,r=e.offsets.popper,o=find(e.instance.modifiers,(function(e){return"applyStyle"===e.name})).gpuAcceleration;void 0!==o&&console.warn("WARNING: `gpuAcceleration` option moved to `computeStyle` modifier and will not be supported in future versions of Popper.js!");var s=void 0!==o?o:t.gpuAcceleration,a=getOffsetParent(e.instance.popper),l=getBoundingClientRect(a),c={position:r.position},u=getRoundedOffsets(e,window.devicePixelRatio<2||!isFirefox),h="bottom"===n?"top":"bottom",d="right"===i?"left":"right",p=getSupportedPropertyName("transform"),f=void 0,m=void 0;if(m="bottom"===h?"HTML"===a.nodeName?-a.clientHeight+u.bottom:-l.height+u.bottom:u.top,f="right"===d?"HTML"===a.nodeName?-a.clientWidth+u.right:-l.width+u.right:u.left,s&&p)c[p]="translate3d("+f+"px, "+m+"px, 0)",c[h]=0,c[d]=0,c.willChange="transform";else{var g="bottom"===h?-1:1,v="right"===d?-1:1;c[h]=m*g,c[d]=f*v,c.willChange=h+", "+d}var y={"x-placement":e.placement};return e.attributes=_extends$1({},y,e.attributes),e.styles=_extends$1({},c,e.styles),e.arrowStyles=_extends$1({},e.offsets.arrow,e.arrowStyles),e}function isModifierRequired(e,t,n){var i=find(e,(function(e){return e.name===t})),r=!!i&&e.some((function(e){return e.name===n&&e.enabled&&e.order<i.order}));if(!r){var o="`"+t+"`",s="`"+n+"`";console.warn(s+" modifier is required by "+o+" modifier in order to work, be sure to include it before "+o+"!")}return r}function arrow(e,t){var n;if(!isModifierRequired(e.instance.modifiers,"arrow","keepTogether"))return e;var i=t.element;if("string"==typeof i){if(!(i=e.instance.popper.querySelector(i)))return e}else if(!e.instance.popper.contains(i))return console.warn("WARNING: `arrow.element` must be child of its popper element!"),e;var r=e.placement.split("-")[0],o=e.offsets,s=o.popper,a=o.reference,l=-1!==["left","right"].indexOf(r),c=l?"height":"width",u=l?"Top":"Left",h=u.toLowerCase(),d=l?"left":"top",p=l?"bottom":"right",f=getOuterSizes(i)[c];a[p]-f<s[h]&&(e.offsets.popper[h]-=s[h]-(a[p]-f)),a[h]+f>s[p]&&(e.offsets.popper[h]+=a[h]+f-s[p]),e.offsets.popper=getClientRect(e.offsets.popper);var m=a[h]+a[c]/2-f/2,g=getStyleComputedProperty(e.instance.popper),v=parseFloat(g["margin"+u],10),y=parseFloat(g["border"+u+"Width"],10),w=m-e.offsets.popper[h]-v-y;return w=Math.max(Math.min(s[c]-f,w),0),e.arrowElement=i,e.offsets.arrow=(defineProperty(n={},h,Math.round(w)),defineProperty(n,d,""),n),e}function getOppositeVariation(e){return"end"===e?"start":"start"===e?"end":e}var placements=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],validPlacements=placements.slice(3);function clockwise(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=validPlacements.indexOf(e),i=validPlacements.slice(n+1).concat(validPlacements.slice(0,n));return t?i.reverse():i}var BEHAVIORS={FLIP:"flip",CLOCKWISE:"clockwise",COUNTERCLOCKWISE:"counterclockwise"};function flip(e,t){if(isModifierEnabled(e.instance.modifiers,"inner"))return e;if(e.flipped&&e.placement===e.originalPlacement)return e;var n=getBoundaries(e.instance.popper,e.instance.reference,t.padding,t.boundariesElement,e.positionFixed),i=e.placement.split("-")[0],r=getOppositePlacement(i),o=e.placement.split("-")[1]||"",s=[];switch(t.behavior){case BEHAVIORS.FLIP:s=[i,r];break;case BEHAVIORS.CLOCKWISE:s=clockwise(i);break;case BEHAVIORS.COUNTERCLOCKWISE:s=clockwise(i,!0);break;default:s=t.behavior}return s.forEach((function(a,l){if(i!==a||s.length===l+1)return e;i=e.placement.split("-")[0],r=getOppositePlacement(i);var c=e.offsets.popper,u=e.offsets.reference,h=Math.floor,d="left"===i&&h(c.right)>h(u.left)||"right"===i&&h(c.left)<h(u.right)||"top"===i&&h(c.bottom)>h(u.top)||"bottom"===i&&h(c.top)<h(u.bottom),p=h(c.left)<h(n.left),f=h(c.right)>h(n.right),m=h(c.top)<h(n.top),g=h(c.bottom)>h(n.bottom),v="left"===i&&p||"right"===i&&f||"top"===i&&m||"bottom"===i&&g,y=-1!==["top","bottom"].indexOf(i),w=!!t.flipVariations&&(y&&"start"===o&&p||y&&"end"===o&&f||!y&&"start"===o&&m||!y&&"end"===o&&g),b=!!t.flipVariationsByContent&&(y&&"start"===o&&f||y&&"end"===o&&p||!y&&"start"===o&&g||!y&&"end"===o&&m),S=w||b;(d||v||S)&&(e.flipped=!0,(d||v)&&(i=s[l+1]),S&&(o=getOppositeVariation(o)),e.placement=i+(o?"-"+o:""),e.offsets.popper=_extends$1({},e.offsets.popper,getPopperOffsets(e.instance.popper,e.offsets.reference,e.placement)),e=runModifiers(e.instance.modifiers,e,"flip"))})),e}function keepTogether(e){var t=e.offsets,n=t.popper,i=t.reference,r=e.placement.split("-")[0],o=Math.floor,s=-1!==["top","bottom"].indexOf(r),a=s?"right":"bottom",l=s?"left":"top",c=s?"width":"height";return n[a]<o(i[l])&&(e.offsets.popper[l]=o(i[l])-n[c]),n[l]>o(i[a])&&(e.offsets.popper[l]=o(i[a])),e}function toValue(e,t,n,i){var r=e.match(/((?:\-|\+)?\d*\.?\d*)(.*)/),o=+r[1],s=r[2];if(!o)return e;if(0===s.indexOf("%")){var a=void 0;switch(s){case"%p":a=n;break;case"%":case"%r":default:a=i}return getClientRect(a)[t]/100*o}if("vh"===s||"vw"===s){return("vh"===s?Math.max(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0))/100*o}return o}function parseOffset(e,t,n,i){var r=[0,0],o=-1!==["right","left"].indexOf(i),s=e.split(/(\+|\-)/).map((function(e){return e.trim()})),a=s.indexOf(find(s,(function(e){return-1!==e.search(/,|\s/)})));s[a]&&-1===s[a].indexOf(",")&&console.warn("Offsets separated by white space(s) are deprecated, use a comma (,) instead.");var l=/\s*,\s*|\s+/,c=-1!==a?[s.slice(0,a).concat([s[a].split(l)[0]]),[s[a].split(l)[1]].concat(s.slice(a+1))]:[s];return(c=c.map((function(e,i){var r=(1===i?!o:o)?"height":"width",s=!1;return e.reduce((function(e,t){return""===e[e.length-1]&&-1!==["+","-"].indexOf(t)?(e[e.length-1]=t,s=!0,e):s?(e[e.length-1]+=t,s=!1,e):e.concat(t)}),[]).map((function(e){return toValue(e,r,t,n)}))}))).forEach((function(e,t){e.forEach((function(n,i){isNumeric(n)&&(r[t]+=n*("-"===e[i-1]?-1:1))}))})),r}function offset(e,t){var n=t.offset,i=e.placement,r=e.offsets,o=r.popper,s=r.reference,a=i.split("-")[0],l=void 0;return l=isNumeric(+n)?[+n,0]:parseOffset(n,o,s,a),"left"===a?(o.top+=l[0],o.left-=l[1]):"right"===a?(o.top+=l[0],o.left+=l[1]):"top"===a?(o.left+=l[0],o.top-=l[1]):"bottom"===a&&(o.left+=l[0],o.top+=l[1]),e.popper=o,e}function preventOverflow(e,t){var n=t.boundariesElement||getOffsetParent(e.instance.popper);e.instance.reference===n&&(n=getOffsetParent(n));var i=getSupportedPropertyName("transform"),r=e.instance.popper.style,o=r.top,s=r.left,a=r[i];r.top="",r.left="",r[i]="";var l=getBoundaries(e.instance.popper,e.instance.reference,t.padding,n,e.positionFixed);r.top=o,r.left=s,r[i]=a,t.boundaries=l;var c=t.priority,u=e.offsets.popper,h={primary:function(e){var n=u[e];return u[e]<l[e]&&!t.escapeWithReference&&(n=Math.max(u[e],l[e])),defineProperty({},e,n)},secondary:function(e){var n="right"===e?"left":"top",i=u[n];return u[e]>l[e]&&!t.escapeWithReference&&(i=Math.min(u[n],l[e]-("right"===e?u.width:u.height))),defineProperty({},n,i)}};return c.forEach((function(e){var t=-1!==["left","top"].indexOf(e)?"primary":"secondary";u=_extends$1({},u,h[t](e))})),e.offsets.popper=u,e}function shift(e){var t=e.placement,n=t.split("-")[0],i=t.split("-")[1];if(i){var r=e.offsets,o=r.reference,s=r.popper,a=-1!==["bottom","top"].indexOf(n),l=a?"left":"top",c=a?"width":"height",u={start:defineProperty({},l,o[l]),end:defineProperty({},l,o[l]+o[c]-s[c])};e.offsets.popper=_extends$1({},s,u[i])}return e}function hide(e){if(!isModifierRequired(e.instance.modifiers,"hide","preventOverflow"))return e;var t=e.offsets.reference,n=find(e.instance.modifiers,(function(e){return"preventOverflow"===e.name})).boundaries;if(t.bottom<n.top||t.left>n.right||t.top>n.bottom||t.right<n.left){if(!0===e.hide)return e;e.hide=!0,e.attributes["x-out-of-boundaries"]=""}else{if(!1===e.hide)return e;e.hide=!1,e.attributes["x-out-of-boundaries"]=!1}return e}function inner(e){var t=e.placement,n=t.split("-")[0],i=e.offsets,r=i.popper,o=i.reference,s=-1!==["left","right"].indexOf(n),a=-1===["top","left"].indexOf(n);return r[s?"left":"top"]=o[n]-(a?r[s?"width":"height"]:0),e.placement=getOppositePlacement(t),e.offsets.popper=getClientRect(r),e}var modifiers={shift:{order:100,enabled:!0,fn:shift},offset:{order:200,enabled:!0,fn:offset,offset:0},preventOverflow:{order:300,enabled:!0,fn:preventOverflow,priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:keepTogether},arrow:{order:500,enabled:!0,fn:arrow,element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:flip,behavior:"flip",padding:5,boundariesElement:"viewport",flipVariations:!1,flipVariationsByContent:!1},inner:{order:700,enabled:!1,fn:inner},hide:{order:800,enabled:!0,fn:hide},computeStyle:{order:850,enabled:!0,fn:computeStyle,gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:applyStyle,onLoad:applyStyleOnLoad,gpuAcceleration:void 0}},Defaults={placement:"bottom",positionFixed:!1,eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:modifiers},Popper=function(){function e(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};classCallCheck(this,e),this.scheduleUpdate=function(){return requestAnimationFrame(i.update)},this.update=debounce(this.update.bind(this)),this.options=_extends$1({},e.Defaults,r),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=t&&t.jquery?t[0]:t,this.popper=n&&n.jquery?n[0]:n,this.options.modifiers={},Object.keys(_extends$1({},e.Defaults.modifiers,r.modifiers)).forEach((function(t){i.options.modifiers[t]=_extends$1({},e.Defaults.modifiers[t]||{},r.modifiers?r.modifiers[t]:{})})),this.modifiers=Object.keys(this.options.modifiers).map((function(e){return _extends$1({name:e},i.options.modifiers[e])})).sort((function(e,t){return e.order-t.order})),this.modifiers.forEach((function(e){e.enabled&&isFunction(e.onLoad)&&e.onLoad(i.reference,i.popper,i.options,e,i.state)})),this.update();var o=this.options.eventsEnabled;o&&this.enableEventListeners(),this.state.eventsEnabled=o}return createClass(e,[{key:"update",value:function(){return update.call(this)}},{key:"destroy",value:function(){return destroy.call(this)}},{key:"enableEventListeners",value:function(){return enableEventListeners.call(this)}},{key:"disableEventListeners",value:function(){return disableEventListeners.call(this)}}]),e}();function usePopoverState(e){void 0===e&&(e={});var t=useSealedState(e),n=t.gutter,i=void 0===n?12:n,r=t.placement,o=void 0===r?"bottom":r,s=t.unstable_flip,a=void 0===s||s,l=t.unstable_shift,c=void 0===l||l,u=t.unstable_preventOverflow,h=void 0===u||u,d=t.unstable_boundariesElement,p=void 0===d?"scrollParent":d,f=t.unstable_fixed,m=void 0!==f&&f,g=_objectWithoutPropertiesLoose$1(t,["gutter","placement","unstable_flip","unstable_shift","unstable_preventOverflow","unstable_boundariesElement","unstable_fixed"]),v=React.useRef(null),y=React.useRef(null),w=React.useRef(null),b=React.useRef(null),S=React.useState(o),T=S[0],_=S[1],x=React.useState(o),E=x[0],P=x[1],R=React.useState({}),C=R[0],O=R[1],k=React.useState({}),M=k[0],I=k[1],D=useDialogState(g),L=React.useCallback((function(){return!!v.current&&(v.current.scheduleUpdate(),!0)}),[]),H=React.useCallback((function(){return!!v.current&&(v.current.update(),!0)}),[]);return useIsomorphicEffect((function(){return y.current&&w.current&&(v.current=new Popper(y.current,w.current,{placement:T,eventsEnabled:D.visible,positionFixed:m,modifiers:{applyStyle:{enabled:!1},flip:{enabled:a,padding:16},shift:{enabled:c},offset:{enabled:c,offset:"0, "+i},preventOverflow:{enabled:h,boundariesElement:p},arrow:b.current?{enabled:!0,element:b.current}:void 0,updateStateModifier:{order:900,enabled:!0,fn:function(e){return P(e.placement),O(e.styles),null==e.arrowStyles.left||isNaN(+e.arrowStyles.left)||null==e.arrowStyles.top||isNaN(+e.arrowStyles.top)||I(e.arrowStyles),e}}}})),function(){v.current&&v.current.destroy()}}),[D.visible,T,a,c,i,h,p,m]),React.useEffect((function(){D.visible&&v.current&&v.current.scheduleUpdate()}),[D.visible]),React.useEffect((function(){g.visible&&v.current&&v.current.scheduleUpdate()}),[g.visible]),_objectSpread2$1({},D,{unstable_referenceRef:y,unstable_popoverRef:w,unstable_arrowRef:b,unstable_popoverStyles:C,unstable_arrowStyles:M,unstable_scheduleUpdate:L,unstable_update:H,unstable_originalPlacement:T,placement:E,place:React.useCallback(_,[])})}Popper.Utils=("undefined"!=typeof window?window:global).PopperUtils,Popper.placements=placements,Popper.Defaults=Defaults;var keys$2=[].concat(useDialogState.__keys,["unstable_referenceRef","unstable_popoverRef","unstable_arrowRef","unstable_popoverStyles","unstable_arrowStyles","unstable_scheduleUpdate","unstable_update","unstable_originalPlacement","placement","place"]);function useTooltipState(e){void 0===e&&(e={});var t=useSealedState(e),n=t.placement,i=void 0===n?"top":n,r=t.unstable_boundariesElement,o=void 0===r?"window":r;return usePopoverState(_objectSpread2$1({},_objectWithoutPropertiesLoose$1(t,["placement","unstable_boundariesElement"]),{placement:i,unstable_boundariesElement:o}))}usePopoverState.__keys=keys$2;var keys$3=[].concat(usePopoverState.__keys);useTooltipState.__keys=keys$3;var useTooltip=createHook({name:"Tooltip",compose:useHidden,useState:useTooltipState,keys:["unstable_portal"],useOptions:function(e){var t=e.unstable_portal;return _objectSpread2$1({unstable_portal:void 0===t||t},_objectWithoutPropertiesLoose$1(e,["unstable_portal"]))},useProps:function(e,t){var n=t.ref,i=t.style,r=t.unstable_wrap,o=_objectWithoutPropertiesLoose$1(t,["ref","style","unstable_wrap"]),s=React.useCallback((function(t){return e.unstable_portal?React.createElement(Portal,null,t):t}),[e.unstable_portal]);return _objectSpread2$1({ref:mergeRefs(e.unstable_popoverRef,n),role:"tooltip",style:_objectSpread2$1({},e.unstable_popoverStyles,{pointerEvents:"none"},i),unstable_wrap:usePipe(s,r)},o)}}),Tooltip=createComponent({as:"div",useHook:useTooltip}),useTooltipReference=createHook({name:"TooltipReference",compose:useBox,useState:useTooltipState,useProps:function(e,t){var n=t.ref,i=t.onFocus,r=t.onBlur,o=t.onMouseEnter,s=t.onMouseLeave,a=_objectWithoutPropertiesLoose$1(t,["ref","onFocus","onBlur","onMouseEnter","onMouseLeave"]);return _objectSpread2$1({ref:mergeRefs(e.unstable_referenceRef,n),tabIndex:0,onFocus:useAllCallbacks(e.show,i),onBlur:useAllCallbacks(e.hide,r),onMouseEnter:useAllCallbacks(e.show,o),onMouseLeave:useAllCallbacks(e.hide,s),"aria-describedby":e.unstable_hiddenId},a)}}),TooltipReference=createComponent({as:"div",useHook:useTooltipReference});const Tooltip$1=({text:e,children:t,overrideClass:n,style:i,...r})=>{const o=useTooltipState();return React__default.createElement(React__default.Fragment,null,React__default.createElement(TooltipReference,o,e=>React__default.cloneElement(React__default.Children.only(t),e)),React__default.createElement(Tooltip,_extends({},o,r,{style:i,className:"tooltip"}),e))};var Tooltip$2=React__default.memo(Tooltip$1);const Button=({type:e,onClick:t,icon:n,label:i,title:r,disabled:o,active:s,tooltip:a,tooltipClass:l,ariaLabel:c,children:u})=>{const h=React__default.createElement("button",{role:"button","aria-label":c||r||a,title:r,onClick:t,disabled:o,className:clsx("button",e&&`button-${e}`,s&&"button--active")},n&&React__default.createElement(Icon$1,{path:n,size:"26px",className:"villain-icon"}),i&&React__default.createElement("span",{className:"villain-label"},i),u&&React__default.createElement("span",{className:"villain-label"},u));return a?React__default.createElement(Tooltip$2,{text:a,overrideClass:l},h):h};var Button$1=React__default.memo(Button);const WrapSelect=({options:e,icon:t,value:n,onChange:i,inputId:r,className:o,label:s})=>React__default.createElement("div",{className:`wrapselect-container ${o||""}`},React__default.createElement("label",{htmlFor:r},React__default.createElement(Icon$1,{path:t,size:"22px",className:"villain-icon"})),React__default.createElement("select",{value:n,onChange:i,"aria-label":s},e.map(e=>React__default.createElement("option",{value:e,key:e},e))));React__default.memo(WrapSelect);const useFocus=()=>{const e=React.useRef(null);return[e,()=>{e.current&&(e.current.focus(),e.current.select())}]},ZoomControls=({disabled:e,onUpdate:t})=>{const n=React.useContext(ReaderContext),{canZoomIn:i,canZoomOut:r,currentZoom:o}=n.state,[s,a]=React.useState("0"),[l,c]=React.useState(!1),[u,h]=useFocus();React.useEffect(()=>{d()},[o]);const d=()=>{o&&a(o)},p=()=>{t(s)};return React__default.createElement(React__default.Fragment,null,React__default.createElement(Button$1,{type:"icon",tooltip:localize["Zoom in"],icon:mdiPlus,disabled:!i||e,onClick:()=>{t(o+10)}}),React__default.createElement(Button$1,{type:"icon",icon:mdiMinus,tooltip:localize["Zoom out"],disabled:!r||e,onClick:()=>{t(o-10)}}),React__default.createElement("div",{className:"wrapper-input","data-focus":l,onClick:()=>{h()}},React__default.createElement("input",{min:0,step:1,size:3,max:100,ref:u,type:"number",value:s,title:"Zoom","aria-label":"Zoom to percentage value",contentEditable:"true",onBlur:()=>{p(),c(!1)},onFocus:()=>{c(!0)},onChange:e=>{const{value:t}=e.target;console.info(typeof t);const n=t.replace(/\..*|^0+/gm,"");n&&n.length<4&&a(n)},onKeyPress:e=>{"Enter"===e.key&&p()},className:"villain-input",disabled:e}),React__default.createElement("div",{className:"villain-label villain-label--center"},"%")))},useFocus$1=()=>{const e=React.useRef(null);return[e,()=>{e.current&&(e.current.focus(),e.current.select())}]},Navigation=()=>{const e=React.useContext(ReaderContext),{totalPages:t,isFirstPage:n,isLastPage:i,mangaMode:r,currentPage:o}=e.state,{navigateForward:s,navigateBackward:a,navigateToPage:l}=e,[c,u]=React.useState({value:o||1}),[h,d]=React.useState(!1),[p,f]=useFocus$1();React.useEffect(()=>{m()},[o]);const m=()=>{u({value:o+1})},g=()=>{const{value:e}=c;if(e){const n=parseInt(e,10);n<=t&&n>0?l(n-1):m()}else m()};return React__default.createElement("div",{className:"villain-toolbar-group"},React__default.createElement(Button$1,{type:"icon",tooltip:r?localize["Next page"]:localize["Previous page"],tooltipClass:"left-edge",onClick:r?s:a,disabled:r?i:n,icon:mdiChevronLeft}),React__default.createElement(Button$1,{type:"icon",tooltip:localize["Next page"],onClick:r?a:s,disabled:r?n:i,icon:mdiChevronRight}),React__default.createElement("div",{className:"wrapper-input","data-focus":h,onClick:e=>{f()}},React__default.createElement("input",{min:1,step:1,size:3,ref:p,max:t,type:"number","aria-label":"Go to page number",role:"textbox",contentEditable:"true",title:"Page",pattern:"d+",className:"villain-input",onBlur:()=>{g(),d(!1)},onFocus:()=>{d(!0)},onChange:e=>{const{value:t}=e.target,n=t.replace(/\..*|^0+/gm,"");n.length<4&&u({value:t?n:o+1})},onKeyPress:e=>{"Enter"===e.key&&g()},value:c.value}),React__default.createElement("div",{className:"villain-label villain-label--center"},"/"),React__default.createElement("div",{className:"villain-label"},`${t}`)))};function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _extends$2(){return(_extends$2=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _defineProperty$3(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var warning$1=function(){};warning$1=function(e,t,n){var i=arguments.length;n=new Array(i>2?i-2:0);for(var r=2;r<i;r++)n[r-2]=arguments[r];if(void 0===t)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(t.length<10||/^[s\W]*$/.test(t))throw new Error("The warning format should be able to uniquely identify this warning. Please, use a more descriptive format than: "+t);if(!e){var o=0,s="Warning: "+t.replace(/%s/g,(function(){return n[o++]}));"undefined"!=typeof console&&console.error(s);try{throw new Error(s)}catch(e){}}};var warning_1=warning$1,callAll=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.forEach((function(e){return e&&e.apply(void 0,n)}))}};function ownKeys$2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$2(n,!0).forEach((function(t){_defineProperty$3(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$2(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Rail=function(e){function t(){var e,n;_classCallCheck(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return _defineProperty$3(_assertThisInitialized(n=_possibleConstructorReturn(this,(e=_getPrototypeOf(t)).call.apply(e,[this].concat(r)))),"getRailProps",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.props,i=t.emitMouse,r=t.emitTouch;return _objectSpread({},e,{onMouseDown:callAll(e.onMouseDown,i),onTouchStart:callAll(e.onTouchStart,r)})})),n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.getRailProps,t=this.props,n=t.getEventData,i=t.activeHandleID,r=(0,t.children)({getEventData:n,activeHandleID:i,getRailProps:e});return r&&React__default.Children.only(r)}}]),t}(React.Component);Rail.propTypes={getEventData:propTypes.func,activeHandleID:propTypes.string,emitMouse:propTypes.func,emitTouch:propTypes.func,children:propTypes.func.isRequired};var Ticks=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.values,i=e.scale,r=e.count,o=t({getEventData:e.getEventData,activeHandleID:e.activeHandleID,ticks:(n||i.getTicks(r)).map((function(e){return{id:"$$-".concat(e),value:e,percent:i.getValue(e)}}))});return o&&React__default.Children.only(o)}}]),t}(React.Component);function ownKeys$3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$3(n,!0).forEach((function(t){_defineProperty$3(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$3(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Ticks.propTypes={scale:propTypes.object,count:propTypes.number,values:propTypes.array,getEventData:propTypes.func,activeHandleID:propTypes.string,emitMouse:propTypes.func,emitTouch:propTypes.func,children:propTypes.func.isRequired},Ticks.defaultProps={count:10};var Tracks=function(e){function t(){var e,n;_classCallCheck(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return _defineProperty$3(_assertThisInitialized(n=_possibleConstructorReturn(this,(e=_getPrototypeOf(t)).call.apply(e,[this].concat(r)))),"getTrackProps",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.props,i=t.emitMouse,r=t.emitTouch;return _objectSpread$1({},e,{onMouseDown:callAll(e.onMouseDown,i),onTouchStart:callAll(e.onTouchStart,r)})})),n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){for(var e=this.getTrackProps,t=this.props,n=t.children,i=t.left,r=t.right,o=t.scale,s=t.handles,a=t.getEventData,l=t.activeHandleID,c=o.getDomain(),u=[],h=0;h<s.length+1;h++){var d=s[h-1],p=s[h];0===h&&!0===i?d={id:"$",value:c[0],percent:0}:h===s.length&&!0===r&&(p={id:"$",value:c[1],percent:100}),d&&p&&u.push({id:"".concat(d.id,"-").concat(p.id),source:d,target:p})}var f=n({getEventData:a,activeHandleID:l,tracks:u,getTrackProps:e});return f&&React__default.Children.only(f)}}]),t}(React.Component);function ownKeys$4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$4(n,!0).forEach((function(t){_defineProperty$3(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$4(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Tracks.propTypes={left:propTypes.bool,right:propTypes.bool,getEventData:propTypes.func,activeHandleID:propTypes.string,scale:propTypes.object,handles:propTypes.array,emitMouse:propTypes.func,emitTouch:propTypes.func,children:propTypes.func.isRequired},Tracks.defaultProps={left:!0,right:!0};var Handles=function(e){function t(){var e,n;_classCallCheck(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return _defineProperty$3(_assertThisInitialized(n=_possibleConstructorReturn(this,(e=_getPrototypeOf(t)).call.apply(e,[this].concat(r)))),"autofocus",(function(e){e.target.focus()})),_defineProperty$3(_assertThisInitialized(n),"getHandleProps",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.props,r=i.emitKeyboard,o=i.emitMouse,s=i.emitTouch;return _objectSpread$2({},t,{onKeyDown:callAll(t.onKeyDown,(function(t){return r(t,e)})),onMouseDown:callAll(t.onMouseDown,n.autofocus,(function(t){return o(t,e)})),onTouchStart:callAll(t.onTouchStart,(function(t){return s(t,e)}))})})),n}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this.getHandleProps,t=this.props,n=t.activeHandleID,i=(0,t.children)({handles:t.handles,activeHandleID:n,getHandleProps:e});return i&&React__default.Children.only(i)}}]),t}(React.Component);function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}Handles.propTypes={activeHandleID:propTypes.string,handles:propTypes.array,emitKeyboard:propTypes.func,emitMouse:propTypes.func,emitTouch:propTypes.func,children:propTypes.func.isRequired};var prfx="react-compound-slider:";function getSortByVal(e){return function(t,n){return t.val>n.val?e?-1:1:n.val>t.val?e?1:-1:0}}function getUpdatedHandles(e,t,n,i){var r=e.findIndex((function(e){return e.key===t}));if(-1!==r){var o=e[r],s=o.key;return o.val===n?e:[].concat(_toConsumableArray(e.slice(0,r)),[{key:s,val:n}],_toConsumableArray(e.slice(r+1))).sort(getSortByVal(i))}return e}function getSliderDomain(e,t){if(!e)return[0,0];var n=e.getBoundingClientRect();return[t?n.top:n.left,t?n.bottom:n.right]}function isNotValidTouch(e){var t=e.type,n=void 0===t?"":t,i=e.touches;return!i||i.length>1||"touchend"===n.toLowerCase()&&i.length>0}function getTouchPosition(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function getHandles(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=0;return{handles:e.map((function(e){var t=n.getValue(e);return e!==t&&(r+=1,warning_1(!i,"".concat(prfx," Invalid value encountered. Changing ").concat(e," to ").concat(t,"."))),t})).map((function(e,t){return{key:"$$-".concat(t),val:e}})).sort(getSortByVal(t)),changes:r}}function mode1(e,t){return t}function mode2(e,t){for(var n=0;n<e.length;n++){if(e[n].key!==t[n].key)return e;if(t[n+1]&&t[n].val===t[n+1].val)return e}return t}function mode3(e,t,n,i,r){for(var o=-1,s=!0,a=0;a<e.length;a++){var l=e[a],c=t[a];if(!c||c.key!==l.key)return e;c.val!==l.val&&(o=a,s=c.val-l.val>0)}if(-1===o)return e;for(var u=s?n:-n,h=0;h<t.length;h++){var d=t[h],p=t[h+1];if(p&&d.val===p.val){if(h===o){var f=p.val+u;if(r(f)===f){var m=mode3(t,getUpdatedHandles(t,p.key,p.val+u,i),n,i,r);return m===t?e:m}return e}var g=d.val+u;if(r(g)===g){var v=mode3(t,getUpdatedHandles(t,d.key,d.val+u,i),n,i,r);return v===t?e:v}return e}}return t}function ascending(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function bisector(e){return 1===e.length&&(e=ascendingComparator(e)),{left:function(t,n,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){var o=i+r>>>1;e(t[o],n)<0?i=o+1:r=o}return i},right:function(t,n,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){var o=i+r>>>1;e(t[o],n)>0?r=o:i=o+1}return i}}}function ascendingComparator(e){return function(t,n){return ascending(e(t),n)}}var ascendingBisect=bisector(ascending),e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(e,t,n){var i,r,o,s,a=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((i=t<e)&&(r=e,e=t,t=r),0===(s=tickIncrement(e,t,n))||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(r=Math.ceil(t-e+1));++a<r;)o[a]=(e+a)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(r=Math.ceil(e-t+1));++a<r;)o[a]=(e-a)/s;return i&&o.reverse(),o}function tickIncrement(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,r);return r>=0?(o>=e10?10:o>=e5?5:o>=e2?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=e10?10:o>=e5?5:o>=e2?2:1)}var LinearScale=function(){function e(){_classCallCheck(this,e),this.domain=[0,1],this.range=[0,1],this.interpolator=null}return _createClass(e,[{key:"createInterpolator",value:function(e,t){var n=e[0],i=e[1],r=t[0],o=t[1];return i<n?(n=this.deinterpolateValue(i,n),r=this.interpolateValue(o,r)):(n=this.deinterpolateValue(n,i),r=this.interpolateValue(r,o)),function(e){return r(n(e))}}},{key:"interpolateValue",value:function(e,t){return t-=e=+e,function(n){return e+t*n}}},{key:"deinterpolateValue",value:function(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(){return t}}},{key:"rescale",value:function(){return this.interpolator=null,this}},{key:"getValue",value:function(e){var t=this.domain,n=this.range;return(this.interpolator||(this.interpolator=this.createInterpolator(t,n)))(+e)}},{key:"setDomain",value:function(e){return this.domain=e.map((function(e){return+e})),this.rescale(),this}},{key:"getDomain",value:function(){return this.domain}},{key:"setRange",value:function(e){return this.range=e.map((function(e){return+e})),this}},{key:"getTicks",value:function(e){var t=this.domain;return ticks(t[0],t[t.length-1],e||10)}}]),e}();function clamp(e,t,n){return Math.min(Math.max(e,t),n)}var DiscreteScale=function e(){var t=this;_classCallCheck(this,e),_defineProperty$3(this,"setDomain",(function(e){return t.domain=e.slice(),t})),_defineProperty$3(this,"setRange",(function(e){return t.range=e.slice(),t})),_defineProperty$3(this,"setStep",(function(e){return t.step=e,t})),_defineProperty$3(this,"getValue",(function(e){var n=_slicedToArray(t.domain,2),i=n[0],r=n[1],o=_slicedToArray(t.range,2),s=o[0],a=o[1],l=t.step,c=(clamp(e,i,r)-i)/(r-i);return clamp(l*Math.round(c*(a-s)/l)+s,s<a?s:a,a>s?a:s)})),this.step=1,this.domain=[0,1],this.range=[0,1]},isBrowser$1="undefined"!=typeof window&&"undefined"!=typeof document,noop=function(){},compare=function(e){return function(t,n,i){return t&&e[i]===n}},equal=function(e,t){return e===t||e.length===t.length&&e.reduce(compare(t),!0)},getNextValue=function(e,t,n,i){var r=i?e-t:e+t;return i?Math.max(n[0],r):Math.min(n[1],r)},getPrevValue=function(e,t,n,i){var r=i?e+t:e-t;return i?Math.min(n[1],r):Math.max(n[0],r)},Slider=function(e){function t(){var e,n;_classCallCheck(this,t);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return _defineProperty$3(_assertThisInitialized(n=_possibleConstructorReturn(this,(e=_getPrototypeOf(t)).call.apply(e,[this].concat(r)))),"state",{step:null,values:null,domain:null,handles:[],reversed:null,activeHandleID:null,valueToPerc:null,valueToStep:null,pixelToStep:null}),_defineProperty$3(_assertThisInitialized(n),"slider",React__default.createRef()),_defineProperty$3(_assertThisInitialized(n),"onKeyDown",(function(e,t){var i=["ArrowRight","ArrowUp"],r=["ArrowDown","ArrowLeft"],o=_assertThisInitialized(n),s=o.state.handles,a=o.props,l=a.step,c=a.reversed,u=a.vertical,h=a.domain,d=e.key||e.keyCode;if(i.concat(r).includes(d)){if(u){var p=[r,i];i=p[0],r=p[1]}e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var f=s.find((function(e){return e.key===t}));if(f){var m=f.val,g=m;i.includes(d)?g=getNextValue(m,l,h,c):r.includes(d)&&(g=getPrevValue(m,l,h,c));var v=s.map((function(e){return e.key===t?{key:e.key,val:g}:e}));n.submitUpdate(v,!0)}}})),_defineProperty$3(_assertThisInitialized(n),"onMouseDown",(function(e,t){n.onStart(e,t,!1)})),_defineProperty$3(_assertThisInitialized(n),"onTouchStart",(function(e,t){isNotValidTouch(e)||n.onStart(e,t,!0)})),_defineProperty$3(_assertThisInitialized(n),"getEventData",(function(e,t){var i,r=_assertThisInitialized(n),o=r.state,s=o.pixelToStep,a=o.valueToPerc,l=r.props.vertical;return s.setDomain(getSliderDomain(n.slider.current,l)),{value:i=t?s.getValue(getTouchPosition(l,e)):s.getValue(l?e.clientY:e.pageX),percent:a.getValue(i)}})),_defineProperty$3(_assertThisInitialized(n),"onMouseMove",(function(e){var t=_assertThisInitialized(n),i=t.state,r=i.handles,o=i.pixelToStep,s=i.activeHandleID,a=t.props,l=a.vertical,c=a.reversed;o.setDomain(getSliderDomain(n.slider.current,l));var u=getUpdatedHandles(r,s,o.getValue(l?e.clientY:e.pageX),c);n.submitUpdate(u)})),_defineProperty$3(_assertThisInitialized(n),"onTouchMove",(function(e){var t=_assertThisInitialized(n),i=t.state,r=i.handles,o=i.pixelToStep,s=i.activeHandleID,a=t.props,l=a.vertical,c=a.reversed;if(!isNotValidTouch(e)){o.setDomain(getSliderDomain(n.slider.current,l));var u=getUpdatedHandles(r,s,o.getValue(getTouchPosition(l,e)),c);n.submitUpdate(u)}})),_defineProperty$3(_assertThisInitialized(n),"onMouseUp",(function(){var e=_assertThisInitialized(n),t=e.state,i=t.handles,r=t.activeHandleID,o=e.props,s=o.onChange,a=o.onSlideEnd;s(i.map((function(e){return e.val}))),a(i.map((function(e){return e.val})),{activeHandleID:r}),n.setState({activeHandleID:null}),isBrowser$1&&(document.removeEventListener("mousemove",n.onMouseMove),document.removeEventListener("mouseup",n.onMouseUp))})),_defineProperty$3(_assertThisInitialized(n),"onTouchEnd",(function(){var e=_assertThisInitialized(n),t=e.state,i=t.handles,r=t.activeHandleID,o=e.props,s=o.onChange,a=o.onSlideEnd;s(i.map((function(e){return e.val}))),a(i.map((function(e){return e.val})),{activeHandleID:r}),n.setState({activeHandleID:null}),isBrowser$1&&(document.removeEventListener("touchmove",n.onTouchMove),document.removeEventListener("touchend",n.onTouchEnd))})),n}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){var e=this.state.pixelToStep,t=this.props.vertical;e.setDomain(getSliderDomain(this.slider.current,t))}},{key:"componentWillUnmount",value:function(){this.removeListeners()}},{key:"removeListeners",value:function(){isBrowser$1&&(document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"onStart",value:function(e,t,n){var i=this.state.handles,r=this.props.onSlideStart;n||e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),i.find((function(e){return e.key===t}))?(this.setState({activeHandleID:t}),r(i.map((function(e){return e.val})),{activeHandleID:t}),n?this.addTouchEvents():this.addMouseEvents()):(this.setState({activeHandleID:null}),this.handleRailAndTrackClicks(e,n))}},{key:"handleRailAndTrackClicks",value:function(e,t){var n,i=this,r=this.state,o=r.handles,s=r.pixelToStep,a=this.props,l=a.vertical,c=a.reversed,u=this.slider;s.setDomain(getSliderDomain(u.current,l)),n=t?s.getValue(getTouchPosition(l,e)):s.getValue(l?e.clientY:e.pageX);for(var h=null,d=1/0,p=0;p<o.length;p++){var f=o[p],m=f.key,g=f.val,v=Math.abs(g-n);v<d&&(h=m,d=v)}var y=getUpdatedHandles(o,h,n,c);this.setState({activeHandleID:h},(function(){i.submitUpdate(y,!0),t?i.addTouchEvents():i.addMouseEvents()}))}},{key:"addMouseEvents",value:function(){isBrowser$1&&(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}},{key:"addTouchEvents",value:function(){isBrowser$1&&(document.addEventListener("touchmove",this.onTouchMove),document.addEventListener("touchend",this.onTouchEnd))}},{key:"submitUpdate",value:function(e,t){var n=this.props,i=n.mode,r=n.step,o=n.onUpdate,s=n.onChange,a=n.reversed,l=this.state.valueToStep.getValue;this.setState((function(n){var c,u=n.handles;if("function"==typeof i)c=i(u,e,r,a,l),warning_1(Array.isArray(c),"Custom mode function did not return an array.");else switch(i){case 1:c=mode1(u,e);break;case 2:c=mode2(u,e);break;case 3:c=mode3(u,e,r,a,l);break;default:c=e,warning_1(!1,"".concat(prfx," Invalid mode value."))}return o(c.map((function(e){return e.val}))),t&&s(c.map((function(e){return e.val}))),{handles:c}}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.handles,i=t.valueToPerc,r=t.activeHandleID,o=this.props,s=o.className,a=o.rootStyle,l=o.rootProps,c=o.component,u=o.disabled,h=o.flatten,d=n.map((function(e){var t=e.key,n=e.val;return{id:t,value:n,percent:i.getValue(n)}})),p=React__default.Children.map(this.props.children,(function(t){return!t||t.type.name!==Rail.name&&t.type.name!==Ticks.name&&t.type.name!==Tracks.name&&t.type.name!==Handles.name?t:React__default.cloneElement(t,{scale:i,handles:d,activeHandleID:r,getEventData:e.getEventData,emitKeyboard:u?noop:e.onKeyDown,emitMouse:u?noop:e.onMouseDown,emitTouch:u?noop:e.onTouchStart})}));return h?React__default.createElement(React.Fragment,null,React__default.createElement(c,_extends$2({},l,{style:a,className:s,ref:this.slider})),p):React__default.createElement(c,_extends$2({},l,{style:a,className:s,ref:this.slider}),p)}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.step,i=e.values,r=e.domain,o=e.reversed,s=e.onUpdate,a=e.onChange,l=e.warnOnChanges,c=t.valueToPerc,u=t.valueToStep,h=t.pixelToStep,d={};if(c&&u&&h||(c=new LinearScale,u=new DiscreteScale,h=new DiscreteScale,d.valueToPerc=c,d.valueToStep=u,d.pixelToStep=h),null===t.step||null===t.domain||null===t.reversed||n!==t.step||r[0]!==t.domain[0]||r[1]!==t.domain[1]||o!==t.reversed){var p=_slicedToArray(r,2),f=p[0],m=p[1];u.setStep(n).setRange([f,m]).setDomain([f,m]),!0===o?(c.setDomain([f,m]).setRange([100,0]),h.setStep(n).setRange([m,f])):(c.setDomain([f,m]).setRange([0,100]),h.setStep(n).setRange([f,m])),warning_1(m>f,"".concat(prfx," Max must be greater than min (even if reversed). Max is ").concat(m,". Min is ").concat(f,"."));var g=getHandles(i||t.values,o,u,l),v=g.handles;(g.changes||void 0===i||i===t.values)&&(s(v.map((function(e){return e.val}))),a(v.map((function(e){return e.val})))),d.step=n,d.values=i,d.domain=r,d.handles=v,d.reversed=o}else if(!equal(i,t.values)){var y=getHandles(i,o,u,l),w=y.handles;y.changes&&(s(w.map((function(e){return e.val}))),a(w.map((function(e){return e.val})))),d.values=i,d.handles=w}return Object.keys(d).length?d:null}}]),t}(React.PureComponent);Slider.propTypes={component:propTypes.string,rootStyle:propTypes.object,rootProps:propTypes.object,className:propTypes.string,domain:propTypes.array,values:propTypes.array,step:propTypes.number,mode:propTypes.oneOfType([propTypes.number,propTypes.func]),vertical:propTypes.bool,reversed:propTypes.bool,onChange:propTypes.func,onUpdate:propTypes.func,onSlideStart:propTypes.func,onSlideEnd:propTypes.func,disabled:propTypes.bool,flatten:propTypes.bool,warnOnChanges:propTypes.bool,children:propTypes.any},Slider.defaultProps={mode:1,step:.1,domain:[0,100],component:"div",rootProps:{},rootStyle:{},vertical:!1,reversed:!1,onChange:noop,onUpdate:noop,onSlideStart:noop,onSlideEnd:noop,disabled:!1,flatten:!1,warnOnChanges:!1},Slider.Rail=Rail,Slider.Ticks=Ticks,Slider.Tracks=Tracks,Slider.Handles=Handles;const Tooltip$3=({value:e=null})=>React__default.createElement("div",{className:"tooltip"},React__default.createElement("span",{className:"tooltiptext"},e));Tooltip$3.propTypes={value:propTypes.number};class Handle extends React.Component{constructor(...e){super(...e),_defineProperty(this,"state",{mouseOver:!1}),_defineProperty(this,"onMouseEnter",()=>{this.setState({mouseOver:!0})}),_defineProperty(this,"onMouseLeave",()=>{this.setState({mouseOver:!1})})}render(){const{domain:[e,t],handle:{id:n,value:i,percent:r},isActive:o,disabled:s,getHandleProps:a}=this.props,{mouseOver:l}=this.state;return React__default.createElement("button",_extends({role:"slider","aria-valuemin":e,"aria-valuemax":t,"aria-valuenow":i,style:{height:14,width:14,left:`${r}%`,position:"absolute",transform:"translate(-50%, -50%)",WebkitTapHighlightColor:"rgba(0,0,0,0)",border:0,borderRadius:"50%",backgroundColor:s?"transparent":"var(--slider-track-bg)",zIndex:1}},a(n,{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave})),!l&&!o||s?null:React__default.createElement(Tooltip$3,{value:i}))}}Handle.propTypes={domain:propTypes.array.isRequired,handle:propTypes.shape({id:propTypes.string.isRequired,value:propTypes.number.isRequired,percent:propTypes.number.isRequired}).isRequired,getHandleProps:propTypes.func.isRequired,isActive:propTypes.bool.isRequired,disabled:propTypes.bool};var Handle$1=React__default.memo(Handle);const railStyle={position:"absolute",margin:0,width:"100%",height:"100%",cursor:"pointer",borderRadius:"4px",backgroundColor:"var(--slider-bg)",zIndex:-1};class SliderRail extends React.Component{constructor(...e){super(...e),_defineProperty(this,"state",{value:null,percent:null}),_defineProperty(this,"onMouseEnter",()=>{document.addEventListener("mousemove",this.onMouseMove)}),_defineProperty(this,"onMouseLeave",()=>{this.setState({value:null,percent:null}),document.removeEventListener("mousemove",this.onMouseMove)}),_defineProperty(this,"onMouseMove",e=>{const{activeHandleID:t,getEventData:n}=this.props;t?this.setState({value:null,percent:null}):this.setState(n(e))})}render(){const{value:e,percent:t}=this.state,{activeHandleID:n,getRailProps:i}=this.props;return React__default.createElement("div",_extends({style:railStyle},i({onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave})))}}_defineProperty(SliderRail,"defaultProps",{disabled:!1}),SliderRail.propTypes={activeHandleID:propTypes.string,getEventData:propTypes.func.isRequired,getRailProps:propTypes.func.isRequired};const sliderStyle={position:"absolute",width:"100%",height:6,display:"flex",alignItems:"center",borderRadius:"4px",justifyContent:"center",zIndex:99},Track=({source:e,target:t,getTrackProps:n})=>React__default.createElement("div",_extends({className:"slider-track",style:{zIndex:0,left:`${e.percent}%`,width:`${t.percent-e.percent}%`}},n())),defaultValues=[1],SliderUI=({max:e=1,bufferProgress:t=0,reversed:n,onChange:i,value:r})=>{const[o,s]=React.useState(!1),[a,l]=React.useState(defaultValues.slice()),c=[1,e];if(1==e)return null;return React.useEffect(()=>{o||l([r+1])},[r]),React__default.createElement("div",{className:"villain-slider",style:{height:sliderStyle.height}},React__default.createElement(Slider,{rootStyle:sliderStyle,domain:c,step:1,mode:2,values:a,onUpdate:()=>s(!0),onChange:e=>{s(!1),i(e[0]-1)},reversed:n},React__default.createElement(Rail,null,({activeHandleID:e,getEventData:t,getRailProps:n})=>React__default.createElement(SliderRail,{activeHandleID:e,getEventData:t,getRailProps:n})),React__default.createElement(Handles,null,({handles:e,activeHandleID:t,getHandleProps:n})=>React__default.createElement("div",{className:"slider-handles"},e.map(e=>React__default.createElement(Handle$1,{key:e.id,handle:e,domain:c,isActive:e.id===t,getHandleProps:n})))),React__default.createElement(Tracks,{right:n,left:!n},({tracks:e,getTrackProps:t})=>React__default.createElement("div",{className:"slider-tracks"},e.map(({id:e,source:n,target:i})=>React__default.createElement(Track,{key:e,source:n,target:i,getTrackProps:t}))))),React__default.createElement("div",{className:"buffer",style:{width:`${t}%`,borderRadius:"4px",right:n?0:"initial"}}))};var Slider$1=React__default.memo(SliderUI);function useLiveRef(e){var t=React.useRef(e);return React.useEffect((function(){t.current=e})),t}var selector="input, select, textarea, a[href], button, [tabindex], audio[controls], video[controls], [contenteditable]:not([contenteditable=false])";function isHTMLElement(e){return e instanceof HTMLElement}function isDisabled(e){return Boolean(e.disabled)}function hasTabIndex(e){return e.hasAttribute("tabindex")}function hasNegativeTabIndex(e){return hasTabIndex(e)&&e.tabIndex<0}function isHidden(e){return!(!e.parentElement||!isHidden(e.parentElement))||e.hidden}function isContentEditable(e){var t=e.getAttribute("contenteditable");return"false"!==t&&null!=t}function isFocusable(e){if(!isHTMLElement(e))return!1;if(isHidden(e))return!1;if(isDisabled(e))return!1;var t=e.localName;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;var n={a:function(){return e.hasAttribute("href")},audio:function(){return e.hasAttribute("controls")},video:function(){return e.hasAttribute("controls")}};return t in n?n[t]():!!isContentEditable(e)||hasTabIndex(e)}function isTabbable(e){return isHTMLElement(e)&&isFocusable(e)&&!hasNegativeTabIndex(e)}function getAllTabbableIn(e,t){var n=Array.from(e.querySelectorAll(selector)),i=n.filter(isTabbable);return isTabbable(e)&&i.unshift(e),!i.length&&t?n:i}function getFirstTabbableIn(e,t){return getAllTabbableIn(e,t)[0]||null}function getLastTabbableIn(e,t){var n=getAllTabbableIn(e,t);return n[n.length-1]||null}function defaultIsActive(e){return document.activeElement===e}function forceFocus(e,t){var n=void 0===t?{}:t,i=n.isActive,r=void 0===i?defaultIsActive:i,o=n.preventScroll;return r(e)?-1:(e.focus({preventScroll:o}),r(e)?-1:requestAnimationFrame((function(){e.focus({preventScroll:o})})))}function hasFocusWithin(e){return!!document.activeElement&&e.contains(document.activeElement)}function isNativeTabbable(e){return e instanceof HTMLButtonElement||e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLAnchorElement||e instanceof HTMLAudioElement||e instanceof HTMLVideoElement}function isFormTabbable(e){return e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement}var defaultClickKeys=["Enter"," "],useTabbable=createHook({name:"Tabbable",compose:useBox,keys:["disabled","focusable","unstable_clickKeys"],useOptions:function(e,t){var n=e.unstable_clickKeys,i=void 0===n?defaultClickKeys:n,r=_objectWithoutPropertiesLoose$1(e,["unstable_clickKeys"]);return _objectSpread2$1({unstable_clickKeys:i,disabled:t.disabled},r)},useProps:function(e,t){var n=t.ref,i=t.tabIndex,r=void 0===i?0:i,o=t.onClick,s=t.onMouseOver,a=t.onMouseDown,l=t.onKeyDown,c=_objectWithoutPropertiesLoose$1(t,["ref","tabIndex","onClick","onMouseOver","onMouseDown","onKeyDown"]),u=React.useRef(null),h=useLiveRef(e.unstable_clickKeys),d=e.disabled&&!e.focusable,p=React.useCallback((function(t){if(!isFormTabbable(t.target)&&t.currentTarget.contains(t.target))if(t.preventDefault(),e.disabled)t.stopPropagation();else{var n=t.currentTarget,i=t.target,r=isFocusable(i)||i instanceof HTMLLabelElement;hasFocusWithin(n)&&n!==i&&r||n.focus(),a&&a(t)}else a&&a(t)}),[e.disabled,a]),f=React.useCallback((function(t){e.disabled?(t.stopPropagation(),t.preventDefault()):o&&o(t)}),[e.disabled,o]),m=React.useCallback((function(t){e.disabled?(t.stopPropagation(),t.preventDefault()):s&&s(t)}),[e.disabled,s]),g=React.useCallback((function(t){e.disabled||h.current&&-1!==h.current.indexOf(t.key)&&(-1!==defaultClickKeys.indexOf(t.key)&&isNativeTabbable(t.target)||(t.preventDefault(),t.target.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1}))))}),[h,e.disabled]);return _objectSpread2$1({ref:mergeRefs(u,n),disabled:d,tabIndex:d?void 0:r,"aria-disabled":e.disabled,onMouseDown:p,onClick:f,onMouseOver:m,onKeyDown:useAllCallbacks(g,l)},c)}}),Tabbable=createComponent({as:"button",useHook:useTabbable}),useButton=createHook({name:"Button",compose:useTabbable,useProps:function(e,t){var n=t.ref,i=_objectWithoutPropertiesLoose$1(t,["ref"]),r=React.useRef(null),o=React.useState(void 0),s=o[0],a=o[1];return React.useEffect((function(){r.current&&(r.current instanceof HTMLButtonElement||r.current instanceof HTMLAnchorElement||r.current instanceof HTMLInputElement)||a("button")}),[]),_objectSpread2$1({ref:mergeRefs(r,n),role:s,type:"button"},i)}}),Button$2=createComponent({as:"button",useHook:useButton});function removeIndexFromArray(e,t){return-1===t?e:[].concat(e.slice(0,t),e.slice(t+1))}function useUpdateEffect(e,t){var n=React.useRef(!1);React.useEffect((function(){if(n.current)return e();n.current=!0}),t)}function matches(e,t){return"matches"in e?e.matches(t):"msMatchesSelector"in e?e.msMatchesSelector(t):e.webkitMatchesSelector(t)}function closest(e,t){if("closest"in e)return e.closest(t);do{if(matches(e,t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}function removeItemFromArray(e,t){var n=e.indexOf(t);return removeIndexFromArray(e,n)}function useDisclosuresRef(e){var t=React.useRef([]),n=React.useRef(null);return useIsomorphicEffect((function(){if(!e.visible){var t=function(){n.current=document.activeElement};return document.addEventListener("focus",t,!0),function(){return document.removeEventListener("focus",t,!0)}}}),[e.visible]),React.useEffect((function(){if(e.visible){var i='[aria-controls~="'+e.unstable_hiddenId+'"]',r=Array.from(document.querySelectorAll(i));n.current instanceof HTMLElement?-1!==r.indexOf(n.current)?t.current=[n.current].concat(r.filter((function(e){return e!==n.current}))):t.current=[n.current].concat(r):t.current=r}}),[e.unstable_hiddenId,e.visible]),t}function usePreventBodyScroll(e,t){var n=!!t.modal&&Boolean(t.preventBodyScroll&&t.visible);React.useEffect((function(){var t=e.current;if(t&&n)return bodyScrollLock.disableBodyScroll(t,{reserveScrollBarGap:!0}),function(){return bodyScrollLock.enableBodyScroll(t)}}),[e,n])}function useFocusOnShow(e,t,n){var i=n.unstable_initialFocusRef,r=n.visible&&n.unstable_autoFocusOnShow;useUpdateEffect((function(){var n=e.current;if(warning(Boolean(r&&!n),"Dialog","Can't set initial focus on dialog because `ref` wasn't passed to component.","See https://reakit.io/docs/dialog"),r&&n&&!t.find((function(e){return Boolean(e.current&&!e.current.hidden)})))if(i&&i.current)i.current.focus({preventScroll:!0});else{var o=getFirstTabbableIn(n,!0),s=function(){return n.contains(document.activeElement)};o?forceFocus(o,{preventScroll:!0,isActive:s}):(forceFocus(n,{preventScroll:!0,isActive:s}),warning(void 0===n.tabIndex||n.tabIndex<0,"Dialog","It's recommended to have at least one tabbable element inside dialog. The dialog element has been automatically focused.","If this is the intended behavior, pass `tabIndex={0}` to the dialog element to disable this warning.","See https://reakit.io/docs/dialog/#initial-focus"))}}),[e,t,i,r])}function usePortalRef(e,t){var n=React.useRef(null);return React.useEffect((function(){var i=e.current;i&&t.visible&&(n.current=closest(i,Portal.__selector))}),[e,t.visible]),n}function removeFromDOM(e){null!=e.parentNode&&e.parentNode.removeChild(e)}function hasNestedOpenModals(e){return e.find((function(e){return Boolean(e.current&&!e.current.hidden&&"true"===e.current.getAttribute("aria-modal"))}))}var focusTrapClassName="__reakit-focus-trap";function isFocusTrap(e){return e.classList.contains(focusTrapClassName)}function useFocusTrap(e,t,n){var i=usePortalRef(e,n),r=n.visible&&n.modal,o=React.useRef(null),s=React.useRef(null);React.useEffect((function(){if(r){var e=i.current;if(e)return o.current||(o.current=document.createElement("div"),o.current.className=focusTrapClassName,o.current.tabIndex=0,o.current.style.position="fixed",o.current.setAttribute("aria-hidden","true")),s.current||(s.current=o.current.cloneNode()),e.insertAdjacentElement("beforebegin",o.current),e.insertAdjacentElement("afterend",s.current),function(){o.current&&removeFromDOM(o.current),s.current&&removeFromDOM(s.current)};warning(!0,"Dialog","Can't trap focus within modal dialog because either `ref` wasn't passed to component or the component wasn't rendered within a portal","See https://reakit.io/docs/dialog")}}),[i,r]),React.useEffect((function(){var n=o.current,i=s.current;if(r&&n&&i){var a=function(n){var r=e.current;if(r&&!hasNestedOpenModals(t)){n.preventDefault();var o=n.target===i?getFirstTabbableIn(r):getLastTabbableIn(r);o?o.focus():r.focus()}};return n.addEventListener("focus",a),i.addEventListener("focus",a),function(){n.removeEventListener("focus",a),i.removeEventListener("focus",a)}}}),[e,t,r]),React.useEffect((function(){if(r){var n=function(){var n=e.current,r=i.current;n&&r&&!hasNestedOpenModals(t)&&(r.contains(document.activeElement)||n.focus())};return document.addEventListener("click",n),function(){document.removeEventListener("click",n)}}}),[e,t,i,r])}function useFocusOnHide(e,t,n){var i=n.unstable_autoFocusOnHide&&!n.visible;useUpdateEffect((function(){if(i){var r=e.current;if(!document.activeElement||!r||r.contains(document.activeElement)||!isTabbable(document.activeElement)&&"true"!==document.activeElement.getAttribute("data-dialog")){var o=n.unstable_finalFocusRef&&n.unstable_finalFocusRef.current||t.current&&t.current[0];o?forceFocus(o):warning(!0,"Dialog","Can't return focus after closing dialog. Either render a disclosure component or provide a `unstable_finalFocusRef` prop.","See https://reakit.io/docs/dialog")}}}),[e,t,i])}var DialogContext=React.createContext({});function useNestedDialogs(e,t){var n=React.useContext(DialogContext),i=React.useState([]),r=i[0],o=i[1],s=React.useCallback((function(e){n.addDialog&&n.addDialog(e),o((function(t){return[].concat(t,[e])}))}),[n.addDialog]),a=React.useCallback((function(e){n.removeDialog&&n.removeDialog(e),o((function(t){return removeItemFromArray(t,e)}))}),[n.removeDialog]);React.useEffect((function(){if(n.addDialog&&!t.unstable_orphan)return n.addDialog(e),function(){n.removeDialog&&n.removeDialog(e)}}),[e,n.addDialog,n.removeDialog,t.unstable_orphan]),React.useEffect((function(){!1===n.visible&&t.visible&&t.hide&&!t.unstable_orphan&&t.hide()}),[n.visible,t.visible,t.hide,t.unstable_orphan]);var l=React.useMemo((function(){return{visible:t.visible,addDialog:s,removeDialog:a}}),[t.visible,s,a]);return{dialogs:r,wrap:React.useCallback((function(e){return React.createElement(DialogContext.Provider,{value:l},e)}),[l])}}function useEventListenerOutside(e,t,n,i,r,o){var s=useLiveRef(r);React.useEffect((function(){if(o){var r=function(i){if(s.current){var r=e.current,o=t.current||[],a=i.target;r?r.contains(a)||o.length&&o.some((function(e){return e.contains(a)}))||isFocusTrap(a)||n.find((function(e){return Boolean(e.current&&e.current.contains(a))}))||s.current(i):warning(!0,"Dialog","Can't detect events outside dialog because `ref` wasn't passed to component.","See https://reakit.io/docs/dialog")}};return document.addEventListener(i,r,!0),function(){document.removeEventListener(i,r,!0)}}}),[e,t,n,i,o,s])}function useHideOnClickOutside(e,t,n,i){var r=function(r){return useEventListenerOutside(e,t,n,r,i.hide,i.visible&&i.hideOnClickOutside)};r("click"),r("focus")}function useDisableHoverOutside(e,t,n){var i=function(i){return useEventListenerOutside(e,{current:null},t,i,(function(e){e.stopPropagation(),e.preventDefault()}),n.visible&&n.modal)};i("mouseover"),i("mouseout")}function usePortal(e,t){var n=React.useContext(PortalContext);return React.useCallback((function(i){if(t.unstable_portal&&(i=React.createElement(Portal,null,React.createElement(PortalContext.Provider,{value:e.current},i))),t.unstable_orphan&&n){var r=closest(n,Portal.__selector);i=React.createElement(PortalContext.Provider,{value:r},i)}return i}),[e,n,t.unstable_portal,t.unstable_orphan])}var useDialog=createHook({name:"Dialog",compose:useHidden,useState:useDialogState,keys:["modal","hideOnEsc","hideOnClickOutside","preventBodyScroll","unstable_initialFocusRef","unstable_finalFocusRef","unstable_autoFocusOnShow","unstable_autoFocusOnHide","unstable_portal","unstable_orphan"],useOptions:function(e){var t=e.modal,n=void 0===t||t,i=e.hideOnEsc,r=void 0===i||i,o=e.hideOnClickOutside,s=void 0===o||o,a=e.preventBodyScroll,l=void 0===a||a,c=e.unstable_autoFocusOnShow,u=void 0===c||c,h=e.unstable_autoFocusOnHide,d=void 0===h||h,p=e.unstable_portal,f=void 0===p?n:p,m=e.unstable_orphan;return _objectSpread2$1({modal:n,hideOnEsc:r,hideOnClickOutside:s,preventBodyScroll:l,unstable_autoFocusOnShow:u,unstable_autoFocusOnHide:d,unstable_portal:f,unstable_orphan:n&&m},_objectWithoutPropertiesLoose$1(e,["modal","hideOnEsc","hideOnClickOutside","preventBodyScroll","unstable_autoFocusOnShow","unstable_autoFocusOnHide","unstable_portal","unstable_orphan"]))},useProps:function(e,t){var n=t.ref,i=t.onKeyDown,r=t.unstable_wrap,o=_objectWithoutPropertiesLoose$1(t,["ref","onKeyDown","unstable_wrap"]),s=React.useRef(null),a=useDisclosuresRef(e),l=useNestedDialogs(s,e),c=l.dialogs,u=l.wrap,h=usePortal(s,e);usePreventBodyScroll(s,e),useFocusTrap(s,c,e),useFocusOnShow(s,c,e),useFocusOnHide(s,a,e),useHideOnClickOutside(s,a,c,e),useDisableHoverOutside(s,c,e);var d=React.useCallback((function(t){if("Escape"===t.key&&e.hideOnEsc){if(!e.hide)return void warning(!0,"Dialog","`hideOnEsc` prop is truthy, but `hide` prop wasn't provided.","See https://reakit.io/docs/dialog");t.stopPropagation(),e.hide()}}),[e.hideOnEsc,e.hide]);return _objectSpread2$1({ref:mergeRefs(s,n),role:"dialog",tabIndex:-1,onKeyDown:useAllCallbacks(d,i),unstable_wrap:usePipe(u,h,r),"aria-modal":!!e.modal||void 0,"data-dialog":!0},o)}}),Dialog=createComponent({as:"div",useHook:useDialog,useCreateElement:function(e,t,n){return warning(!t["aria-label"]&&!t["aria-labelledby"],"Dialog","You should provide either `aria-label` or `aria-labelledby` props.","See https://reakit.io/docs/dialog"),useCreateElement(e,t,n)}}),useHiddenDisclosure=createHook({name:"HiddenDisclosure",compose:useButton,useState:useHiddenState,useProps:function(e,t){var n=t.onClick,i=t["aria-controls"],r=_objectWithoutPropertiesLoose$1(t,["onClick","aria-controls"]),o=i?i+" "+e.unstable_hiddenId:e.unstable_hiddenId;return _objectSpread2$1({onClick:useAllCallbacks(e.toggle,n),"aria-expanded":Boolean(e.visible),"aria-controls":o},r)}}),HiddenDisclosure=createComponent({as:"button",useHook:useHiddenDisclosure}),useDialogDisclosure=createHook({name:"DialogDisclosure",compose:useHiddenDisclosure,useState:useDialogState,useProps:function(e,t){return _objectSpread2$1({"aria-haspopup":"dialog"},t)}}),DialogDisclosure=createComponent({as:"button",useHook:useDialogDisclosure});function createOnKeyDown(e){var t=void 0===e?{}:e,n=t.keyMap,i=t.onKey,r=t.stopPropagation,o=t.onKeyDown,s=t.shouldKeyDown,a=void 0===s?function(){return!0}:s,l=t.preventDefault,c=void 0===l||l;return function(e){if(n){var t="function"==typeof n?n(e):n,s="function"==typeof c?c(e):c,l="function"==typeof r?r(e):r;if(e.key in t){var u=t[e.key];if("function"==typeof u&&a(e))return s&&e.preventDefault(),l&&e.stopPropagation(),i&&i(e),void u(e)}o&&o(e)}}}function reducer(e,t){var n=e.stops,i=e.currentId,r=e.unstable_pastId,o=e.unstable_moves,s=e.loop;switch(t.type){case"register":var a=t.id,l=t.ref;if(0===n.length)return _objectSpread2$1({},e,{stops:[{id:a,ref:l}]});if(n.findIndex((function(e){return e.id===a}))>=0)return e;var c=n.findIndex((function(e){return!(!e.ref.current||!l.current)&&Boolean(e.ref.current.compareDocumentPosition(l.current)&Node.DOCUMENT_POSITION_PRECEDING)}));return _objectSpread2$1({},e,-1===c?{stops:[].concat(n,[{id:a,ref:l}])}:{stops:[].concat(n.slice(0,c),[{id:a,ref:l}],n.slice(c))});case"unregister":var u=t.id,h=n.filter((function(e){return e.id!==u}));return h.length===n.length?(warning(!0,"RoverState",u+" stop is not registered"),e):_objectSpread2$1({},e,{stops:h,unstable_pastId:r&&r===u?null:r,currentId:i&&i===u?null:i});case"move":var d=t.id;if(null===d)return _objectSpread2$1({},e,{currentId:null,unstable_pastId:i,unstable_moves:o+1});var p=n.findIndex((function(e){return e.id===d}));return-1===p?e:n[p].id===i?_objectSpread2$1({},e,{unstable_moves:o+1}):_objectSpread2$1({},e,{currentId:n[p].id,unstable_pastId:i,unstable_moves:o+1});case"next":if(null==i)return reducer(e,{type:"move",id:n[0]&&n[0].id});var f=n.findIndex((function(e){return e.id===i})),m=[].concat(n.slice(f+1),s?n.slice(0,f):[]),g=m.findIndex((function(e){return e.id===i}))+1;return reducer(e,{type:"move",id:m[g]&&m[g].id});case"previous":var v=reducer(_objectSpread2$1({},e,{stops:n.slice().reverse()}),{type:"next"});v.stops;return _objectSpread2$1({},e,{},_objectWithoutPropertiesLoose$1(v,["stops"]));case"first":var y=n[0];return reducer(e,{type:"move",id:y&&y.id});case"last":var w=n[n.length-1];return reducer(e,{type:"move",id:w&&w.id});case"reset":return _objectSpread2$1({},e,{currentId:null,unstable_pastId:null});case"orientate":return _objectSpread2$1({},e,{orientation:t.orientation});default:throw new Error}}function useRoverState(e){void 0===e&&(e={});var t=useSealedState(e),n=t.orientation,i=t.currentId,r=void 0===i?null:i,o=t.loop,s=void 0!==o&&o,a=React.useReducer(reducer,{orientation:n,stops:[],currentId:r,unstable_pastId:null,unstable_moves:0,loop:s}),l=a[0],c=a[1];return _objectSpread2$1({},l,{register:React.useCallback((function(e,t){return c({type:"register",id:e,ref:t})}),[]),unregister:React.useCallback((function(e){return c({type:"unregister",id:e})}),[]),move:React.useCallback((function(e){return c({type:"move",id:e})}),[]),next:React.useCallback((function(){return c({type:"next"})}),[]),previous:React.useCallback((function(){return c({type:"previous"})}),[]),first:React.useCallback((function(){return c({type:"first"})}),[]),last:React.useCallback((function(){return c({type:"last"})}),[]),unstable_reset:React.useCallback((function(){return c({type:"reset"})}),[]),unstable_orientate:React.useCallback((function(e){return c({type:"orientate",orientation:e})}),[])})}var keys$4=["orientation","stops","currentId","unstable_pastId","unstable_moves","loop","register","unregister","move","next","previous","first","last","unstable_reset","unstable_orientate"];useRoverState.__keys=keys$4;var useRover=createHook({name:"Rover",compose:useTabbable,useState:useRoverState,keys:["stopId"],useProps:function(e,t){var n=t.ref,i=t.tabIndex,r=t.onKeyDown,o=_objectWithoutPropertiesLoose$1(t,["ref","tabIndex","onKeyDown"]),s=React.useRef(null),a=useId("rover-"),l=e.stopId||o.id||a,c=e.disabled&&!e.focusable,u=null==e.currentId,h=e.currentId===l,d=(e.stops||[])[0]&&e.stops[0].id===l,p=h||d&&u;React.useEffect((function(){if(!c)return e.register&&e.register(l,s),function(){return e.unregister&&e.unregister(l)}}),[l,c,e.register,e.unregister]),React.useEffect((function(){s.current?e.unstable_moves&&h&&!hasFocusWithin(s.current)&&s.current.focus():warning(!0,"Rover","Can't focus rover component because `ref` wasn't passed to component.","See https://reakit.io/docs/rover")}),[h,e.unstable_moves]),React.useEffect((function(){if(s.current){var t=function(){return e.move(l)};return s.current.addEventListener("focus",t,!0),function(){s.current&&s.current.removeEventListener("focus",t,!0)}}}),[e.move,l]);var f=React.useMemo((function(){return createOnKeyDown({onKeyDown:r,stopPropagation:!0,shouldKeyDown:function(e){return e.currentTarget.contains(e.target)},keyMap:{ArrowUp:"horizontal"!==e.orientation&&e.previous,ArrowRight:"vertical"!==e.orientation&&e.next,ArrowDown:"horizontal"!==e.orientation&&e.next,ArrowLeft:"vertical"!==e.orientation&&e.previous,Home:e.first,End:e.last,PageUp:e.first,PageDown:e.last}})}),[r,e.orientation,e.previous,e.next,e.first,e.last]);return _objectSpread2$1({ref:mergeRefs(s,n),id:l,tabIndex:p?i:-1,onKeyDown:f},o)}}),Rover=createComponent({as:"button",useHook:useRover}),usePopover=createHook({name:"Popover",compose:useDialog,useState:usePopoverState,useOptions:function(e){var t=e.modal;return _objectSpread2$1({modal:void 0!==t&&t},_objectWithoutPropertiesLoose$1(e,["modal"]))},useProps:function(e,t){var n=t.ref,i=t.style,r=_objectWithoutPropertiesLoose$1(t,["ref","style"]);return _objectSpread2$1({ref:mergeRefs(e.unstable_popoverRef,n),style:_objectSpread2$1({},e.unstable_popoverStyles,{},i)},r)}}),Popover=createComponent({as:"div",useHook:usePopover,useCreateElement:function(e,t,n){return warning(!t["aria-label"]&&!t["aria-labelledby"],"Popover","You should provide either `aria-label` or `aria-labelledby` props.","See https://reakit.io/docs/popover"),useCreateElement(e,t,n)}}),MenuContext=React.createContext(null);function useMenuContext(e,t,n){var i="unstable_orphan"in n&&n.unstable_orphan,r=React.useContext(MenuContext),o=React.useState([]),s=o[0],a=o[1],l=r||{},c=l.addChild,u=l.removeChild,h=React.useCallback((function(e){return a((function(t){return[].concat(t,[e])}))}),[]),d=React.useCallback((function(e){return a((function(t){return removeItemFromArray(t,e)}))}),[]);React.useEffect((function(){if(c&&!i)return c(e),function(){u&&u(e)}}),[e,c,u,i]);var p=React.useMemo((function(){return{orientation:n.orientation,next:n.next,previous:n.previous,ref:e,role:t,parent:r,children:s,addChild:h,removeChild:d}}),[n.orientation,n.next,n.previous,e,t,r,s,h,d]);return React.useCallback((function(e){return React.createElement(MenuContext.Provider,{value:p},e)}),[p])}function useMenuBarState(e){void 0===e&&(e={});var t=useSealedState(e),n=t.orientation,i=void 0===n?"horizontal":n,r=t.unstable_values,o=void 0===r?{}:r,s=_objectWithoutPropertiesLoose$1(t,["orientation","unstable_values"]),a=React.useState(o),l=a[0],c=a[1],u=useRoverState(_objectSpread2$1({},s,{orientation:i}));return _objectSpread2$1({},u,{unstable_values:l,unstable_update:React.useCallback((function(e,t){c((function(n){var i;return _objectSpread2$1({},n,((i={})[e]="function"==typeof t?t(n):t,i))}))}),[])})}var keys$5=[].concat(useRoverState.__keys,["unstable_values","unstable_update"]);function useMenuState(e){void 0===e&&(e={});var t=useSealedState(e),n=t.orientation,i=void 0===n?"vertical":n,r=t.gutter,o=void 0===r?0:r,s=_objectWithoutPropertiesLoose$1(t,["orientation","gutter"]),a=React.useContext(MenuContext),l=s.placement||(a&&"vertical"===a.orientation?"right-start":"bottom-start"),c=useMenuBarState(_objectSpread2$1({},s,{orientation:i})),u=usePopoverState(_objectSpread2$1({},s,{placement:l,gutter:o}));return React.useEffect((function(){u.visible||c.unstable_reset()}),[u.visible]),_objectSpread2$1({},c,{},u)}useMenuBarState.__keys=keys$5;var keys$6=[].concat(useMenuBarState.__keys,usePopoverState.__keys);function useShortcuts(e,t,n){var i=t.stops,r=t.move;void 0===n&&(n=500);var o=React.useState(""),s=o[0],a=o[1];React.useEffect((function(){if(s){var e=setTimeout((function(){return a("")}),n),t=i.find((function(e){return Boolean(e.ref.current&&e.ref.current.textContent&&e.ref.current.textContent.toLowerCase().startsWith(s))}));return t&&r(t.id),function(){return clearTimeout(e)}}}),[s,i,r,n]),React.useEffect((function(){var t=e.current;if(t){var n=function(e){if(!(e.metaKey||e.altKey||e.shiftKey||e.ctrlKey)){var n=e.target,i=n.getAttribute("role"),r=n===t,o=i&&i.indexOf("menuitem")>=0&&closest(n,"[role=menu],[role=menubar]")===t;(r||o)&&/^[a-z0-9_-]$/i.test(e.key)&&(e.stopPropagation(),e.preventDefault(),a((function(t){return""+t+e.key})))}};return t.addEventListener("keydown",n),function(){return t.removeEventListener("keydown",n)}}}),[e,a])}useMenuState.__keys=keys$6;var useMenuBar=createHook({name:"MenuBar",compose:useBox,useState:useMenuState,useProps:function(e,t){var n=t.ref,i=t.unstable_wrap,r=t.role,o=void 0===r?"menubar":r,s=_objectWithoutPropertiesLoose$1(t,["ref","unstable_wrap","role"]),a=React.useRef(null),l=useMenuContext(a,o,e);return useShortcuts(a,e),_objectSpread2$1({ref:mergeRefs(a,n),role:o,"aria-orientation":e.orientation,unstable_wrap:usePipe(l,i)},s)}}),MenuBar=createComponent({as:"div",useHook:useMenuBar,useCreateElement:function(e,t,n){return warning(!t["aria-label"]&&!t["aria-labelledby"]&&"menubar"!==t.role,"Menu","You should provide either `aria-label` or `aria-labelledby` props.","See https://reakit.io/docs/menu"),useCreateElement(e,t,n)}}),useMenu=createHook({name:"Menu",compose:[useMenuBar,usePopover],useState:useMenuState,useOptions:function(e){var t=React.useContext(MenuContext);return _objectSpread2$1({unstable_autoFocusOnShow:!t,unstable_autoFocusOnHide:!(t&&"menubar"===t.role),modal:!1},e)},useProps:function(e,t){for(var n=t.onKeyDown,i=_objectWithoutPropertiesLoose$1(t,["onKeyDown"]),r=React.useContext(MenuContext),o="horizontal"===e.orientation,s="vertical"===e.orientation,a=Boolean(r),l=r;l&&"menubar"!==l.role;)l=l.parent;var c=l||{},u=c.next,h=c.previous,d="horizontal"===c.orientation,p=(e.placement||"").split("-")[0];return _objectSpread2$1({role:"menu",onKeyDown:useAllCallbacks(React.useMemo((function(){return createOnKeyDown({stopPropagation:function(e){return"Escape"!==e.key||!a},keyMap:function(t){var n=t.target===t.currentTarget;return{Escape:e.hide,ArrowUp:n&&!o&&e.last,ArrowRight:n&&!s&&e.first,ArrowDown:n&&!o&&e.first,ArrowLeft:n&&!s&&e.last,Home:n&&e.first,End:n&&e.last,PageUp:n&&e.first,PageDown:n&&e.last}}})}),[a,o,s,e.hide,e.last,e.first]),React.useMemo((function(){return createOnKeyDown({stopPropagation:!0,shouldKeyDown:function(e){return Boolean(a&&e.currentTarget.contains(e.target))},keyMap:a?{ArrowRight:d&&"left"!==p?u:"left"===p&&e.hide,ArrowLeft:d&&"right"!==p?h:"right"===p&&e.hide}:{}})}),[a,d,u,h,p,e.hide]),n)},i)},useCompose:function(e,t){return t=useMenuBar(e,t),usePopover(_objectSpread2$1({},e,{hideOnEsc:!1}),t)}}),Menu=createComponent({as:"div",useHook:useMenu,useCreateElement:function(e,t,n){return warning(!t["aria-label"]&&!t["aria-labelledby"],"Menu","You should provide either `aria-label` or `aria-labelledby` props.","See https://reakit.io/docs/menu"),useCreateElement(e,t,n)}}),usePopoverDisclosure=createHook({name:"PopoverDisclosure",compose:useDialogDisclosure,useState:usePopoverState,useProps:function(e,t){var n=t.ref,i=_objectWithoutPropertiesLoose$1(t,["ref"]);return _objectSpread2$1({ref:mergeRefs(e.unstable_referenceRef,n)},i)}}),PopoverDisclosure=createComponent({as:"button",useHook:usePopoverDisclosure}),noop$1=function(){},useMenuDisclosure=createHook({name:"MenuDisclosure",compose:usePopoverDisclosure,useState:useMenuState,useProps:function(e,t){var n=t.ref,i=t.onClick,r=t.onKeyDown,o=t.onFocus,s=t.onMouseOver,a=_objectWithoutPropertiesLoose$1(t,["ref","onClick","onKeyDown","onFocus","onMouseOver"]),l=React.useContext(MenuContext),c=React.useRef(null),u=React.useState(!1),h=u[0],d=u[1],p=e.placement.split("-")[0],f=Boolean(l),m=l&&"menubar"===l.role,g=React.useMemo((function(){return createOnKeyDown({stopPropagation:function(e){return"Escape"!==e.key},onKey:e.show,keyMap:function(){var t=function(){return setTimeout(e.first)};return{Escape:e.hide,Enter:f&&t," ":f&&t,ArrowUp:("top"===p||"bottom"===p)&&e.last,ArrowRight:"right"===p&&t,ArrowDown:("bottom"===p||"top"===p)&&t,ArrowLeft:"left"===p&&t}}})}),[p,f,e.show,e.hide,e.first,e.last]),v=React.useCallback((function(){m&&(d(!0),e.show())}),[m,d,e.show]);React.useEffect((function(){h&&setTimeout((function(){return d(!1)}),200)}),[h]);var y=React.useCallback((function(t){if(l){var n=t.currentTarget;if(m)l.ref.current&&l.ref.current.querySelector("[aria-expanded='true']")&&n.focus();else setTimeout((function(){n.contains(document.activeElement)&&(e.show(),document.activeElement!==n&&n.focus())}),200)}}),[l,m,e.show]),w=React.useCallback((function(){!f||m&&!h?e.toggle():e.show()}),[f,m,h,e.show,e.toggle]);return _objectSpread2$1({ref:mergeRefs(c,n),"aria-haspopup":"menu",onClick:useAllCallbacks(w,i),onKeyDown:useAllCallbacks(g,r),onFocus:useAllCallbacks(v,o),onMouseOver:useAllCallbacks(y,s)},a)},useCompose:function(e,t){return usePopoverDisclosure(_objectSpread2$1({},e,{toggle:noop$1}),t)}}),MenuDisclosure=createComponent({as:"button",useHook:useMenuDisclosure});function isTouchDevice(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)}var useMenuItem=createHook({name:"MenuItem",compose:useRover,useState:useMenuState,useProps:function(e,t){var n=t.onMouseOver,i=t.onMouseOut,r=_objectWithoutPropertiesLoose$1(t,["onMouseOver","onMouseOut"]),o=React.useContext(MenuContext),s=React.useCallback((function(e){e.currentTarget&&(isTouchDevice()||o&&"menubar"===o.role||e.currentTarget.focus())}),[e.orientation]),a=React.useCallback((function(e){if(e.currentTarget&&o){var t=e.currentTarget;t.hasAttribute("aria-controls")&&"true"===t.getAttribute("aria-expanded")||t.blur(),document.activeElement===document.body&&o.ref.current&&!isTouchDevice()&&o.ref.current.focus()}}),[e.move]);return _objectSpread2$1({role:"menuitem",onMouseOver:useAllCallbacks(s,n),onMouseOut:useAllCallbacks(a,i)},r)}}),MenuItem=createComponent({as:"button",useHook:useMenuItem});function ToolbarMenu(){const e=useMenuState({placement:"top-center"});return React__default.createElement(React.Fragment,null,React__default.createElement(MenuDisclosure,_extends({},e,{className:"button button-icon"}),React__default.createElement(Icon$1,{path:mdiSettings,size:"26px",className:"villain-icon"})),React__default.createElement(Menu,_extends({},e,{"aria-label":"Preferences",className:"menu"}),React__default.createElement(MenuItem,_extends({},e,{className:"menu-item",as:"div"}),"Manga mode"),React__default.createElement(MenuItem,_extends({},e,{as:"div",className:"menu-item"}),"Language"),React__default.createElement(MenuItem,_extends({},e,{as:"div",className:"menu-item"}),"Keyboard shortcuts")))}const isFocused=()=>{const e=document.activeElement,t=document.querySelector("div.villain").contains(e),n=e.tagName.toLowerCase();return t&&-1===["input","textarea","button"].indexOf(n)},Toolbar=({allowFullScreen:e,showControls:t,toggleFullscreen:n,updateZoom:i,renderError:r,localize:o})=>{const{state:s,toggleSetting:a,navigateForward:l,navigateBackward:c,navigateToPage:u,toggleTheme:h,togglePin:d}=React.useContext(ReaderContext),{theme:p,pages:f,bookMode:m,mangaMode:g,fullscreen:v,currentPage:y,currentZoom:w,totalPages:b,autoHideControls:S,allowGlobalShortcuts:T}=s,[_,x]=React.useState("en-US");React.useEffect(()=>{localize.setLanguage(_)},[_]);const E=React.useCallback(e=>{if(!isFocused()&&!T)return;const t=g?c:l,i=g?l:c;switch(e.key){case"f":e.preventDefault(),n();break;case"ArrowRight":t();break;case"ArrowLeft":i()}},[T,g,c,l,n]);React.useEffect(()=>(document.addEventListener("keydown",E),()=>{document.removeEventListener("keydown",E)}),[E]);const P={icon:m?mdiBookOpen:mdiBookOpenOutline},R=v?mdiFullscreenExit:mdiFullscreen,C={icon:"Light"===p?mdiWeatherNight:mdiWhiteBalanceSunny},O=f.length/b*100;return React__default.createElement("div",{className:clsx("villain-toolbar",!t&&"villain-toolbar-hide")},React__default.createElement(Navigation,{currentPage:y,totalPages:b}),React__default.createElement("div",{className:"villain-toolbar-group villain-toolbar-group-expand"},React__default.createElement(Slider$1,{max:b,value:y,bufferProgress:O,onChange:u,reversed:g})),React__default.createElement("div",{className:"villain-toolbar-group",disabled:r},React__default.createElement(ZoomControls,{onUpdate:i,currentZoom:w,disabled:r}),React__default.createElement("div",{className:"divider"}),React__default.createElement(Button$1,{type:"icon",icon:mdiPin,active:!S,onClick:d,disabled:r,tooltip:localize["Pin controls"]}),React__default.createElement(ToolbarMenu,null),React__default.createElement(Button$1,_extends({type:"icon",tooltip:m?localize["Page view"]:localize["Book view"],onClick:()=>a("bookMode"),disabled:r},P)),React__default.createElement(Button$1,_extends({type:"icon",tooltip:"Light"===p?localize["Dark theme"]:localize["Light theme"],onClick:h,disabled:r},C)),e&&React__default.createElement(Button$1,{type:"icon",icon:R,tooltip:v?localize["Exit fullscreen"]:localize["Enter fullscreen"],tooltipClass:"right-edge",onClick:n,disabled:r})))},prefixes={exitFullscreen:["exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen"],fullscreenChange:["fullscreenchange","MSFullscreenChange","mozfullscreenchange","webkitfullscreenchange"],fullscreenEnabled:["fullscreenEnabled","msFullscreenEnabled","mozFullScreenEnabled","webkitFullscreenEnabled"],fullscreenElement:["fullscreenElement","msFullscreenElement","mozFullScreenElement","webkitFullscreenElement"],requestFullscreen:["requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen"]},getPrefix=()=>{let e=0;return prefixes.fullscreenEnabled.some((t,n)=>{if(document[t]||!1===document[t])return e=n,!0}),e},fullscreenElement=()=>{const e=getPrefix(),t=prefixes.fullscreenElement[e];return document[t]},requestFullscreen=e=>{const t=getPrefix(),n=prefixes.requestFullscreen[t];e[n]&&e[n]()},exitFullscreen=()=>{const e=getPrefix(),t=prefixes.exitFullscreen[e];document[t]&&document[t]()},toggleFullscreen=e=>{fullscreenElement()?exitFullscreen():requestFullscreen(e)},onFullscreenChange=(e,t,n)=>{const i=getPrefix(),r=prefixes.fullscreenChange[i];e[`${t}EventListener`](r,n,!1)};class CanvasRender extends React.Component{constructor(e){super(e),_defineProperty(this,"getTargetZoom",(e=1)=>{const{viewport:t,world:n}=this.viewer,i=n.getItemCount();if(i>1){return n.getItemAt(0).imageToViewportZoom(e)}if(i&&1===i)return t.imageToViewportZoom(e)}),_defineProperty(this,"updateZoomLimits",()=>{const{viewport:e}=this.viewer,t=this.getTargetZoom(),n=this.viewer.world.getItemAt(0).getBounds(),i=e.getBounds(),r=n.width/n.height/(i.width/i.height),o=.9*(r>=1?1:r)/n.width,s=t<=o?t:o;e.defaultZoomLevel=s,e.minZoomLevel=s,e.maxZoomLevel=t}),_defineProperty(this,"updateZoom",(e=1)=>{const{viewport:t}=this.viewer,n=this.getTargetZoom(),i=t.getMinZoom();let r=e;"string"==typeof r&&(r=parseInt(r)),r&&(r>100&&(r=100),(r=r/100*this.getTargetZoom())>n&&(r=n),r<i&&(r=i),t.zoomTo(r,null,!0))}),_defineProperty(this,"zoomToOriginalSize",()=>{const e=this.getTargetZoom();this.viewer.viewport.zoomTo(e,null,!0)}),_defineProperty(this,"handleFocus",()=>{const{autoHideControls:e}=this.props;e&&this.context.updateState({focus:!0})}),_defineProperty(this,"handleBlur",()=>{const{autoHideControls:e}=this.props;e&&this.context.updateState({focus:!1})}),_defineProperty(this,"handleEnter",()=>{const{autoHideControls:e}=this.props;e&&this.context.updateState({hover:!0})}),_defineProperty(this,"handleExit",()=>{const{autoHideControls:e}=this.props;e&&this.context.updateState({hover:!1})}),_defineProperty(this,"handleError",e=>{this.viewer.close(),this.context.updateState({renderError:!0}),console.error(e)}),_defineProperty(this,"handleFullscreenChange",()=>{const e=fullscreenElement();this.context.updateState({fullscreen:e}),this.updateZoomLimits()}),_defineProperty(this,"handleZoom",({zoom:e})=>{const{viewport:t}=this.viewer,n=t.getMinZoom(),i=t.getMaxZoom(),r=parseInt(e/i*100),o=e<i&&r<100,s=e>n;this.context.updateState({currentZoom:r,canZoomIn:o,canZoomOut:s})}),_defineProperty(this,"handleZoomOptimized",e=>{this.isScrolling||this.handleZoom(e)}),_defineProperty(this,"handleScrollOptimized",()=>{this.isScrolling=!0,window.clearTimeout(this.clearScrollingDelay),this.clearScrollingDelay=setTimeout(()=>{this.isScrolling=!1,this.handleZoomOptimized({zoom:this.viewer.viewport.getZoom()})},750)}),_defineProperty(this,"toggleFullscreen",()=>{const{container:e,allowFullScreen:t}=this.props;t&&toggleFullscreen(e)}),this.viewer=null,this.browser=null,this.isScrolling=!1,this.clearScrollingDelay=null}initOpenSeaDragon(){const{id:e}=this.props,{pages:t}=this.context.state;this.browser=getKeyByValue(openseadragon.BROWSERS,openseadragon.Browser.vendor),this.viewer=openseadragon({id:e,tileSources:t[0],...config}),this.viewer.canvas.addEventListener("blur",this.handleBlur),this.viewer.canvas.addEventListener("focus",this.handleFocus),this.viewer.addHandler("open",()=>{this.renderLayout(),this.updateZoomLimits(),this.viewer.viewport.zoomTo(this.viewer.viewport.getMinZoom(),null,!0),this.context.updateState({renderError:!1})}),this.viewer.addHandler("resize",()=>{this.updateZoomLimits()}),"FIREFOX"===this.browser?(this.viewer.addHandler("zoom",this.handleZoomOptimized),this.viewer.addHandler("canvas-scroll",this.handleScrollOptimized)):this.viewer.addHandler("zoom",this.handleZoom),this.viewer.addHandler("canvas-exit",this.handleExit),this.viewer.addHandler("canvas-enter",this.handleEnter),this.viewer.addHandler("open-failed",this.handleError),onFullscreenChange(document,"add",this.handleFullscreenChange)}renderPage(e){const t=this.context.getPage(e);t&&this.viewer.open(t)}renderCover(){this.renderPage(0)}renderLayout(){const{viewport:e,world:t}=this.viewer,{currentPage:n}=this.context.state,i=new openseadragon.Point(0,0),r=t.getItemCount();let o=null,s=null,a=null;for(let e=0;e<r;e++)(s=t.getItemAt(e))&&(o=s.getBounds(),0===e?a=o:s.setHeight(a.height,!0),o=s.getBounds(),s.setPosition(i,!0),i.x+=o.width);this.fitPages()}fitPagesLegacy(){const{viewport:e,world:t}=this.viewer,n=t.getItemCount(),i=t.getItemAt(0);if(i){const t=i.getBounds(),r=8/e.getContainerSize().x;t.width=(t.width+r)*n,e.fitBoundsWithConstraints(t,!0)}}fitPages(e){const{viewport:t,world:n}=this.viewer;e||this.fitPagesLegacy(),"vertical"===e&&t.fitVertically(!0),"horizontal"===e&&t.fitHorizontally(!0)}componentDidMount(){const{initialPage:e}=this.props;this.initOpenSeaDragon(),this.renderPage(e)}componentWillUnmount(){onFullscreenChange(document,"remove",this.handleFullscreenChange),this.viewer.canvas.removeEventListener("focus",this.handleFocus),this.viewer.canvas.removeEventListener("blur",this.handleBlur),this.viewer.destroy(),this.viewer=null}componentDidUpdate(e){const{totalPages:t}=this.context.state,{hover:n,focus:i,theme:r,currentPage:o,bookMode:s,autoHideControls:a,mangaMode:l}=this.props;o===e.currentPage&&s===e.bookMode||o>=0&&o<t&&this.renderPage(o),s!==e.bookMode&&s&&this.renderLayout(),a!==e.autoHideControls&&this.context.updateState({showControls:!a,autoHideControls:a}),r!==e.theme&&r&&this.context.updateState({theme:r}),this.context.state.autoHideControls&&(i!==e.focus?this.context.updateState({showControls:i}):n!==e.hover&&this.context.updateState({showControls:n})),l!==e.mangaMode&&this.context.updateState({mangaMode:l},()=>this.renderPage(o))}render(){const{id:e,autoHideControls:t,renderError:n,allowFullScreen:i}=this.props,{showControls:r}=this.context.state;return React__default.createElement(React__default.Fragment,null,React__default.createElement(Toolbar,{updateZoom:this.updateZoom,toggleFullscreen:this.toggleFullscreen,renderError:n,allowFullScreen:i,showControls:!t||r}),React__default.createElement("div",{id:e,className:"villain-canvas"}),n&&React__default.createElement(Error$1,{message:localize["Invalid image"],icon:mdiImageBrokenVariant}))}}_defineProperty(CanvasRender,"defaultProps",{initialPage:0}),_defineProperty(CanvasRender,"contextType",ReaderContext);const defaultOpts={theme:"Dark",preview:null,workerUrl:null,allowFullScreen:!0,autoHideControls:!1,allowGlobalShortcuts:!1};class Villain extends React.Component{constructor(e){super(e)}render(){const{file:e,width:t,height:n,options:i}=this.props,r={...defaultOpts,...i},{autoHideControls:o,allowFullScreen:s,mangaMode:a,theme:l,allowGlobalShortcuts:c}=r;return React__default.createElement(ReaderProvider,{defaultState:{theme:l,autoHideControls:o,mangaMode:a,allowGlobalShortcuts:c}},React__default.createElement(Wrapp$1,{width:t,height:n,preview:r.preview},t=>React__default.createElement(Uncompress,{file:e,workerUrl:r.workerUrl,preview:r.preview},React__default.createElement(ReaderContext.Consumer,null,({state:e})=>React__default.createElement(CanvasRender,{id:"osd-canvas-render",hover:e.hover,focus:e.focus,theme:l,container:t,bookMode:e.bookMode,mangaMode:a,allowGlobalShortcuts:e.allowGlobalShortcuts,currentPage:e.currentPage,allowFullScreen:s,autoHideControls:o,renderError:e.renderError})))))}}return _defineProperty(Villain,"contextType",ReaderContext),_defineProperty(Villain,"defaultProps",{file:null,width:"780px",height:"380px",options:{...defaultOpts}}),Villain.propTypes={file:propTypes.oneOfType([propTypes.string,propTypes.instanceOf(Blob)]),width:propTypes.string,height:propTypes.string,options:propTypes.shape({theme:propTypes.string,workerUrl:propTypes.string,preview:propTypes.number})},Villain}));
